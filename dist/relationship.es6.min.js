var _Mathpow=Math.pow,_MathPI=Math.PI,_Mathtan=Math.tan,_Mathcos=Math.cos,_Mathsin=Math.sin,_Mathsqrt=Math.sqrt,_Mathmax=Math.max,_Mathabs=Math.abs;(function(o){function l(d){if(n[d])return n[d].exports;var u=n[d]={i:d,l:!1,exports:{}};return o[d].call(u.exports,u,u.exports,l),u.l=!0,u.exports}var n={};return l.m=o,l.c=n,l.i=function(d){return d},l.d=function(d,u,p){l.o(d,u)||Object.defineProperty(d,u,{configurable:!1,enumerable:!0,get:p})},l.n=function(d){var u=d&&d.__esModule?function(){return d['default']}:function(){return d};return l.d(u,'a',u),u},l.o=function(d,u){return Object.prototype.hasOwnProperty.call(d,u)},l.p='',l(l.s=29)})([function(o,l){'use strict';class d{constructor(u,p,m,I=!1){this.label=u,this.type=p,this._data=m,this._init(p,I)}get data(){return this._data}set data(u){this._data=u}_init(u){switch(this.type){case 35675:{this.bind=(m,I)=>{m.uniformMatrix3fv(I,!1,this.data)};break}case 35676:{this.bind=(m,I)=>{m.uniformMatrix4fv(I,!1,this.data)};break}case 35665:{this.bind=(m,I)=>{m.uniform3f(I,...this.data)};break}case 5124:this.bind=(m,I)=>{m.uniform1i(I,this.data)};break;case-1:this.bind=(m,I)=>{m.uniform1fv(I,this.data)};break;default:console.error('Uniform type unknow: {label:',this.label,', type:',u,'}');}}}l.a=d},function(o,l){'use strict';class d{constructor(){this.lastTexture=null,this.lastProgram=null,this.lastDepthTest=!1}optimizeTexture(u){const p=this.lastTexture;return this.lastTexture=u,u===p}optimizeProgram(u){const p=this.lastProgram;return this.lastProgram=u,u===p}optimizeDepthTest(u){const p=this.lastDepthTest;return this.lastDepthTest=u,p===u}static getInstance(u){const p=d.glList.indexOf(u);if(0>p){const m=new d;return d.glList.push(u),d.list.push(m),m}return d.list[p]}}d.glList=[],d.list=[],l.a=d},function(o,l){'use strict';let d=0;l.a=class{constructor(p,m){this.vertexShaderSrc=p,this.fragmentShaderSrc=m,this.attribLocation={},this.uniformLocation={},this.textureLocation={},this.textureIndex={},this.textureNum=0,this.id=d++}isInitialized(){return!!this.pointer}init(p){this.vertexShader=this._createShader(p,35633,this.vertexShaderSrc),this.fragmentShader=this._createShader(p,35632,this.fragmentShaderSrc);const m=p.createProgram();return(p.attachShader(m,this.vertexShader),p.attachShader(m,this.fragmentShader),p.linkProgram(m),!p.getProgramParameter(m,p.LINK_STATUS))?(console.error('Shader initialization error'),!1):(p.useProgram(m),this.pointer=m,!0)}getAttribLocation(p,m){const I=m.label;if(!this.attribLocation.hasOwnProperty(I)){const T=p.getAttribLocation(this.pointer,I);return p.enableVertexAttribArray(T),this.attribLocation[I]=T,T}return this.attribLocation[I]}getUniformLocation(p,m){const I=m.label;if(!this.uniformLocation.hasOwnProperty(I)){const T=p.getUniformLocation(this.pointer,I);return this.uniformLocation[I]=T,T}return this.uniformLocation[I]}getTextureLocationIndex(p,m){const I=m.label;if(!this.textureLocation.hasOwnProperty(I)||!this.textureIndex.hasOwnProperty(I)){const T=p.getUniformLocation(this.pointer,I);return this.textureLocation[I]=T,this.textureIndex[I]=this.textureNum,[T,this.textureNum++]}return[this.textureLocation[I],this.textureIndex[I]]}bind(p){p.useProgram(this.pointer)}_createShader(p,m,I){const T=p.createShader(m);return p.shaderSource(T,I),p.compileShader(T),p.getShaderParameter(T,p.COMPILE_STATUS)?T:console.error('Une erreur est survenue au cours de la compilation du shader: '+p.getShaderInfoLog(T))}}},function(o,l,n){'use strict';var d=n(5),u=n(10);class p extends d.a{constructor(m,I){super(m,I),this.depthTest=!0;const T=new u.a('uMVMatrix');this.transform=T,this.addUniform(T)}get position(){return this.transform.getTranslation()}get rotation(){return this.transform.getRotation()}draw(m,I=[]){this.transform&&this.transform.update(),super.draw(m,I)}}l.a=p},function(o,l){'use strict';function d(m,I,T,_,P,L,U,C,N,O,D,E,v,A,M,q,B){m[0]=I,m[1]=T,m[2]=_,m[3]=P,m[4]=L,m[5]=U,m[6]=C,m[7]=N,m[8]=O,m[9]=D,m[10]=E,m[11]=v,m[12]=A,m[13]=M,m[14]=q,m[15]=B}const u=1e-6;class p extends Float32Array{constructor(){super(16),this[0]=1,this[5]=1,this[10]=1,this[15]=1}clone(){const m=new p;return m.set(this),m}copy(m){return m.set(this),this}identity(){return d(this,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}add(m){return this[0]+=m[0],this[1]+=m[1],this[2]+=m[2],this[3]+=m[3],this[4]+=m[4],this[5]+=m[5],this[6]+=m[6],this[7]+=m[7],this[8]+=m[8],this[9]+=m[9],this[10]+=m[10],this[11]+=m[11],this[12]+=m[12],this[13]+=m[13],this[14]+=m[14],this[15]+=m[15],this}subtract(m){return this[0]-=m[0],this[1]-=m[1],this[2]-=m[2],this[3]-=m[3],this[4]-=m[4],this[5]-=m[5],this[6]-=m[6],this[7]-=m[7],this[8]-=m[8],this[9]-=m[9],this[10]-=m[10],this[11]-=m[11],this[12]-=m[12],this[13]-=m[13],this[14]-=m[14],this[15]-=m[15],this}multiplyScalar(m){return this[0]*=m,this[1]*=m,this[2]*=m,this[3]*=m,this[4]*=m,this[5]*=m,this[6]*=m,this[7]*=m,this[8]*=m,this[9]*=m,this[10]*=m,this[11]*=m,this[12]*=m,this[13]*=m,this[14]*=m,this[15]*=m,this}multiplyScalarAndAdd(m,I){return this[0]+=m[0]*I,this[1]+=m[1]*I,this[2]+=m[2]*I,this[3]+=m[3]*I,this[4]+=m[4]*I,this[5]+=m[5]*I,this[6]+=m[6]*I,this[7]+=m[7]*I,this[8]+=m[8]*I,this[9]+=m[9]*I,this[10]+=m[10]*I,this[11]+=m[11]*I,this[12]+=m[12]*I,this[13]+=m[13]*I,this[14]+=m[14]*I,this[15]+=m[15]*I,this}exactEquals(m){return this[0]===m[0]&&this[1]===m[1]&&this[2]===m[2]&&this[3]===m[3]&&this[4]===m[4]&&this[5]===m[5]&&this[6]===m[6]&&this[7]===m[7]&&this[8]===m[8]&&this[9]===m[9]&&this[10]===m[10]&&this[11]===m[11]&&this[12]===m[12]&&this[13]===m[13]&&this[14]===m[14]&&this[15]===m[15]}equals(m){const[I,T,_,P,L,U,C,N,O,D,E,v,A,M,q,B]=this,[G,R,V,H,F,k,W,X,Y,Z,K,Q,J,$,ee,ae]=m;return _Mathabs(I-G)<=u*_Mathmax(1,_Mathabs(I),_Mathabs(G))&&_Mathabs(T-R)<=u*_Mathmax(1,_Mathabs(T),_Mathabs(R))&&_Mathabs(_-V)<=u*_Mathmax(1,_Mathabs(_),_Mathabs(V))&&_Mathabs(P-H)<=u*_Mathmax(1,_Mathabs(P),_Mathabs(H))&&_Mathabs(L-F)<=u*_Mathmax(1,_Mathabs(L),_Mathabs(F))&&_Mathabs(U-k)<=u*_Mathmax(1,_Mathabs(U),_Mathabs(k))&&_Mathabs(C-W)<=u*_Mathmax(1,_Mathabs(C),_Mathabs(W))&&_Mathabs(N-X)<=u*_Mathmax(1,_Mathabs(N),_Mathabs(X))&&_Mathabs(O-Y)<=u*_Mathmax(1,_Mathabs(O),_Mathabs(Y))&&_Mathabs(D-Z)<=u*_Mathmax(1,_Mathabs(D),_Mathabs(Z))&&_Mathabs(E-K)<=u*_Mathmax(1,_Mathabs(E),_Mathabs(K))&&_Mathabs(v-Q)<=u*_Mathmax(1,_Mathabs(v),_Mathabs(Q))&&_Mathabs(A-J)<=u*_Mathmax(1,_Mathabs(A),_Mathabs(J))&&_Mathabs(M-$)<=u*_Mathmax(1,_Mathabs(M),_Mathabs($))&&_Mathabs(q-ee)<=u*_Mathmax(1,_Mathabs(q),_Mathabs(ee))&&_Mathabs(B-ae)<=u*_Mathmax(1,_Mathabs(B),_Mathabs(ae))}transpose(m){if(m===this){const I=m[1],T=m[2],_=m[3],P=m[6],L=m[7],U=m[11];this[1]=m[4],this[2]=m[8],this[3]=m[12],this[4]=I,this[6]=m[9],this[7]=m[13],this[8]=T,this[9]=P,this[11]=m[14],this[12]=_,this[13]=L,this[14]=U}else d(this,m[0],m[4],m[8],m[12],m[1],m[5],m[9],m[13],m[2],m[6],m[10],m[14],m[3],m[7],m[11],m[15]);return this}invert(){const[m,I,T,_,P,L,U,C,N,O,D,E,v,A,M,q]=this,B=m*L-I*P,G=m*U-T*P,R=m*C-_*P,V=I*U-T*L,H=I*C-_*L,F=T*C-_*U,k=N*A-O*v,W=N*M-D*v,X=N*q-E*v,Y=O*M-D*A,Z=O*q-E*A,K=D*q-E*M;let Q=B*K-G*Z+R*Y+V*X-H*W+F*k;return Q?(Q=1/Q,d(this,(L*K-U*Z+C*Y)*Q,(T*Z-I*K-_*Y)*Q,(A*F-M*H+q*V)*Q,(D*H-O*F-E*V)*Q,(U*X-P*K-C*W)*Q,(m*K-T*X+_*W)*Q,(M*R-v*F-q*G)*Q,(N*F-D*R+E*G)*Q,(P*Z-L*X+C*k)*Q,(I*X-m*Z-_*k)*Q,(v*H-A*R+q*B)*Q,(O*R-N*H-E*B)*Q,(L*W-P*Y-U*k)*Q,(m*Y-I*W+T*k)*Q,(A*G-v*V-M*B)*Q,(N*V-O*G+D*B)*Q),this):this}adjoint(){const[m,I,T,_,P,L,U,C,N,O,D,E,v,A,M,q]=this;return d(this,L*(D*q-E*M)-O*(U*q-C*M)+A*(U*E-C*D),-(I*(D*q-E*M)-O*(T*q-_*M)+A*(T*E-_*D)),I*(U*q-C*M)-L*(T*q-_*M)+A*(T*C-_*U),-(I*(U*E-C*D)-L*(T*E-_*D)+O*(T*C-_*U)),-(P*(D*q-E*M)-N*(U*q-C*M)+v*(U*E-C*D)),m*(D*q-E*M)-N*(T*q-_*M)+v*(T*E-_*D),-(m*(U*q-C*M)-P*(T*q-_*M)+v*(T*C-_*U)),m*(U*E-C*D)-P*(T*E-_*D)+N*(T*C-_*U),P*(O*q-E*A)-N*(L*q-C*A)+v*(L*E-C*O),-(m*(O*q-E*A)-N*(I*q-_*A)+v*(I*E-_*O)),m*(L*q-C*A)-P*(I*q-_*A)+v*(I*C-_*L),-(m*(L*E-C*O)-P*(I*E-_*O)+N*(I*C-_*L)),-(P*(O*M-D*A)-N*(L*M-U*A)+v*(L*D-U*O)),m*(O*M-D*A)-N*(I*M-T*A)+v*(I*D-T*O),-(m*(L*M-U*A)-P*(I*M-T*A)+v*(I*U-T*L)),m*(L*D-U*O)-P*(I*D-T*O)+N*(I*U-T*L)),this}determinant(){const[m,I,T,_,P,L,U,C,N,O,D,E,v,A,M,q]=this;return(m*L-I*P)*(D*q-E*M)-(m*U-T*P)*(O*q-E*A)+(m*C-_*P)*(O*M-D*A)+(I*U-T*L)*(N*q-E*v)-(I*C-_*L)*(N*M-D*v)+(T*C-_*U)*(N*A-O*v)}multiply(m){const[I,T,_,P,L,U,C,N,O,D,E,v,A,M,q,B]=this;let[G,R,V,H]=m;return this[0]=G*I+R*L+V*O+H*A,this[1]=G*T+R*U+V*D+H*M,this[2]=G*_+R*C+V*E+H*q,this[3]=G*P+R*N+V*v+H*B,G=m[4],R=m[5],V=m[6],H=m[7],this[4]=G*I+R*L+V*O+H*A,this[5]=G*T+R*U+V*D+H*M,this[6]=G*_+R*C+V*E+H*q,this[7]=G*P+R*N+V*v+H*B,G=m[8],R=m[9],V=m[10],H=m[11],this[8]=G*I+R*L+V*O+H*A,this[9]=G*T+R*U+V*D+H*M,this[10]=G*_+R*C+V*E+H*q,this[11]=G*P+R*N+V*v+H*B,G=m[12],R=m[13],V=m[14],H=m[15],this[12]=G*I+R*L+V*O+H*A,this[13]=G*T+R*U+V*D+H*M,this[14]=G*_+R*C+V*E+H*q,this[15]=G*P+R*N+V*v+H*B,this}translate([m,I,T]){return this[12]=this[0]*m+this[4]*I+this[8]*T+this[12],this[13]=this[1]*m+this[5]*I+this[9]*T+this[13],this[14]=this[2]*m+this[6]*I+this[10]*T+this[14],this[15]=this[3]*m+this[7]*I+this[11]*T+this[15],this}scale([m,I,T]){return this[0]*=m,this[1]*=m,this[2]*=m,this[3]*=m,this[4]*=I,this[5]*=I,this[6]*=I,this[7]*=I,this[8]*=T,this[9]*=T,this[10]*=T,this[11]*=T,this}rotate(m,[I,T,_]){let P=_Mathsqrt(I*I+T*T+_*_);if(_Mathabs(P)>u){P=1/P,I*=P,T*=P,_*=P;const L=_Mathsin(m),U=_Mathcos(m),C=1-U,[N,O,D,E,v,A,M,q,B,G,R,V]=this,H=I*I*C+U,F=T*I*C+_*L,k=_*I*C-T*L,W=I*T*C-_*L,X=T*T*C+U,Y=_*T*C+I*L,Z=I*_*C+T*L,K=T*_*C-I*L,Q=_*_*C+U;this[0]=N*H+v*F+B*k,this[1]=O*H+A*F+G*k,this[2]=D*H+M*F+R*k,this[3]=E*H+q*F+V*k,this[4]=N*W+v*X+B*Y,this[5]=O*W+A*X+G*Y,this[6]=D*W+M*X+R*Y,this[7]=E*W+q*X+V*Y,this[8]=N*Z+v*K+B*Q,this[9]=O*Z+A*K+G*Q,this[10]=D*Z+M*K+R*Q,this[11]=E*Z+q*K+V*Q}return this}rotateX(m){const I=_Mathsin(m),T=_Mathcos(m),_=this[4],P=this[5],L=this[6],U=this[7],C=this[8],N=this[9],O=this[10],D=this[11];return this[4]=_*T+C*I,this[5]=P*T+N*I,this[6]=L*T+O*I,this[7]=U*T+D*I,this[8]=C*T-_*I,this[9]=N*T-P*I,this[10]=O*T-L*I,this[11]=D*T-U*I,this}rotateY(m){const I=_Mathsin(m),T=_Mathcos(m),[_,P,L,U]=this,C=this[8],N=this[9],O=this[10],D=this[11];return this[0]=_*T-C*I,this[1]=P*T-N*I,this[2]=L*T-O*I,this[3]=U*T-D*I,this[8]=_*I+C*T,this[9]=P*I+N*T,this[10]=L*I+O*T,this[11]=U*I+D*T,this}rotateZ(m){const I=_Mathsin(m),T=_Mathcos(m),[_,P,L,U,C,N,O,D]=this;return this[0]=_*T+C*I,this[1]=P*T+N*I,this[2]=L*T+O*I,this[3]=U*T+D*I,this[4]=C*T-_*I,this[5]=N*T-P*I,this[6]=O*T-L*I,this[7]=D*T-U*I,this}fromTranslation(m){return d(this,1,0,0,0,0,1,0,0,0,0,1,0,m[0],m[1],m[2],1),this}fromScaling(m){return d(this,m[0],0,0,0,0,m[1],0,0,0,0,m[2],0,0,0,0,1),this}fromRotation(m,[I,T,_]){let P=_Mathsqrt(I*I+T*T+_*_);if(_Mathabs(P)>u){P=1/P,I*=P,T*=P,_*=P;const L=_Mathsin(m),U=_Mathcos(m),C=1-U;d(this,I*I*C+U,T*I*C+_*L,_*I*C-T*L,0,I*T*C-_*L,T*T*C+U,_*T*C+I*L,0,I*_*C+T*L,T*_*C-I*L,_*_*C+U,0,0,0,0,1)}return this}fromXRotation(m){const I=_Mathsin(m),T=_Mathcos(m);return d(this,1,0,0,0,0,T,I,0,0,-I,T,0,0,0,0,1),this}fromYRotation(m){const I=_Mathsin(m),T=_Mathcos(m);return d(this,T,0,-I,0,0,1,0,0,I,0,T,0,0,0,0,1),this}fromZRotation(m){const I=_Mathsin(m),T=_Mathcos(m);return d(this,T,I,0,0,-I,T,0,0,0,0,1,0,0,0,0,1),this}fromQuat(m){const[I,T,_,P]=m,L=I+I,U=T+T,C=_+_,N=I*L,O=T*L,D=T*U,E=_*L,v=_*U,A=_*C,M=P*L,q=P*U,B=P*C;return d(this,1-D-A,O+B,E-q,0,O-B,1-N-A,v+M,0,E+q,v-M,1-N-D,0,0,0,0,1),this}fromRotationTranslation(m,I){const[T,_,P,L]=m,U=T+T,C=_+_,N=P+P,O=T*U,D=T*C,E=T*N,v=_*C,A=_*N,M=P*N,q=L*U,B=L*C,G=L*N;return d(this,1-(v+M),D+G,E-B,0,D-G,1-(O+M),A+q,0,E+B,A-q,1-(O+v),0,I[0],I[1],I[2],1),this}fromRotationTranslationScale(m,I,[T,_,P]){const[L,U,C,N]=m,O=L+L,D=U+U,E=C+C,v=L*O,A=L*D,M=L*E,q=U*D,B=U*E,G=C*E,R=N*O,V=N*D,H=N*E;return d(this,(1-(q+G))*T,(A+H)*T,(M-V)*T,0,(A-H)*_,(1-(v+G))*_,(B+R)*_,0,(M+V)*P,(B-R)*P,(1-(v+q))*P,0,I[0],I[1],I[2],1),this}fromRotationTranslationScaleOrigin(m,I,T,_){const[P,L,U,C]=m,N=P+P,O=L+L,D=U+U,E=P*N,v=P*O,A=P*D,M=L*O,q=L*D,B=U*D,G=C*N,R=C*O,V=C*D,[H,F,k]=T,[W,X,Y]=_;return d(this,(1-(M+B))*H,(v+V)*H,(A-R)*H,0,(v-V)*F,(1-(E+B))*F,(q+G)*F,0,(A+R)*k,(q-G)*k,(1-(E+M))*k,0,I[0]+W-(this[0]*W+this[4]*X+this[8]*Y),I[1]+X-(this[1]*W+this[5]*X+this[9]*Y),I[2]+Y-(this[2]*W+this[6]*X+this[10]*Y),1),this}getTranslation(m=new Float32Array(3)){return m[0]=this[12],m[1]=this[13],m[2]=this[14],m}getRotation(m=new Float32Array(4)){var I=this[0]+this[5]+this[10];if(0<I){const T=2*_Mathsqrt(I+1);m[0]=(this[6]-this[9])/T,m[1]=(this[8]-this[2])/T,m[2]=(this[1]-this[4])/T,m[3]=0.25*T}else if(this[0]>this[5]&this[0]>this[10]){const T=2*_Mathsqrt(1+this[0]-this[5]-this[10]);m[0]=0.25*T,m[1]=(this[1]+this[4])/T,m[2]=(this[8]+this[2])/T,m[3]=(this[6]-this[9])/T}else if(this[5]>this[10]){const T=_Mathsqrt(1+this[5]-this[0]-this[10]);m[0]=2*((this[1]+this[4])/T),m[1]=0.25*T,m[2]=(this[6]+this[9])/T,m[3]=(this[8]-this[2])/T}else{const T=2*_Mathsqrt(1+this[10]-this[0]-this[5]);m[0]=(this[8]+this[2])/T,m[1]=(this[6]+this[9])/T,m[2]=0.25*T,m[3]=(this[1]-this[4])/T}return m}frustrum(m,I,T,_,P,L){const U=1/(I-m),C=1/(_-T),N=1/(P-L);return d(this,2*P*U,0,0,0,0,2*P*C,0,0,(I+m)*U,(_+T)*C,(L+P)*N,-1,0,0,2*(L*P)*N,0),this}perspective(m,I,T,_){const P=1/_Mathtan(m/2),L=1/(T-_);return d(this,P/I,0,0,0,0,P,0,0,0,0,(_+T)*L,-1,0,0,2*_*T*L,0),this}perspectiveFromFieldOfView(m,I,T){const _=_Mathtan(m.upDegrees*_MathPI/180),P=_Mathtan(m.downDegrees*_MathPI/180),L=_Mathtan(m.leftDegrees*_MathPI/180),U=_Mathtan(m.rightDegrees*_MathPI/180),C=2/(L+U),N=2/(_+P);return d(this,C,0,0,0,0,N,0,0,0.5*(-(L-U)*C),0.5*((_-P)*N),T/(I-T),-1,0,0,T*I/(I-T),0),this}ortho(m,I,T,_,P,L){const U=1/(m-I),C=1/(T-_),N=1/(P-L);return d(this,-2*U,0,0,0,0,-2*C,0,0,0,0,2*N,0,(m+I)*U,(_+T)*C,(L+P)*N,1),this}lookAt(m,I,T){const[_,P,L]=m,[U,C,N]=T,[O,D,E]=I;if(_Mathabs(_-O)<u&&_Mathabs(P-D)<u&&_Mathabs(L-E)<u)return this.identity();let v=_-O,A=P-D,M=L-E,q=1/_Mathsqrt(v*v+A*A+M*M);v*=q,A*=q,M*=q;let B=C*M-N*A,G=N*v-U*M,R=U*A-C*v;q=_Mathsqrt(B*B+G*G+R*R),q?(q=1/q,B*=q,G*=q,R*=q):(B=0,G=0,R=0);let V=A*R-M*G,H=M*B-v*R,F=v*G-A*B;return q=_Mathsqrt(V*V+H*H+F*F),q?(q=1/q,V*=q,H*=q,F*=q):(V=0,H=0,F=0),d(this,B,V,v,0,G,H,A,0,R,F,M,0,-(B*_+G*P+R*L),-(V*_+H*P+F*L),-(v*_+A*P+M*L),1),this}frob(){return _Mathsqrt(_Mathpow(this[0],2)+_Mathpow(this[1],2)+_Mathpow(this[2],2)+_Mathpow(this[3],2)+_Mathpow(this[4],2)+_Mathpow(this[5],2)+_Mathpow(this[6],2)+_Mathpow(this[7],2)+_Mathpow(this[8],2)+_Mathpow(this[9],2)+_Mathpow(this[10],2)+_Mathpow(this[11],2)+_Mathpow(this[12],2)+_Mathpow(this[13],2)+_Mathpow(this[14],2)+_Mathpow(this[15],2))}}l.a=p},function(o,l,n){'use strict';var d=n(1);l.a=class{constructor(p,m){this.geom=p,this.program=m,this.uniforms=[],this.globalUniforms=[],this.textures=[],this.localCalls=[],this.globalCalls=[],this.order=1,this.visible=!0,this.depthTest=!1,this._isInitialized=!1}addUniform(p){this.uniforms.push(p)}rmUniform(p){const m=this.uniforms.indexOf(p);-1<m&&this.uniforms.splice(m,1)}addGlobalUniform(p){this.globalUniforms.push(p)}rmGlobalUniform(p){const m=this.globalUniforms.indexOf(p);-1<m&&this.globalUniforms.splice(m,1)}addTexture(p){this.textures.push(p)}rmTexture(p){const m=this.textures.indexOf(p);-1<m&&this.textures.splice(m,1)}isInitialized(){let p=this._isInitialized;if(p)return p;this.program.isInitialized()||(p=!1);for(const m of this.geom.attributes)m.isInitialized()||(p=!1);for(const m of this.geom.buffers)m.isInitialized()||(p=!1);for(const m of this.textures)m.isInitialized()||(p=!1);return p}_setCalls(p){const m=this.program;for(const I of this.geom.attributes){const T=m.getAttribLocation(p,I);this.localCalls.push(I.bind.bind(I,p,T))}for(const I of this.geom.buffers)this.localCalls.push(I.bind.bind(I,p));for(const I of this.uniforms){const T=m.getUniformLocation(p,I);this.localCalls.push(I.bind.bind(I,p,T))}for(const I of this.textures){const[T,_]=m.getTextureLocationIndex(p,I);this.localCalls.push(I.bind.bind(I,p,T,_))}for(const I of this.globalUniforms){const T=m.getUniformLocation(p,I);this.globalCalls.push(I.bind.bind(I,p,T))}}_initData(p){this.program;let I=!0;for(const T of this.geom.attributes)T.isInitialized()||T.init(p)||(I=!1);for(const T of this.geom.buffers)T.isInitialized()||T.init(p)||(I=!1);for(const T of this.textures)T.isInitialized()||T.init(p)||(I=!1);return I}dispose(){this._isInitialized=!1,this.localCalls.length=0}init(p){this.program;let I=!0;return this.program.isInitialized()?this.program.bind(p):!this.program.init(p)&&(I=!1),this._initData(p)||(I=!1),I&&1>this.localCalls.length&&this._setCalls(p),this._callOptimizer=d.a.getInstance(p),this._isInitialized=I,I}draw(p,m=[]){this._callOptimizer.optimizeDepthTest(this.depthTest)||(this.depthTest?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST));const I=this.program;if(!this._callOptimizer.optimizeProgram(I)){this.program.bind(p);for(const T of this.globalCalls)T()}for(const T of this.localCalls)T();for(const T of m)T();this.geom.display(p)}}},function(o,l,n){'use strict';var d=n(7),u=n(9);class p{constructor(){this.attributes=[],this.buffers=[],this.hasIndices=!1,this.numItems=0}addVertices(m,I,T){const _=new u.a(m);_.setArray(new Float32Array(I),34962),_.setItems(5126,T),this.attributes.push(_),1>this.numItems&&(this.numItems=I.length/T)}addIndices(m){this.hasIndices=!0;const I=new d.a;I.setArray(new Uint16Array(m),34963),I.setItems(5125,1),this.buffers.push(I),this.numItems=m.length}display(m){this.hasIndices?m.drawElements(m.TRIANGLES,this.numItems,m.UNSIGNED_SHORT,0):m.drawArrays(m.TRIANGLES,0,this.numItems)}clone(m=new p){return m.attributes=this.attributes.map((I)=>I.clone()),m.buffers=this.buffers.map((I)=>I.clone()),m.hasIndices=this.hasIndices,m.numItems=this.numItems,m}}l.a=p},function(o,l){'use strict';class d{constructor(){this.pointer=null,this.gl=null,this.arrayType=34962,this.data=null,this.arrayUsage=35044}isInitialized(){return!!this.pointer}setArray(u,p=this.arrayType,m=this.arrayUsage){this.arrayType=p,this.data=u,this.arrayUsage=m;const I=this.gl;I&&(I.bindBuffer(p,this.pointer),I.bufferData(p,u,arrayUsage))}setItems(u=5126,p=3,m=null){this.itemType=u,this.itemSize=p}init(u){const p=u.createBuffer();return u.bindBuffer(this.arrayType,p),u.bufferData(this.arrayType,this.data,this.arrayUsage),this.pointer=p,this.gl=u,!0}bind(u){u.bindBuffer(this.arrayType,this.pointer)}clone(u=new d){return u.setArray(this.data,this.arrayType,this.arrayUsage),u.setItems(this.itemType,this.itemSize),u}}l.a=d},function(o,l,n){'use strict';var d=n(1);class u{constructor(p,m={antialias:!0,stencil:!0}){this.canvas=p,this.init(p,m),this.meshs=[],this.depthTest=!0,this.sortCompare=(I,T)=>{if(I.order!==T.order)return I.order-T.order;return I.program&&T.program&&I.program!==T.program?I.program.id-T.program.id:I.textures&&T.textures&&0<I.textures.length&&0<I.textures.length?I.textures[0].id-T.textures[1].id:0},this.resize(p.width,p.height)}addMesh(p){this.meshs.push(p),p.isInitialized()||p.init(this.gl,this.uniforms)}rmMesh(p){const m=this.meshs.indexOf(p);-1<m&&this.meshs.splice(m,1)}sort(){this.meshs.sort(this.sortCompare)}resize(p,m){this.width=p,this.height=m}init(p,m){let I;try{I=p.getContext('webgl',m)||p.getContext('experimental-webgl',m)}catch(T){console.error('Could not initialise WebGL:',T.message)}I||console.error('Could not initialise WebGL'),this._callOptimizer=d.a.getInstance(I),this.gl=I}set bgColor([p,m,I,T=1]){this.gl.clearColor(p,m,I,T),this._bgColor=[p,m,I,T]}get bgColor(){return this._bgColor}draw(){const p=this.gl;this._callOptimizer.optimizeDepthTest(this.depthTest)||(this.depthTest?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST)),p.viewport(0,0,this.width,this.height),p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT|p.STENCIL_BUFFER_BIT);for(const m of this.meshs)m.visible&&(m.isInitialized()?m.draw(p):m.init(p,this.uniforms))}}l.a=u},function(o,l,n){'use strict';var d=n(7);class u extends d.a{constructor(p){super(),this.label=p}bind(p,m){super.bind(p),p.vertexAttribPointer(m,this.itemSize,this.itemType,!1,0,0)}clone(p=new u(this.label)){return p.label=this.label,super.clone(p),p}}l.a=u},function(o,l,n){'use strict';var d=n(4),u=n(0);class p extends u.a{constructor(m){super(m,35676,new d.a),this.updateNum=0,this.updated=!0,this.local=new d.a,this.parent=null}get global(){return this.update(),this._data}update(){const m=this.parent,I=null!==this.parent;if(this.updated||I&&this._parentUpdateNum!==m.updateNum){const T=this._data;I?(m.global.copy(T),T.multiply(this.local),this._parentUpdateNum=m.updateNum):this.local.copy(T),this.updateNum++,this.updated=!0}}clear(){this.local.identity(),this.updateNum++,this.updated=!0}scale(m){this.local.scale(m),this.updateNum++,this.updated=!0}translate(m){this.local.translate(m),this.updateNum++,this.updated=!0}rotate(m,I){this.local.rotate(m,I),this.updateNum++,this.updated=!0}rotateX(m){this.local.rotateX(m),this.updateNum++,this.updated=!0}rotateY(m){this.local.rotateY(m),this.updateNum++,this.updated=!0}rotateZ(m){this.local.rotateZ(m),this.updateNum++,this.updated=!0}attach(m){this.parent=m,this._parentUpdateNum=m.updateNum,this.updateNum++,this.updated=!0}detach(){this.parent=null,this.updateNum++,this.updated=!0}}l.a=p},function(o,l,n){'use strict';var d=n(4),u=n(0);class p extends u.a{constructor(){super('uPMatrix',35676,new d.a),this.fovy=45,this.near=0.1,this.far=100;const m=new d.a;this._matrix=m,this.updated=!0,this.updateNum=0,this._ratio=0,this.clear=()=>{m.identity(),this.updated=!0},this.translate=(I)=>{m.translate(I),this.updated=!0},this.scale=(I)=>{m.scale(I),this.updated=!0},this.rotate=(I,T)=>{m.rotate(I,T),this.updated=!0},this.rotateX=(I)=>{m.rotateX(I),this.updated=!0},this.rotateY=(I)=>{m.rotateY(I),this.updated=!0},this.rotateZ=(I)=>{m.rotateZ(I),this.updated=!0},this.lookAt=(I,T,_)=>{m.lookAt(I,T,_),this.updated=!0}}get data(){return this.updated&&this.update(),this._data}get ratio(){return this._ratio}set ratio(m){this._ratio=m,this.updated=!0}resize(m,I){this._ratio=m/I,this.updated=!0}update(){this._data.perspective(this.fovy*_MathPI/180,this._ratio,this.near,this.far),this._data.multiply(this._matrix),this.updated=!1,this.updateNum++}}l.a=p},,,,,function(o,l,n){'use strict';var d=n(6);const u=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],p=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];var m=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1];class I extends d.a{constructor(){super(),this.addVertices('aVertexPosition',u,3),this.addIndices(p)}addColors(T,_,P,L,U,C){const N=[T,_,P,L,U,C];let O=[];for(let D in N)for(let E=0;4>E;E++)O=O.concat(N[D]);this.addVertices('aVertexColor',O,4)}addUV(){this.addVertices('aTextureCoord',m,2)}clone(T=new I){return super.clone(T)}}l.a=I},,,,,,,,,,,,,function(o,l,n){'use strict';function d(){const q=1,B=[window.innerWidth,window.innerHeight];U.resize(B[0]*q,B[1]*q),P.width=B[0]*q,P.height=B[1]*q,L.resize(...B)}function u(){v.transform.rotate(0.01,[0,1,0.5]),A.transform.rotate(-0.1,[1.5,0.1,0.5]),M.transform.rotate(0.1,[1,0.5,-0.5]),U.draw(),requestAnimationFrame(u)}Object.defineProperty(l,'__esModule',{value:!0});var p=n(2),m=n(16),I=n(3),T=n(11),_=n(8);const P=document.body.querySelector('canvas'),L=new T.a;L.translate([0,0,-10]);const U=new _.a(P);U.bgColor=[0.5,0,0.5,1],U.depthTest=!0;const C=`      
    attribute vec3 aVertexPosition;
    attribute vec4 aVertexColor;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec4 vColor;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vColor = aVertexColor;
    }
`,N=`
    precision mediump float;

    varying vec4 vColor;

    void main(void) {
        gl_FragColor = vColor;
    }
`,O=new p.a(C,N),E=new m.a;E.addColors(...[[1,0.5,0,1],[1,0,0.5,1],[0.5,1,0,1],[0,1,0.5,1],[0.5,0,1,1],[0,0.5,1,1]]);const v=new I.a(E,O);v.addGlobalUniform(L),U.addMesh(v);const A=new I.a(E,O);A.transform.translate([-3,0,0]),A.transform.scale([0.5,0.5,0.5]),A.transform.attach(v.transform),A.addGlobalUniform(L),U.addMesh(A);const M=new I.a(E,O);M.transform.translate([0,0,-3]),M.transform.scale([0.5,0.5,0.5]),M.transform.attach(A.transform),M.addGlobalUniform(L),U.addMesh(M),window.onresize=d,d(),window.scene=U,u()}]);