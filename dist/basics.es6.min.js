var _Mathmin=Math.min,_NumberisInteger=Number.isInteger,_Mathpow=Math.pow,_MathPI=Math.PI,_Mathtan=Math.tan,_Mathcos=Math.cos,_Mathsin=Math.sin,_Mathsqrt=Math.sqrt,_Mathmax=Math.max,_Mathabs=Math.abs;(function(n){function d(u){if(o[u])return o[u].exports;var l=o[u]={i:u,l:!1,exports:{}};return n[u].call(l.exports,l,l.exports,d),l.l=!0,l.exports}var o={};return d.m=n,d.c=o,d.i=function(u){return u},d.d=function(u,l,m){d.o(u,l)||Object.defineProperty(u,l,{configurable:!1,enumerable:!0,get:m})},d.n=function(u){var l=u&&u.__esModule?function(){return u['default']}:function(){return u};return d.d(l,'a',l),l},d.o=function(u,l){return Object.prototype.hasOwnProperty.call(u,l)},d.p='',d(d.s=26)})([function(n,d){'use strict';class u{constructor(l,m,T,E=!1){this.label=l,this.type=m,this._data=T,this._init(m,E)}get data(){return this._data}set data(l){this._data=l}_init(l){switch(this.type){case 35675:{this.bind=(T,E)=>{T.uniformMatrix3fv(E,!1,this.data)};break}case 35676:{this.bind=(T,E)=>{T.uniformMatrix4fv(E,!1,this.data)};break}case 35665:{this.bind=(T,E)=>{T.uniform3f(E,...this.data)};break}case 5124:this.bind=(T,E)=>{T.uniform1i(E,this.data)};break;case-1:this.bind=(T,E)=>{T.uniform1fv(E,this.data)};break;default:console.error('Uniform type unknow: {label:',this.label,', type:',l,'}');}}}d.a=u},function(n,d){'use strict';class u{constructor(){this.lastTexture=null,this.lastProgram=null,this.lastDepthTest=!1}optimizeTexture(l){const m=this.lastTexture;return this.lastTexture=l,l===m}optimizeProgram(l){const m=this.lastProgram;return this.lastProgram=l,l===m}optimizeDepthTest(l){const m=this.lastDepthTest;return this.lastDepthTest=l,m===l}static getInstance(l){const m=u.glList.indexOf(l);if(0>m){const T=new u;return u.glList.push(l),u.list.push(T),T}return u.list[m]}}u.glList=[],u.list=[],d.a=u},function(n,d){'use strict';let u=0;d.a=class{constructor(m,T){this.vertexShaderSrc=m,this.fragmentShaderSrc=T,this.attribLocation={},this.uniformLocation={},this.textureLocation={},this.textureIndex={},this.textureNum=0,this.id=u++}isInitialized(){return!!this.pointer}init(m){this.vertexShader=this._createShader(m,35633,this.vertexShaderSrc),this.fragmentShader=this._createShader(m,35632,this.fragmentShaderSrc);const T=m.createProgram();return(m.attachShader(T,this.vertexShader),m.attachShader(T,this.fragmentShader),m.linkProgram(T),!m.getProgramParameter(T,m.LINK_STATUS))?(console.error('Shader initialization error'),!1):(m.useProgram(T),this.pointer=T,!0)}getAttribLocation(m,T){const E=T.label;if(!this.attribLocation.hasOwnProperty(E)){const _=m.getAttribLocation(this.pointer,E);return m.enableVertexAttribArray(_),this.attribLocation[E]=_,_}return this.attribLocation[E]}getUniformLocation(m,T){const E=T.label;if(!this.uniformLocation.hasOwnProperty(E)){const _=m.getUniformLocation(this.pointer,E);return this.uniformLocation[E]=_,_}return this.uniformLocation[E]}getTextureLocationIndex(m,T){const E=T.label;if(!this.textureLocation.hasOwnProperty(E)||!this.textureIndex.hasOwnProperty(E)){const _=m.getUniformLocation(this.pointer,E);return this.textureLocation[E]=_,this.textureIndex[E]=this.textureNum,[_,this.textureNum++]}return[this.textureLocation[E],this.textureIndex[E]]}bind(m){m.useProgram(this.pointer)}_createShader(m,T,E){const _=m.createShader(T);return m.shaderSource(_,E),m.compileShader(_),m.getShaderParameter(_,m.COMPILE_STATUS)?_:console.error('Une erreur est survenue au cours de la compilation du shader: '+m.getShaderInfoLog(_))}}},function(n,d,o){'use strict';var u=o(1);d.a=class{constructor(m,T){this.geom=m,this.program=T,this.uniforms=[],this.globalUniforms=[],this.textures=[],this.localCalls=[],this.globalCalls=[],this.order=1,this.visible=!0,this.depthTest=!1,this._isInitialized=!1}addUniform(m){this.uniforms.push(m)}rmUniform(m){const T=this.uniforms.indexOf(m);-1<T&&this.uniforms.splice(T,1)}addGlobalUniform(m){this.globalUniforms.push(m)}rmGlobalUniform(m){const T=this.globalUniforms.indexOf(m);-1<T&&this.globalUniforms.splice(T,1)}addTexture(m){this.textures.push(m)}rmTexture(m){const T=this.textures.indexOf(m);-1<T&&this.textures.splice(T,1)}isInitialized(){let m=this._isInitialized;if(m)return m;this.program.isInitialized()||(m=!1);for(const T of this.geom.attributes)T.isInitialized()||(m=!1);for(const T of this.geom.buffers)T.isInitialized()||(m=!1);for(const T of this.textures)T.isInitialized()||(m=!1);return m}_setCalls(m){const T=this.program;for(const E of this.geom.attributes){const _=T.getAttribLocation(m,E);this.localCalls.push(E.bind.bind(E,m,_))}for(const E of this.geom.buffers)this.localCalls.push(E.bind.bind(E,m));for(const E of this.uniforms){const _=T.getUniformLocation(m,E);this.localCalls.push(E.bind.bind(E,m,_))}for(const E of this.textures){const[_,I]=T.getTextureLocationIndex(m,E);this.localCalls.push(E.bind.bind(E,m,_,I))}for(const E of this.globalUniforms){const _=T.getUniformLocation(m,E);this.globalCalls.push(E.bind.bind(E,m,_))}}_initData(m){this.program;let E=!0;for(const _ of this.geom.attributes)_.isInitialized()||_.init(m)||(E=!1);for(const _ of this.geom.buffers)_.isInitialized()||_.init(m)||(E=!1);for(const _ of this.textures)_.isInitialized()||_.init(m)||(E=!1);return E}dispose(){this._isInitialized=!1,this.localCalls.length=0}init(m){this.program;let E=!0;return this.program.isInitialized()?this.program.bind(m):!this.program.init(m)&&(E=!1),this._initData(m)||(E=!1),E&&1>this.localCalls.length&&this._setCalls(m),this._callOptimizer=u.a.getInstance(m),this._isInitialized=E,E}draw(m,T=[]){this._callOptimizer.optimizeDepthTest(this.depthTest)||(this.depthTest?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST));const E=this.program;if(!this._callOptimizer.optimizeProgram(E)){this.program.bind(m);for(const _ of this.globalCalls)_()}for(const _ of this.localCalls)_();for(const _ of T)_();this.geom.display(m)}}},function(n,d,o){'use strict';var u=o(7),l=o(8);class m{constructor(){this.attributes=[],this.buffers=[],this.hasIndices=!1,this.numItems=0}addVertices(T,E,_){const I=new l.a(T);I.setArray(new Float32Array(E),34962),I.setItems(5126,_),this.attributes.push(I),1>this.numItems&&(this.numItems=E.length/_)}addIndices(T){this.hasIndices=!0;const E=new u.a;E.setArray(new Uint16Array(T),34963),E.setItems(5125,1),this.buffers.push(E),this.numItems=T.length}display(T){this.hasIndices?T.drawElements(T.TRIANGLES,this.numItems,T.UNSIGNED_SHORT,0):T.drawArrays(T.TRIANGLES,0,this.numItems)}clone(T=new m){return T.attributes=this.attributes.map((E)=>E.clone()),T.buffers=this.buffers.map((E)=>E.clone()),T.hasIndices=this.hasIndices,T.numItems=this.numItems,T}}d.a=m},function(n,d,o){'use strict';var u=o(3),l=o(9);class m extends u.a{constructor(T,E){super(T,E),this.depthTest=!0,this._initTransform3D()}_initTransform3D(){const T=new l.a('uMVMatrix'),E=T.data;this.transform3D=T,this.matrix4=E,this.translate=E.translate.bind(E),this.scale=E.scale.bind(E),this.rotate=E.rotate.bind(E),this.rotateX=E.rotateX.bind(E),this.rotateY=E.rotateY.bind(E),this.rotateZ=E.rotateZ.bind(E),this.lookAt=E.lookAt.bind(E),this.addUniform(T)}get position(){return this.transform3D.getTranslation()}get rotation(){return this.transform3D.getRotation()}}d.a=m},function(n,d){'use strict';function u(T,E,_,I,D,R,P,F,L,U,A,C,M,B,v,N,O){T[0]=E,T[1]=_,T[2]=I,T[3]=D,T[4]=R,T[5]=P,T[6]=F,T[7]=L,T[8]=U,T[9]=A,T[10]=C,T[11]=M,T[12]=B,T[13]=v,T[14]=N,T[15]=O}const l=1e-6;class m extends Float32Array{constructor(){super(16),this[0]=1,this[5]=1,this[10]=1,this[15]=1}clone(){const T=new m;return T.set(this),T}copy(T){return T.set(this),this}identity(){return u(this,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}add(T){return this[0]+=T[0],this[1]+=T[1],this[2]+=T[2],this[3]+=T[3],this[4]+=T[4],this[5]+=T[5],this[6]+=T[6],this[7]+=T[7],this[8]+=T[8],this[9]+=T[9],this[10]+=T[10],this[11]+=T[11],this[12]+=T[12],this[13]+=T[13],this[14]+=T[14],this[15]+=T[15],this}subtract(T){return this[0]-=T[0],this[1]-=T[1],this[2]-=T[2],this[3]-=T[3],this[4]-=T[4],this[5]-=T[5],this[6]-=T[6],this[7]-=T[7],this[8]-=T[8],this[9]-=T[9],this[10]-=T[10],this[11]-=T[11],this[12]-=T[12],this[13]-=T[13],this[14]-=T[14],this[15]-=T[15],this}multiplyScalar(T){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this[4]*=T,this[5]*=T,this[6]*=T,this[7]*=T,this[8]*=T,this[9]*=T,this[10]*=T,this[11]*=T,this[12]*=T,this[13]*=T,this[14]*=T,this[15]*=T,this}multiplyScalarAndAdd(T,E){return this[0]+=T[0]*E,this[1]+=T[1]*E,this[2]+=T[2]*E,this[3]+=T[3]*E,this[4]+=T[4]*E,this[5]+=T[5]*E,this[6]+=T[6]*E,this[7]+=T[7]*E,this[8]+=T[8]*E,this[9]+=T[9]*E,this[10]+=T[10]*E,this[11]+=T[11]*E,this[12]+=T[12]*E,this[13]+=T[13]*E,this[14]+=T[14]*E,this[15]+=T[15]*E,this}exactEquals(T){return this[0]===T[0]&&this[1]===T[1]&&this[2]===T[2]&&this[3]===T[3]&&this[4]===T[4]&&this[5]===T[5]&&this[6]===T[6]&&this[7]===T[7]&&this[8]===T[8]&&this[9]===T[9]&&this[10]===T[10]&&this[11]===T[11]&&this[12]===T[12]&&this[13]===T[13]&&this[14]===T[14]&&this[15]===T[15]}equals(T){const[E,_,I,D,R,P,F,L,U,A,C,M,B,v,N,O]=this,[k,X,H,G,V,W,Y,Z,q,K,$,Q,J,ee,te,ae]=T;return _Mathabs(E-k)<=l*_Mathmax(1,_Mathabs(E),_Mathabs(k))&&_Mathabs(_-X)<=l*_Mathmax(1,_Mathabs(_),_Mathabs(X))&&_Mathabs(I-H)<=l*_Mathmax(1,_Mathabs(I),_Mathabs(H))&&_Mathabs(D-G)<=l*_Mathmax(1,_Mathabs(D),_Mathabs(G))&&_Mathabs(R-V)<=l*_Mathmax(1,_Mathabs(R),_Mathabs(V))&&_Mathabs(P-W)<=l*_Mathmax(1,_Mathabs(P),_Mathabs(W))&&_Mathabs(F-Y)<=l*_Mathmax(1,_Mathabs(F),_Mathabs(Y))&&_Mathabs(L-Z)<=l*_Mathmax(1,_Mathabs(L),_Mathabs(Z))&&_Mathabs(U-q)<=l*_Mathmax(1,_Mathabs(U),_Mathabs(q))&&_Mathabs(A-K)<=l*_Mathmax(1,_Mathabs(A),_Mathabs(K))&&_Mathabs(C-$)<=l*_Mathmax(1,_Mathabs(C),_Mathabs($))&&_Mathabs(M-Q)<=l*_Mathmax(1,_Mathabs(M),_Mathabs(Q))&&_Mathabs(B-J)<=l*_Mathmax(1,_Mathabs(B),_Mathabs(J))&&_Mathabs(v-ee)<=l*_Mathmax(1,_Mathabs(v),_Mathabs(ee))&&_Mathabs(N-te)<=l*_Mathmax(1,_Mathabs(N),_Mathabs(te))&&_Mathabs(O-ae)<=l*_Mathmax(1,_Mathabs(O),_Mathabs(ae))}transpose(T){if(T===this){const E=T[1],_=T[2],I=T[3],D=T[6],R=T[7],P=T[11];this[1]=T[4],this[2]=T[8],this[3]=T[12],this[4]=E,this[6]=T[9],this[7]=T[13],this[8]=_,this[9]=D,this[11]=T[14],this[12]=I,this[13]=R,this[14]=P}else u(this,T[0],T[4],T[8],T[12],T[1],T[5],T[9],T[13],T[2],T[6],T[10],T[14],T[3],T[7],T[11],T[15]);return this}invert(){const[T,E,_,I,D,R,P,F,L,U,A,C,M,B,v,N]=this,O=T*R-E*D,k=T*P-_*D,X=T*F-I*D,H=E*P-_*R,G=E*F-I*R,V=_*F-I*P,W=L*B-U*M,Y=L*v-A*M,Z=L*N-C*M,q=U*v-A*B,K=U*N-C*B,$=A*N-C*v;let Q=O*$-k*K+X*q+H*Z-G*Y+V*W;return Q?(Q=1/Q,u(this,(R*$-P*K+F*q)*Q,(_*K-E*$-I*q)*Q,(B*V-v*G+N*H)*Q,(A*G-U*V-C*H)*Q,(P*Z-D*$-F*Y)*Q,(T*$-_*Z+I*Y)*Q,(v*X-M*V-N*k)*Q,(L*V-A*X+C*k)*Q,(D*K-R*Z+F*W)*Q,(E*Z-T*K-I*W)*Q,(M*G-B*X+N*O)*Q,(U*X-L*G-C*O)*Q,(R*Y-D*q-P*W)*Q,(T*q-E*Y+_*W)*Q,(B*k-M*H-v*O)*Q,(L*H-U*k+A*O)*Q),this):this}adjoint(){const[T,E,_,I,D,R,P,F,L,U,A,C,M,B,v,N]=this;return u(this,R*(A*N-C*v)-U*(P*N-F*v)+B*(P*C-F*A),-(E*(A*N-C*v)-U*(_*N-I*v)+B*(_*C-I*A)),E*(P*N-F*v)-R*(_*N-I*v)+B*(_*F-I*P),-(E*(P*C-F*A)-R*(_*C-I*A)+U*(_*F-I*P)),-(D*(A*N-C*v)-L*(P*N-F*v)+M*(P*C-F*A)),T*(A*N-C*v)-L*(_*N-I*v)+M*(_*C-I*A),-(T*(P*N-F*v)-D*(_*N-I*v)+M*(_*F-I*P)),T*(P*C-F*A)-D*(_*C-I*A)+L*(_*F-I*P),D*(U*N-C*B)-L*(R*N-F*B)+M*(R*C-F*U),-(T*(U*N-C*B)-L*(E*N-I*B)+M*(E*C-I*U)),T*(R*N-F*B)-D*(E*N-I*B)+M*(E*F-I*R),-(T*(R*C-F*U)-D*(E*C-I*U)+L*(E*F-I*R)),-(D*(U*v-A*B)-L*(R*v-P*B)+M*(R*A-P*U)),T*(U*v-A*B)-L*(E*v-_*B)+M*(E*A-_*U),-(T*(R*v-P*B)-D*(E*v-_*B)+M*(E*P-_*R)),T*(R*A-P*U)-D*(E*A-_*U)+L*(E*P-_*R)),this}determinant(){const[T,E,_,I,D,R,P,F,L,U,A,C,M,B,v,N]=this;return(T*R-E*D)*(A*N-C*v)-(T*P-_*D)*(U*N-C*B)+(T*F-I*D)*(U*v-A*B)+(E*P-_*R)*(L*N-C*M)-(E*F-I*R)*(L*v-A*M)+(_*F-I*P)*(L*B-U*M)}multiply(T){const[E,_,I,D,R,P,F,L,U,A,C,M,B,v,N,O]=this;let[k,X,H,G]=T;return this[0]=k*E+X*R+H*U+G*B,this[1]=k*_+X*P+H*A+G*v,this[2]=k*I+X*F+H*C+G*N,this[3]=k*D+X*L+H*M+G*O,k=T[4],X=T[5],H=T[6],G=T[7],this[4]=k*E+X*R+H*U+G*B,this[5]=k*_+X*P+H*A+G*v,this[6]=k*I+X*F+H*C+G*N,this[7]=k*D+X*L+H*M+G*O,k=T[8],X=T[9],H=T[10],G=T[11],this[8]=k*E+X*R+H*U+G*B,this[9]=k*_+X*P+H*A+G*v,this[10]=k*I+X*F+H*C+G*N,this[11]=k*D+X*L+H*M+G*O,k=T[12],X=T[13],H=T[14],G=T[15],this[12]=k*E+X*R+H*U+G*B,this[13]=k*_+X*P+H*A+G*v,this[14]=k*I+X*F+H*C+G*N,this[15]=k*D+X*L+H*M+G*O,this}translate([T,E,_]){return this[12]=this[0]*T+this[4]*E+this[8]*_+this[12],this[13]=this[1]*T+this[5]*E+this[9]*_+this[13],this[14]=this[2]*T+this[6]*E+this[10]*_+this[14],this[15]=this[3]*T+this[7]*E+this[11]*_+this[15],this}scale([T,E,_]){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this[4]*=E,this[5]*=E,this[6]*=E,this[7]*=E,this[8]*=_,this[9]*=_,this[10]*=_,this[11]*=_,this}rotate(T,[E,_,I]){let D=_Mathsqrt(E*E+_*_+I*I);if(_Mathabs(D)>l){D=1/D,E*=D,_*=D,I*=D;const R=_Mathsin(T),P=_Mathcos(T),F=1-P,[L,U,A,C,M,B,v,N,O,k,X,H]=this,G=E*E*F+P,V=_*E*F+I*R,W=I*E*F-_*R,Y=E*_*F-I*R,Z=_*_*F+P,q=I*_*F+E*R,K=E*I*F+_*R,$=_*I*F-E*R,Q=I*I*F+P;this[0]=L*G+M*V+O*W,this[1]=U*G+B*V+k*W,this[2]=A*G+v*V+X*W,this[3]=C*G+N*V+H*W,this[4]=L*Y+M*Z+O*q,this[5]=U*Y+B*Z+k*q,this[6]=A*Y+v*Z+X*q,this[7]=C*Y+N*Z+H*q,this[8]=L*K+M*$+O*Q,this[9]=U*K+B*$+k*Q,this[10]=A*K+v*$+X*Q,this[11]=C*K+N*$+H*Q}return this}rotateX(T){const E=_Mathsin(T),_=_Mathcos(T),I=this[4],D=this[5],R=this[6],P=this[7],F=this[8],L=this[9],U=this[10],A=this[11];return this[4]=I*_+F*E,this[5]=D*_+L*E,this[6]=R*_+U*E,this[7]=P*_+A*E,this[8]=F*_-I*E,this[9]=L*_-D*E,this[10]=U*_-R*E,this[11]=A*_-P*E,this}rotateY(T){const E=_Mathsin(T),_=_Mathcos(T),[I,D,R,P]=this,F=this[8],L=this[9],U=this[10],A=this[11];return this[0]=I*_-F*E,this[1]=D*_-L*E,this[2]=R*_-U*E,this[3]=P*_-A*E,this[8]=I*E+F*_,this[9]=D*E+L*_,this[10]=R*E+U*_,this[11]=P*E+A*_,this}rotateZ(T){const E=_Mathsin(T),_=_Mathcos(T),[I,D,R,P,F,L,U,A]=this;return this[0]=I*_+F*E,this[1]=D*_+L*E,this[2]=R*_+U*E,this[3]=P*_+A*E,this[4]=F*_-I*E,this[5]=L*_-D*E,this[6]=U*_-R*E,this[7]=A*_-P*E,this}fromTranslation(T){return u(this,1,0,0,0,0,1,0,0,0,0,1,0,T[0],T[1],T[2],1),this}fromScaling(T){return u(this,T[0],0,0,0,0,T[1],0,0,0,0,T[2],0,0,0,0,1),this}fromRotation(T,[E,_,I]){let D=_Mathsqrt(E*E+_*_+I*I);if(_Mathabs(D)>l){D=1/D,E*=D,_*=D,I*=D;const R=_Mathsin(T),P=_Mathcos(T),F=1-P;u(this,E*E*F+P,_*E*F+I*R,I*E*F-_*R,0,E*_*F-I*R,_*_*F+P,I*_*F+E*R,0,E*I*F+_*R,_*I*F-E*R,I*I*F+P,0,0,0,0,1)}return this}fromXRotation(T){const E=_Mathsin(T),_=_Mathcos(T);return u(this,1,0,0,0,0,_,E,0,0,-E,_,0,0,0,0,1),this}fromYRotation(T){const E=_Mathsin(T),_=_Mathcos(T);return u(this,_,0,-E,0,0,1,0,0,E,0,_,0,0,0,0,1),this}fromZRotation(T){const E=_Mathsin(T),_=_Mathcos(T);return u(this,_,E,0,0,-E,_,0,0,0,0,1,0,0,0,0,1),this}fromQuat(T){const[E,_,I,D]=T,R=E+E,P=_+_,F=I+I,L=E*R,U=_*R,A=_*P,C=I*R,M=I*P,B=I*F,v=D*R,N=D*P,O=D*F;return u(this,1-A-B,U+O,C-N,0,U-O,1-L-B,M+v,0,C+N,M-v,1-L-A,0,0,0,0,1),this}fromRotationTranslation(T,E){const[_,I,D,R]=T,P=_+_,F=I+I,L=D+D,U=_*P,A=_*F,C=_*L,M=I*F,B=I*L,v=D*L,N=R*P,O=R*F,k=R*L;return u(this,1-(M+v),A+k,C-O,0,A-k,1-(U+v),B+N,0,C+O,B-N,1-(U+M),0,E[0],E[1],E[2],1),this}fromRotationTranslationScale(T,E,[_,I,D]){const[R,P,F,L]=T,U=R+R,A=P+P,C=F+F,M=R*U,B=R*A,v=R*C,N=P*A,O=P*C,k=F*C,X=L*U,H=L*A,G=L*C;return u(this,(1-(N+k))*_,(B+G)*_,(v-H)*_,0,(B-G)*I,(1-(M+k))*I,(O+X)*I,0,(v+H)*D,(O-X)*D,(1-(M+N))*D,0,E[0],E[1],E[2],1),this}fromRotationTranslationScaleOrigin(T,E,_,I){const[D,R,P,F]=T,L=D+D,U=R+R,A=P+P,C=D*L,M=D*U,B=D*A,v=R*U,N=R*A,O=P*A,k=F*L,X=F*U,H=F*A,[G,V,W]=_,[Y,Z,q]=I;return u(this,(1-(v+O))*G,(M+H)*G,(B-X)*G,0,(M-H)*V,(1-(C+O))*V,(N+k)*V,0,(B+X)*W,(N-k)*W,(1-(C+v))*W,0,E[0]+Y-(this[0]*Y+this[4]*Z+this[8]*q),E[1]+Z-(this[1]*Y+this[5]*Z+this[9]*q),E[2]+q-(this[2]*Y+this[6]*Z+this[10]*q),1),this}getTranslation(T=new Float32Array(3)){return T[0]=this[12],T[1]=this[13],T[2]=this[14],T}getRotation(T=new Float32Array(4)){var E=this[0]+this[5]+this[10];if(0<E){const _=2*_Mathsqrt(E+1);T[0]=(this[6]-this[9])/_,T[1]=(this[8]-this[2])/_,T[2]=(this[1]-this[4])/_,T[3]=0.25*_}else if(this[0]>this[5]&this[0]>this[10]){const _=2*_Mathsqrt(1+this[0]-this[5]-this[10]);T[0]=0.25*_,T[1]=(this[1]+this[4])/_,T[2]=(this[8]+this[2])/_,T[3]=(this[6]-this[9])/_}else if(this[5]>this[10]){const _=_Mathsqrt(1+this[5]-this[0]-this[10]);T[0]=2*((this[1]+this[4])/_),T[1]=0.25*_,T[2]=(this[6]+this[9])/_,T[3]=(this[8]-this[2])/_}else{const _=2*_Mathsqrt(1+this[10]-this[0]-this[5]);T[0]=(this[8]+this[2])/_,T[1]=(this[6]+this[9])/_,T[2]=0.25*_,T[3]=(this[1]-this[4])/_}return T}frustrum(T,E,_,I,D,R){const P=1/(E-T),F=1/(I-_),L=1/(D-R);return u(this,2*D*P,0,0,0,0,2*D*F,0,0,(E+T)*P,(I+_)*F,(R+D)*L,-1,0,0,2*(R*D)*L,0),this}perspective(T,E,_,I){const D=1/_Mathtan(T/2),R=1/(_-I);return u(this,D/E,0,0,0,0,D,0,0,0,0,(I+_)*R,-1,0,0,2*I*_*R,0),this}perspectiveFromFieldOfView(T,E,_){const I=_Mathtan(T.upDegrees*_MathPI/180),D=_Mathtan(T.downDegrees*_MathPI/180),R=_Mathtan(T.leftDegrees*_MathPI/180),P=_Mathtan(T.rightDegrees*_MathPI/180),F=2/(R+P),L=2/(I+D);return u(this,F,0,0,0,0,L,0,0,0.5*(-(R-P)*F),0.5*((I-D)*L),_/(E-_),-1,0,0,_*E/(E-_),0),this}ortho(T,E,_,I,D,R){const P=1/(T-E),F=1/(_-I),L=1/(D-R);return u(this,-2*P,0,0,0,0,-2*F,0,0,0,0,2*L,0,(T+E)*P,(I+_)*F,(R+D)*L,1),this}lookAt(T,E,_){const[I,D,R]=T,[P,F,L]=_,[U,A,C]=E;if(_Mathabs(I-U)<l&&_Mathabs(D-A)<l&&_Mathabs(R-C)<l)return this.identity();let M=I-U,B=D-A,v=R-C,N=1/_Mathsqrt(M*M+B*B+v*v);M*=N,B*=N,v*=N;let O=F*v-L*B,k=L*M-P*v,X=P*B-F*M;N=_Mathsqrt(O*O+k*k+X*X),N?(N=1/N,O*=N,k*=N,X*=N):(O=0,k=0,X=0);let H=B*X-v*k,G=v*O-M*X,V=M*k-B*O;return N=_Mathsqrt(H*H+G*G+V*V),N?(N=1/N,H*=N,G*=N,V*=N):(H=0,G=0,V=0),u(this,O,H,M,0,k,G,B,0,X,V,v,0,-(O*I+k*D+X*R),-(H*I+G*D+V*R),-(M*I+B*D+v*R),1),this}frob(){return _Mathsqrt(_Mathpow(this[0],2)+_Mathpow(this[1],2)+_Mathpow(this[2],2)+_Mathpow(this[3],2)+_Mathpow(this[4],2)+_Mathpow(this[5],2)+_Mathpow(this[6],2)+_Mathpow(this[7],2)+_Mathpow(this[8],2)+_Mathpow(this[9],2)+_Mathpow(this[10],2)+_Mathpow(this[11],2)+_Mathpow(this[12],2)+_Mathpow(this[13],2)+_Mathpow(this[14],2)+_Mathpow(this[15],2))}}d.a=m},function(n,d){'use strict';class u{constructor(){this.pointer=null,this.gl=null,this.arrayType=34962,this.data=null,this.arrayUsage=35044}isInitialized(){return!!this.pointer}setArray(l,m=this.arrayType,T=this.arrayUsage){this.arrayType=m,this.data=l,this.arrayUsage=T;const E=this.gl;E&&(E.bindBuffer(m,this.pointer),E.bufferData(m,l,arrayUsage))}setItems(l=5126,m=3,T=null){this.itemType=l,this.itemSize=m}init(l){const m=l.createBuffer();return l.bindBuffer(this.arrayType,m),l.bufferData(this.arrayType,this.data,this.arrayUsage),this.pointer=m,this.gl=l,!0}bind(l){l.bindBuffer(this.arrayType,this.pointer)}clone(l=new u){return l.setArray(this.data,this.arrayType,this.arrayUsage),l.setItems(this.itemType,this.itemSize),l}}d.a=u},function(n,d,o){'use strict';var u=o(7);class l extends u.a{constructor(m){super(),this.label=m}bind(m,T){super.bind(m),m.vertexAttribPointer(T,this.itemSize,this.itemType,!1,0,0)}clone(m=new l(this.label)){return m.label=this.label,super.clone(m),m}}d.a=l},function(n,d,o){'use strict';var u=o(6),l=o(0);class m extends l.a{constructor(T){super(T,35676,new u.a().identity())}}d.a=m},function(n,d,o){'use strict';var u=o(1);class l{constructor(m,T={antialias:!0,stencil:!0}){this.canvas=m,this.init(m,T),this.meshs=[],this.depthTest=!0,this.sortCompare=(E,_)=>{if(E.order!==_.order)return E.order-_.order;return E.program&&_.program&&E.program!==_.program?E.program.id-_.program.id:E.textures&&_.textures&&0<E.textures.length&&0<E.textures.length?E.textures[0].id-_.textures[1].id:0},this.resize(m.width,m.height)}addMesh(m){this.meshs.push(m),m.isInitialized()||m.init(this.gl,this.uniforms)}rmMesh(m){const T=this.meshs.indexOf(m);-1<T&&this.meshs.splice(T,1)}sort(){this.meshs.sort(this.sortCompare)}resize(m,T){this.width=m,this.height=T}init(m,T){let E;try{E=m.getContext('webgl',T)||m.getContext('experimental-webgl',T)}catch(_){console.error('Could not initialise WebGL:',_.message)}E||console.error('Could not initialise WebGL'),this._callOptimizer=u.a.getInstance(E),this.gl=E}set bgColor([m,T,E,_=1]){this.gl.clearColor(m,T,E,_),this._bgColor=[m,T,E,_]}get bgColor(){return this._bgColor}draw(){const m=this.gl;this._callOptimizer.optimizeDepthTest(this.depthTest)||(this.depthTest?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST)),m.viewport(0,0,this.width,this.height),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT|m.STENCIL_BUFFER_BIT);for(const T of this.meshs)T.visible&&(T.isInitialized()?T.draw(m):T.init(m,this.uniforms))}}d.a=l},function(n,d,o){'use strict';var l=o(12);class m extends l.a{constructor(T){super(T),this.srcs=[],this.setTempColor([255,255,255,255])}setTempColor(T){this.setImg(new Uint8Array(T),1,1)}addURL(T,E=0){const _={size:E,src:T,img:null,priority:0,isImage:!0,isValid:()=>!0,init:null};_.init=(I)=>{I.bindTexture(I.TEXTURE_2D,this.pointer),I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,!0),I.texImage2D(I.TEXTURE_2D,0,6408,this.format,I.UNSIGNED_BYTE,_.img),this.img=_.img,this.initParams(I)},this.srcs.push(_)}static START_LOAD(T,E){if(0<E.length){E.sort((I,D)=>I.size===D.size?I.size-D.size:I.priority-D.priority);E.filter((I)=>I.size>=l.a.MAX_SIZE&&I.isValid(T));if(1<E.length){const I=E[0],D=E[E.length-1];m.LOAD(I,()=>{I.init(T),m.LOAD(D,()=>{D.init(T)})})}else if(0<E.length){const I=E[0];m.LOAD(I,()=>{I.init(T)})}else console.warn('The GPU can\'nt load a texture with size > ',l.a.MAX_SIZE)}else console.warn('URL of your smart texture not found')}static LOAD(T,E){if(T.isImage){const _=new Image;_.onload=()=>{E(T)},T.img=_,_.src=T.src}else{const _=new XMLHttpRequest;_.responseType='arraybuffer',_.open('GET',T.src,!0),_.onreadystatechange=()=>{_.readyState===XMLHttpRequest.DONE&&(200===_.status?(T.img=_.response,E(T)):console.error('fail to load image ',T.src,'status:',_.status,'statuc text:',_.statusText))},_.send()}}init(T,E){const _=super.init(T,E),I=this.pointer;return m.START_LOAD(T,this.srcs),_}}d.a=m},function(n,d,o){'use strict';var u=o(1);let l=0;class m{constructor(T){this.id=l++,this.label=T,this.mipmap=!0,this.img=null,this.width=null,this.height=null,this.pointer=null,this.parameters=[],this.setType(),this.setInternalFormat(),this.setFormat(),this.setTarget()}resize(T,E,_=null){this.width=T,this.height=E,_?(_.bindTexture(this.target,this.pointer),_.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img)):this.updated=!0}setTempColor(T){this.setImg(new Uint8Array(T),1,1)}setImg(T=new Uint8Array([255,255,255,255]),E=1,_=1){this.img=T,this.width=E,this.height=_}setType(T=5121){this.type=T}setInternalFormat(T=6408){this.internalFormat=T}setFormat(T=6408){this.format=T}setTarget(T=3553){this.target=T}setParam(T,E){const _=this.parameters.find((I)=>I[0]===T);-1<_?this.parameters[_][1]=E:this.parameters.push([T,E])}isInitialized(){return!!this.pointer}static IS_POWER_OF_2(T){return 0==(T&T-1)}static SET_DATA(T){m.MAX_SIZE=T.getParameter(T.MAX_TEXTURE_SIZE),m.FORMAT={};const E=T.getParameter(T.COMPRESSED_TEXTURE_FORMATS);for(let _=0;_<E.length;_++)m.FORMAT[E[_]]=!0;m._DATA_INITIALIZED=!0}setDefaultParams(T){this.mipmap?this.setParam(T.TEXTURE_MIN_FILTER,T.LINEAR_MIPMAP_LINEAR):(this.setParam(T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),this.setParam(T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),this.setParam(T.TEXTURE_MIN_FILTER,T.LINEAR))}initParams(T){if(this.mipmap){const E=this.img;null===E?console.warn('You need an image to set the parameters of texture'):m.IS_POWER_OF_2(E.width)&&m.IS_POWER_OF_2(E.height)?T.generateMipmap(this.target):(this.mipmap=!1,console.warn('You need a power of 2 for the size of the mipmaped texture'))}1>this.parameters.length&&this.setDefaultParams(T);for(const[E,_]of this.parameters)T.texParameteri(this.target,E,_)}init(T){const E=T.createTexture();return m._DATA_INITIALIZED||m.SET_DATA(T),T.bindTexture(this.target,E),T.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.initParams(T),this._callOptimizer=u.a.getInstance(T),this.pointer=E,!0}bind(T,E,_){this._callOptimizer.optimizeTexture(this)||(T.uniform1i(E,_),T.activeTexture(T.TEXTURE0+_),T.bindTexture(this.target,this.pointer),this.updated&&(T.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.updated=!1))}free(T){T.bindTexture(T.TEXTURE_2D,null)}}d.a=m},function(n,d,o){'use strict';var u=o(6),l=o(0);class m extends l.a{constructor(){super('uPMatrix',35676,new u.a),this.fovy=45,this.near=0.1,this.far=100;const T=new u.a;this._matrix=T,this.updated=!0,this.updateNum=0,this._ratio=0,this.clear=()=>{T.identity(),this.updated=!0},this.translate=(E)=>{T.translate(E),this.updated=!0},this.scale=(E)=>{T.scale(E),this.updated=!0},this.rotate=(E,_)=>{T.rotate(E,_),this.updated=!0},this.rotateX=(E)=>{T.rotateX(E),this.updated=!0},this.rotateY=(E)=>{T.rotateY(E),this.updated=!0},this.rotateZ=(E)=>{T.rotateZ(E),this.updated=!0},this.lookAt=(E,_,I)=>{T.lookAt(E,_,I),this.updated=!0}}get data(){return this.updated&&this.update(),this._data}get ratio(){return this._ratio}set ratio(T){this._ratio=T,this.updated=!0}resize(T,E){this._ratio=T/E,this.updated=!0}update(){this._data.perspective(this.fovy*_MathPI/180,this._ratio,this.near,this.far),this._data.multiply(this._matrix),this.updated=!1,this.updateNum++}}d.a=m},function(n,d,o){'use strict';var u=o(3),l=o(4),m=o(0),T=o(28);class E extends u.a{constructor(_,I='aVertexPosition',D='uSample'){const R=new l.a;R.addVertices(I,[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1],2),super(R,_)}resize(_,I){this.uWidth&&(this.uWidth.data=_),this.uHeight&&(this.uHeight.data=I)}useUWidth(_,I){const D=new m.a(_,5124,I);this.uWidth=D,this.addUniform(D)}useUHeight(_,I){const D=new m.a(_,5124,I);this.uHeight=D,this.addUniform(D)}useColorTexture(_){const I=new T.a(_);this.inColorTexture=I,this.addTexture(I)}useDepthTexture(_,I){const D=new T.a(_);this.inDepthTexture=D,this.addTexture(D);const R=new m.a(I,5124,1);this._inDetpthEnableUniform=R,this.addUniform(R)}setDepthTexture(_,I){this.rmTexture(this.inDepthTexture),_&&this.addTexture(this.inDepthTexture),this._inDetpthEnableUniform.data=_?1:0;const D=this.globalUniforms;this.dispose(),this.init(I,D)}}d.a=E},function(n,d){'use strict';function u(T,E,_,I,D,R,P,F,L,U){T[0]=E,T[1]=_,T[2]=I,T[3]=D,T[4]=R,T[5]=P,T[6]=F,T[7]=L,T[8]=U}const l=1e-6;class m extends Float32Array{constructor(){super(9),this[0]=1,this[4]=1,this[8]=1}fromMarix4(T){this.setMat(this,T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7],T[8])}clone(){const T=new m;return T.set(this),T}copy(T){return T.set(this),this}identity(){return u(this,1,0,0,0,1,0,0,0,1),this}add(T){return this[0]+=T[0],this[1]+=T[1],this[2]+=T[2],this[3]+=T[3],this[4]+=T[4],this[5]+=T[5],this[6]+=T[6],this[7]+=T[7],this[8]+=T[8],this}subtract(T){return this[0]-=T[0],this[1]-=T[1],this[2]-=T[2],this[3]-=T[3],this[4]-=T[4],this[5]-=T[5],this[6]-=T[6],this[7]-=T[7],this[8]-=T[8],this}multiplyScalar(T){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this[4]*=T,this[5]*=T,this[6]*=T,this[7]*=T,this[8]*=T,this}multiplyScalarAndAdd(T,E){return this[0]+=T[0]*E,this[1]+=T[1]*E,this[2]+=T[2]*E,this[3]+=T[3]*E,this[4]+=T[4]*E,this[5]+=T[5]*E,this[6]+=T[6]*E,this[7]+=T[7]*E,this[8]+=T[8]*E,this}exactEquals(T){return this[0]===T[0]&&this[1]===T[1]&&this[2]===T[2]&&this[3]===T[3]&&this[4]===T[4]&&this[5]===T[5]&&this[6]===T[6]&&this[7]===T[7]&&this[8]===T[8]}equals(T){const[E,_,I,D,R,P,F,L,U]=this,[A,C,M,B,v,N,O,k,X]=T;return _Mathabs(E-A)<=l*_Mathmax(1,_Mathabs(E),_Mathabs(A))&&_Mathabs(_-C)<=l*_Mathmax(1,_Mathabs(_),_Mathabs(C))&&_Mathabs(I-M)<=l*_Mathmax(1,_Mathabs(I),_Mathabs(M))&&_Mathabs(D-B)<=l*_Mathmax(1,_Mathabs(D),_Mathabs(B))&&_Mathabs(R-v)<=l*_Mathmax(1,_Mathabs(R),_Mathabs(v))&&_Mathabs(P-N)<=l*_Mathmax(1,_Mathabs(P),_Mathabs(N))&&_Mathabs(F-O)<=l*_Mathmax(1,_Mathabs(F),_Mathabs(O))&&_Mathabs(L-k)<=l*_Mathmax(1,_Mathabs(L),_Mathabs(k))&&_Mathabs(U-X)<=l*_Mathmax(1,_Mathabs(U),_Mathabs(X))}transpose(T){if(T===this){const E=T[1],_=T[2],I=T[5];this[1]=T[3],this[2]=T[6],this[3]=E,this[5]=T[7],this[6]=_,this[7]=I}else u(this,T[0],T[4],T[6],T[1],T[4],T[5],T[2],T[7],T[8]);return this}invert(){const[T,E,_,I,D,R,P,F,L]=this,A=R*P-L*I,C=P*D-F*I;let M=T*b01+E*A+_*C;return M?(M=1/M,u(this,b01*M,(-L*E+_*F)*M,(R*E-_*D)*M,A*M,(L*T-_*P)*M,(-R*T+_*I)*M,C*M,(-F*T+E*P)*M,(D*T-E*I)*M),this):this}adjoint(){const[T,E,_,I,D,R,P,F,L]=this;return u(this,D*L-R*F,_*F-E*L,E*R-_*D,R*P-I*L,T*L-_*P,_*I-T*R,I*F-D*P,E*P-T*F,T*D-E*I),this}determinant(){const[T,E,_,I,D,R,P,F,L]=this;return T*(L*D-R*F)+E*(-L*I+R*P)+_*(F*I-D*P)}multiply(T){const[E,_,I,D,R,P,F,L,U]=this;let[A,C,M,B,v,N,O,k,X]=T;return u(this,A*E+C*D+M*F,A*_+C*R+M*L,A*I+C*P+M*U,B*E+v*D+N*F,B*_+v*R+N*L,B*I+v*P+N*U,O*E+k*D+X*F,O*_+k*R+X*L,O*I+k*P+X*U),this}translate([T,E]){const[_,I,D,R,P,F,L,U,A]=this;return this[6]=T*_+E*R+L,this[7]=T*I+E*P+U,this[8]=T*D+E*F+A,console.log(T,E,'-->',this[6],this[7],this[8]),this}rotate(T){const[E,_,I,D,R,P,F,L,U]=this,A=_Mathsin(T),C=_Mathcos(T);return this[0]=C*E+80*D,this[1]=C*a080801+A*R,this[2]=C*I+A*P,this[3]=C*D-A*E,this[4]=C*R-A*_,this[5]=C*P-A*I,this}scale([T,E]){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=E,this[4]*=E,this[5]*=E,this}fromTranslation(T){return u(this,1,0,0,0,1,0,T[0],T[1],1),this}fromScaling(T){return u(this,T[0],0,0,0,T[1],0,0,0,1),this}fromMatrix2(T){return u(this,T[0],T[1],0,T[2],T[3],0,T[4],T[5],1),out}fromQuat(T){const[E,_,I,D]=T,R=E+E,P=_+_,F=I+I,L=E*R,U=_*R,A=_*P,C=I*R,M=I*P,B=I*F,v=D*R,N=D*P,O=D*F;return u(this,1-A-B,U-O,C+N,U+O,1-L-B,M-v,C-N,M+v,1-L-A),this}normalFromMatrix4(){const[E,_,I,D,R,P,F,L,U,A,C,M,B,v,N,O]=this,k=E*P-_*R,X=E*F-I*R,H=E*L-D*R,G=_*F-I*P,V=_*L-D*P,W=I*L-D*F,Y=U*v-A*B,Z=U*N-C*B,q=U*O-M*B,K=A*N-C*v,$=A*O-M*v,Q=C*O-M*N;let J=k*Q-X*$+H*K+G*q-V*Z+W*Y;return J?(J=1/J,u(this,(P*Q-F*$+L*K)*J,(F*q-R*Q-L*Z)*J,(R*$-P*q+L*Y)*J,(I*$-_*Q-D*K)*J,(E*Q-I*q+D*Z)*J,(_*q-E*$-D*Y)*J,(v*W-N*V+O*G)*J,(N*H-B*W-O*X)*J,(B*V-v*H+O*k)*J),this):null}frob(){return _Mathsqrt(_Mathpow(this[0],2)+_Mathpow(this[1],2)+_Mathpow(this[2],2)+_Mathpow(this[3],2)+_Mathpow(this[4],2)+_Mathpow(this[5],2)+_Mathpow(this[6],2)+_Mathpow(this[7],2)+_Mathpow(this[8],2))}}d.a=m},function(n,d,o){'use strict';var u=o(5);class l extends u.a{constructor(m,T){super(m,T),this.depthTest=!1,this.order=-1}}d.a=l},function(n,d,o){'use strict';var u=o(1);d.a=class{constructor(){this.meshs=[],this.order=0,this.visible=!0,this.mask=null,this._isInitialized=!1,this.sortCompare=(m,T)=>{if(m.order!==T.order)return m.order-T.order;return m.program&&T.program&&m.program!==T.program?m.program.id-T.program.id:m.textures&&T.textures&&0<m.textures.length&&0<m.textures.length?m.textures[0].id-T.textures[1].id:0}}setMask(m){this.mask=m}addMesh(m){this.meshs.push(m)}rmMesh(){const m=this.meshs.indexOf(mesh);-1<m&&this.meshs.splice(m,1)}sort(){this.meshs.sort(this.sortCompare)}isInitialized(){if(null!==this.mask&&!this.mask.isInitialized())return!1;for(const m of this.meshs)if(!m.isInitialized())return!1;return!0}dispose(){for(const m of this.meshs)m.dispose();return!0}init(m){let T=!0;null!==this.mask&&this.mask.init(m);for(const E of this.meshs)E.init(m)||(T=!1);return this._callOptimizer=u.a.getInstance(m),T}draw(m,T=[]){this.mask&&this.mask.before(m);for(const E of this.meshs)E.draw(m,T);this.mask&&this.mask.after(m)}}},function(n,d,o){'use strict';var u=o(1);d.a=class{constructor(m){this.mesh=m,this.setMaskFunc(519,1,255),this.setDisplayFunc(517,0,255)}setMaskFunc(m,T,E){this.maskFunc=m,this.maskRef=T,this.maskMask=E}setDisplayFunc(m,T,E){this.displayFunc=m,this.displayRef=T,this.displayMask=E}isInitialized(){return this.mesh.isInitialized()}init(m){this.mesh.init(m),this._callOptimizer=u.a.getInstance(m)}before(m,T=[]){m.enable(m.STENCIL_TEST),m.depthMask(!1),m.clear(m.STENCIL_BUFFER_BIT),m.colorMask(!1,!1,!1,!1),m.stencilOp(m.KEEP,m.KEEP,m.INCR),m.stencilFunc(this.maskFunc,this.maskRef,this.maskMask),this.mesh.draw(m,T),this._callOptimizer.optimizeProgram(null),m.stencilFunc(this.displayFunc,this.displayRef,this.displayMask),m.depthMask(!0),m.colorMask(!0,!0,!0,!0),m.stencilOp(m.KEEP,m.KEEP,m.KEEP)}after(m){m.disable(m.STENCIL_TEST)}}},function(n,d,o){'use strict';var u=o(3),l=o(29);class m extends u.a{constructor(T,E){super(T,E),this.depthTest=!1,this._initTransform2D()}_initTransform2D(){const T=new l.a('uMVMatrix'),E=T.data;this.transform2D=T,this.matrix3=E,this.translate=E.translate.bind(E),this.scale=E.scale.bind(E),this.rotate=E.rotate.bind(E),this.addUniform(T)}get position(){return this.transform2D.getTranslation()}get rotation(){return this.transform2D.getRotation()}}d.a=m},function(n,d,o){'use strict';var u=o(6),l=o(0);const m=new Float32Array(3);class T extends l.a{constructor(E,_,I=1){super(E,35676,new u.a),this.camera3D=_,this.updateNum=-1,this.distance=I}get data(){return this.updateNum!==this.camera3D.updateNum&&this.update(),this._data}update(){const E=this.camera3D,_=E._matrix;_.getTranslation(m),m[0]=-m[0]*this.distance,m[1]=-m[1]*this.distance,m[2]=-m[2]*this.distance,this._data.perspective(E.fovy*_MathPI/180,E.ratio,E.near,E.far),this._data.translate(m),this._data.multiply(_),this.updateNum=this.camera3D.updateNum}}d.a=T},function(n,d,o){'use strict';var u=o(15),l=o(0);class m extends l.a{constructor(){super('uPMatrix',35675,new u.a),this._matrix=new u.a,this.updated=!0,this.updateNum=0,this._minX=-1,this._maxX=1,this._minY=-1,this._maxY=1,this.clear=()=>{matrix.identity(),this.updated=!0},this.translate=(T)=>{matrix.translate(T),this.updated=!0},this.scale=(T)=>{matrix.scale(T),this.updated=!0},this.rotate=(T)=>{matrix.rotate(T),this.updated=!0}}get data(){return this.updated&&this.update(),this._data}setArea(T,E,_,I){this._minX=T,this._minY=E,this._maxX=_,this._maxY=I,this.updated=!0}update(){this._data.identity();const T=this._maxX-this._minX,E=this._maxY-this._minY;this._data.scale([1/T,1/E]),this._data.multiply(this._matrix),this.updated=!1,this.updateNum++}}d.a=m},function(n,d,o){'use strict';var u=o(32);d.a=class{constructor(m){this.screenRecorder=new u.a(m.width,m.height,!0,!0),this.scene=m,this.passList=[],this.isEnable=!1,this.init(m.gl)}isInitialized(){return this.screenRecorder.isInitialized()}resize(m,T){this.scene.resize(m,T),this.screenRecorder.resize(m,T,this.scene.gl);for(const E of this.passList)E.resize(m,T)}_disableDepthInTexture(m,T){m.inDepthTexture&&m.setDepthTexture(!1,T)}init(m){if(this.screenRecorder.init(m),!this.screenRecorder.depthTexture)for(const T of this.passList)this._disableDepthInTexture(T,m);return!0}addPass(m){m.init(this.scene.gl,[]),this.screenRecorder.isInitialized()&&!this.screenRecorder.depthTexture&&this._disableDepthInTexture(m,this.scene.gl),m.uWidth&&(m.uWidth.data=this.scene.width),m.uHeight&&(m.uHeight.data=this.scene.height),this.passList.push(m),this.isEnable=!0}removePass(m){const T=this.passList.indexOf(m);-1<T&&this.passList.splice(T,1),this.isEnable=0<this.passList.length}draw(){const m=this.scene.gl,T=this.passList.length;if(0<T){this.screenRecorder.start(m,!0),this.scene.draw(),this.screenRecorder.stop(m),this.screenRecorder.pingpong();for(let E=0;E<T;E++){const _=this.passList[E],I=E>T-2;I||this.screenRecorder.start(m,!1),this.screenRecorder.pingpong(),_.inColorTexture&&_.inColorTexture.setTexture(this.screenRecorder.colorTexture),_.inDepthTexture&&this.screenRecorder.depthTexture&&_.inDepthTexture.setTexture(this.screenRecorder.depthTexture),_.draw(m),this.screenRecorder.stop(m)}}else this.scene.draw()}}},function(n,d,o){'use strict';function u(D){return _NumberisInteger(D)?D.toFixed(1):D}var l=o(14),m=o(2),T=o(0);const E=`
    attribute vec3 aVertexPosition;
    varying vec2 vTextureCoord;

    void main(void)
    {
        vTextureCoord = vec2(aVertexPosition.x * 0.5 + 0.5, aVertexPosition.y * 0.5 + 0.5);
        gl_Position = vec4(aVertexPosition, 1.0);
    }`,_=`
    precision mediump float;
    varying vec2 vTextureCoord;
    uniform sampler2D uColor;
    uniform sampler2D uDepth;

    uniform vec3 uColorFog;
    
    uniform int uDepthEnable;

    void main(void)
    {
        $chunkcall
        gl_FragColor = color;
    }`;class I extends l.a{constructor({minDepth:D=0.1,maxDepth:R=0.2,minPower:P=0.2,maxPower:F=1,depthCurve:L=100,color:U=[1,1,1]}){super(null,'aVertexPosition','uColor'),this.useColorTexture('uColor'),this.useDepthTexture('uDepth','uDepthEnable');const A=new T.a('uColorFog',35665,U);this.addUniform(A);const C=this._initFragmentShader(D,R,P,F,L);this.program=new m.a(E,C)}_initFragmentShader(D,R,P,F,L){let U=`
            float depthValue = 0.0;
            if (uDepthEnable >= 0) {
                vec4 depth = texture2D(uDepth, vTextureCoord.xy);
                depthValue = pow(depth.x, ${u(L)});
                depthValue = (depthValue - ${u(D)}) / ${u(R-D)};
                depthValue = clamp(depthValue, ${u(P)}, ${u(F)});
            }
            vec4 originalColor = texture2D(uColor, vTextureCoord.xy); 
            vec4 color = vec4(mix(originalColor.xyz, uColorFog, depthValue), originalColor.w);
        `;const A=_.replace('$chunkcall',U);return A}}d.a=I},function(n,d,o){'use strict';function u(D){return _NumberisInteger(D)?D.toFixed(1):D}var l=o(14),m=o(2),T=o(0);const E=`
    attribute vec3 aVertexPosition;
    varying vec2 vTextureCoord;

    void main(void)
    {
        vTextureCoord = vec2(aVertexPosition.x * 0.5 + 0.5, aVertexPosition.y * 0.5 + 0.5);
        gl_Position = vec4(aVertexPosition, 1.0);
    }`,_=`
    precision mediump float;
    varying vec2 vTextureCoord;
    uniform sampler2D uColor;
    uniform sampler2D uDepth;
    uniform int uSize;
    uniform int uDepthEnable;

    $chunkfct

    void main(void)
    {
        $chunkcall
        gl_FragColor = color;
    }`;class I extends l.a{constructor({minDepth:D=0.1,maxDepth:R=0.2,samples:P=5,xBlur:F=!0,power:L=1,depthCurve:U=100}){super(null,'aVertexPosition','uColor'),this.power=L,this.xBlur=F,this.depthCurve=U,this.useColorTexture('uColor'),this.useDepthTexture('uDepth','uDepthEnable');const A=this._initFragmentShader(D,R,P);this.program=new m.a(E,A),F?this.useUWidth('uSize',1):this.useUHeight('uSize',1)}_initFragmentShader(D=0.1,R=0.3,P=5){const F=this.xBlur,L=u(this.power),U=[];for(let B=0;B<P;B++){const v=this._getKernels(B+1);U.push(v)}let A='';for(let B=0;B<U.length;B++){const v=U[B];A+=`
            vec4 blur${B+1}(sampler2D i, vec2 uv) {
                vec2 m;
                vec4 color = texture2D(i, uv) * ${u(v[0])};`;for(let N=1;N<v.length;N++)A+=`
                m = ${F?'vec2('+N+'.0 * '+L+' / float(uSize), 0.0)':'vec2(0.0, '+N+'.0 * '+L+' / float(uSize))'};
                color += texture2D(i, uv + m) * ${u(v[N])};
                color += texture2D(i, uv - m) * ${u(v[N])};`;A+='return color; }'}let C=`
            float depthValue = 0.0;
            vec4 color;
            if (uDepthEnable >= 0) {
                vec4 depth = texture2D(uDepth, vTextureCoord.xy);
                depthValue = pow(depth.x, ${u(this.depthCurve)});
                
                int blurPower = int(floor(0.5 + (depthValue - ${u(D)}) * ${u(P)} / ${u(R-D)}));   
        `;for(let B=0;B<P;B++){const v='blurPower'+(B>P-2?' >= '+B:1>B?' < 1':' == '+B);C+=`${0<B?' else if':'if'} ( ${v}) {
                color = blur${B+1}(uColor, vTextureCoord.xy);
            }`}C+=`
        } else {
            color = texture2D(uColor, vTextureCoord.xy);
        }
        `;const M=_.replace('$chunkfct',A).replace('$chunkcall',C);return M}_getKernels(D){const R=[];let P=0;for(let F=1;F<D+2;F++){const L=3*(F-1)/D,U=Math.exp(-L*L);P+=2>F?U:U+U,R.push(U)}for(let F=0;F<R.length;F++)R[F]/=P;return R}}d.a=I},,function(n,d,o){'use strict';function u(He=null){let Ge=0;He&&(He.wheelDelta?Ge=He.wheelDelta:He.detail?Ge=-40*He.detail:He.deltaY&&(Ge=-40*He.deltaY)),Oe-=Ge/1e3,Oe=_Mathmin(_Mathmax(Oe,0.37),3),Z.fovy=45*Oe}function m(He){const Ge=He.clientX,Ve=He.clientY,We=(Ge-Xe[0])/ke[0],Ye=(Ve-Xe[1])/ke[1];Xe[0]=Ge,Xe[1]=Ve,ve+=2*(We*_MathPI),Ne+=Ye*_MathPI,Ne=_Mathmax(_Mathmin(Ne,0.3*_MathPI),0.3*-_MathPI)}function T(){const Ge=document.body;Ge.removeEventListener('mousemove',m),Ge.removeEventListener('mouseup',T),Ge.removeEventListener('mouseleave',T),Ge.classList.remove('is-grabbing')}function E(){const He=1;ke[0]=window.innerWidth,ke[1]=window.innerHeight,K.resize(ke[0]*He,ke[1]*He),Y.width=ke[0]*He,Y.height=ke[1]*He,Z.resize(...ke),q.setArea(0,0,...ke)}function _(){Z.clear(),Z.translate([0,0,-Oe]),Z.rotate(Ne,[1,0,0]),Z.rotate(ve,[0,1,0]),se.rotateY(5e-3),Ee.rotate(-5e-3,[0,1,0]),xe.rotate(0.01,[0,1,0]),Le.rotate(-0.01,[0,1,0]),Ue.rotate(0.025,[0.72,-0.33,0.5]),K.draw(),requestAnimationFrame(_)}Object.defineProperty(d,'__esModule',{value:!0});var I=o(0),D=o(9),R=o(20),P=o(8),F=o(2),L=o(4),U=o(11),A=o(3),C=o(19),M=o(5),B=o(17),v=o(18),N=o(16),O=o(21),k=o(13),X=o(10),H=o(14),G=o(22),V=o(24),W=o(23);const Y=document.body.querySelector('canvas'),Z=new k.a,q=new O.a,K=new X.a(Y);K.bgColor=[0,0,0.1,1],K.depthTest=!0;const $=`      
    attribute vec3 aVertexPosition;
    attribute vec4 aVertexColor;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec4 vColor;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vColor = aVertexColor;
    }
`,Q=`
    precision mediump float;

    varying vec4 vColor;

    void main(void) {
        gl_FragColor = vColor;
    }
`,J=new F.a($,Q),ee=`
    attribute vec3 aVertexPosition;
    attribute vec4 aVertexColor;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec4 vColor;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        float zDepth = 0.2 * (8.0 - gl_Position.z);
        vec4 modifyColor = vec4(aVertexColor.rgb * zDepth, aVertexColor.a);
        vColor = modifyColor;
    }
`,te=new F.a(ee,Q),ie=new L.a;ie.addVertices('aVertexPosition',[0,1,0,-1,-1,1,1,-1,1,0,1,0,1,-1,1,1,-1,-1,0,1,0,1,-1,-1,-1,-1,-1,0,1,0,-1,-1,-1,-1,-1,1],3),ie.addVertices('aVertexColor',[1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,1,0,1],4);const se=new M.a(ie,J);se.translate([-1.5,-1.5,0]),se.addGlobalUniform(Z);const ne=`      
    attribute vec2 aVertexPosition;

    uniform mat3 uMVMatrix;
    uniform mat3 uPMatrix;

    varying vec2 vTextureCoord;

    void main(void) {
        vec3 pos = uPMatrix * uMVMatrix * vec3(aVertexPosition, 0.0);
        gl_Position = vec4(pos.xy, 0.0, 1.0);
    }
`,de=`
    precision mediump float;

    uniform sampler2D uDiffuse1;

    void main(void) {
        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
    }
`,oe=new F.a(ne,de),me=new L.a;me.addVertices('aVertexPosition',[-1,-1,-1,1,1,-1,-1,1,1,1,1,-1],2);const pe=new C.a(me,oe);pe.order=1,pe.scale([320,320]),pe.addGlobalUniform(q);const fe=new B.a;fe.addMesh(se),K.addMesh(fe),fe.setMask(new v.a(pe));const he=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],be=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],ge=[[1,0,0,1],[1,1,0,1],[0,1,0,1],[1,0.5,0.5,1],[1,0,1,1],[0,0,1,1]];let ce=[];for(let He in ge)for(let Ge=0;4>Ge;Ge++)ce=ce.concat(ge[He]);const Te=new L.a;Te.addVertices('aVertexPosition',he,3),Te.addVertices('aVertexColor',ce,4),Te.addIndices(be);const xe=new M.a(Te,te);xe.translate([1.5,-1.5,0]),xe.addGlobalUniform(Z),K.addMesh(xe);const Ee=new M.a(ie,J);Ee.translate([-1.5,1.5,0]),Ee.scale([1,-1,1]),Ee.addGlobalUniform(Z),K.addMesh(Ee);const _e=`   
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec2 vTextureCoord;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vTextureCoord = aTextureCoord;
    }`,Ie=`
    precision mediump float;

    varying vec2 vTextureCoord;

    uniform sampler2D uDiffuse1;
    uniform sampler2D uDiffuse2;

    void main(void) {
        vec4 color1 = texture2D(uDiffuse1, vec2(vTextureCoord.s, vTextureCoord.t));
        vec4 color2 = texture2D(uDiffuse2, vec2(vTextureCoord.s, vTextureCoord.t));
        float power = ((sin(vTextureCoord.s * 3.1415)) * (sin(vTextureCoord.t * 3.1415)));
        gl_FragColor = mix(color1, color2, power);
    }`,De=new F.a(_e,Ie);const Pe=new U.a('uDiffuse1');Pe.addURL('assets/cube-diffuse.jpg');const Fe=new U.a('uDiffuse2');Fe.setParam(10240,9728),Fe.setParam(10241,9728),Fe.addURL('assets/cube-diffuse-2.png');const we=new L.a;we.addVertices('aVertexPosition',he,3),we.addVertices('aTextureCoord',[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],2),we.addIndices(be);const Le=new M.a(we,De);Le.addTexture(Pe),Le.addTexture(Fe),Le.translate([1.5,1.5,0]),Le.addGlobalUniform(Z),K.addMesh(Le);const Ue=new M.a(we,De);Ue.addTexture(Pe),Ue.addTexture(Fe),Ue.translate([0,0,-8]),Ue.addGlobalUniform(Z),K.addMesh(Ue);const ye=`   
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec2 vTextureCoord;

    void main(void) {

        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vTextureCoord = aTextureCoord;
    }`,Ae=`
    precision mediump float;

    varying vec2 vTextureCoord;

    uniform sampler2D uDiffuse1;

    void main(void) {
        vec4 color1 = texture2D(uDiffuse1, vec2(vTextureCoord.s, vTextureCoord.t));
        gl_FragColor = color1;
    }`,Se=new R.a('uPMatrix',Z,1),Ce=new F.a(ye,Ae),Me=new N.a(we,Ce);Me.addTexture(Pe),Me.addUniform(Se),K.addMesh(Me),K.sort();const ze=!1;let Be;let ve=0,Ne=0,Oe=2.5;const ke=[0,0],Xe=[0,0];document.body.addEventListener('mousedown',function(He){const Ge=document.body;Xe[0]=He.clientX,Xe[1]=He.clientY,Ge.removeEventListener('mousemove',m),Ge.removeEventListener('mouseup',T),Ge.removeEventListener('mouseleave',T),Ge.addEventListener('mousemove',m),Ge.addEventListener('mouseup',T),Ge.addEventListener('mouseleave',T),Ge.classList.add('is-grabbing')}),window.addEventListener('wheel',u),window.onresize=E,E(),u(),window.scene=K,window.passManager=Be,_()},,function(n,d){'use strict';d.a=class{constructor(l){this.label=l}isInitialized(){return!0}init(){return!0}setTexture(l){this.pointer=l.pointer,this.target=l.target}bind(l,m,T){l.uniform1i(m,T),l.activeTexture(l.TEXTURE0+T),l.bindTexture(this.target,this.pointer)}}},function(n,d,o){'use strict';var u=o(15),l=o(0);class m extends l.a{constructor(T){super(T,35675,new u.a().identity())}}d.a=m},function(n,d){'use strict';d.a=class{constructor(){this.pointer=null}isInitialized(){return!!this.pointer}init(l){const m=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,m),this.pointer=m,!0}bind(l){l.bindFramebuffer(l.FRAMEBUFFER,this.pointer)}free(l){l.bindFramebuffer(l.FRAMEBUFFER,null)}}},function(n,d){'use strict';d.a=class{constructor(l,m){this.pointer=null,this.width=l,this.height=m}resize(l,m,T=null){this.width=l,this.height=m,T?(T.bindRenderbuffer(T.RENDERBUFFER,this.pointer),T.renderbufferStorage(T.RENDERBUFFER,T.DEPTH_COMPONENT16,l,m)):this.updated=!0}isInitialized(){return!!this.pointer}init(l){const m=l.createRenderbuffer();l.bindRenderbuffer(l.RENDERBUFFER,m),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,this.width,this.height),this.pointer=m}bind(l){l.bindRenderbuffer(l.RENDERBUFFER,renderBuffer),this.updated&&(l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,this.width,this.height),this.updated=!1)}}},function(n,d,o){'use strict';var u=o(12),l=o(31),m=o(30);class T{constructor(E,_,I=!0,D=!1){this.captureDepth=I,this.recordDepth=D,this.width=E,this.height=_,this.updated=!1,this._pingpong=!1,this._colorTextures=[this._genColorTexture('frameBufferColor0',E,_),this._genColorTexture('frameBufferColor1',E,_)],this.frameBuffer=new m.a}_genDepthTexture(E,_,I){const D=new u.a;return D.mipmap=!1,D.setInternalFormat(6402),D.setFormat(6402),D.setType(5123),D.setParam(10242,33071),D.setParam(10243,33071),D.setParam(10241,9728),D.setParam(10240,9728),D.setImg(null,_,I),D}_genColorTexture(E,_,I){const D=new u.a(E);return D.mipmap=!1,!1,D.setImg(null,_,I),D}pingpong(){this._pingpong=!this._pingpong}get colorTexture(){return this._colorTextures[this._pingpong?1:0]}resize(E,_,I){this.width=E,this.height=_,this.pingpong(),this.colorTexture.resize(E,_,I),this.pingpong(),this.colorTexture.resize(E,_,I),this.depthTexture&&this.depthTexture.resize(E,_,I),this.renderBuffer&&this.renderBuffer.resize(E,_,I)}isInitialized(){return!!this.frameBuffer.pointer}static SET_DATA(E){T.WEBGL_depth_texture=E.getExtension('WEBGL_depth_texture')||E.getExtension('WEBKIT_WEBGL_depth_texture')||E.getExtension('MOZ_WEBGL_depth_texture'),T._DATA_INITIALIZED=!0}init(E){return T._DATA_INITIALIZED||T.SET_DATA(E),this.recordDepth&&(T.WEBGL_depth_texture?(this.depthTexture=this._genDepthTexture('frameBufferDepth',this.width,this.height),this.depthTexture.init(E)):(console.warn('WEBGL_depth_texture Extension not available!'),this.recordDepth=!1)),this.captureDepth&&(this.renderBuffer=new l.a(this.width,this.height),this.renderBuffer.init(E)),this.frameBuffer.init(E),this.pingpong(),this.colorTexture.init(E),this.pingpong(),this.colorTexture.init(E),this.depthTexture?E.framebufferTexture2D(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.TEXTURE_2D,this.depthTexture.pointer,0):this.renderBuffer&&E.framebufferRenderbuffer(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.RENDERBUFFER,this.renderBuffer.pointer),E.bindTexture(E.TEXTURE_2D,null),E.bindFramebuffer(E.FRAMEBUFFER,null),E.bindRenderbuffer(E.RENDERBUFFER,null),!0}start(E,_=!0){this.frameBuffer.bind(E),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,this.colorTexture.pointer,0),this.depthTexture?E.framebufferTexture2D(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.TEXTURE_2D,_?this.depthTexture.pointer:null,0):this.renderBuffer&&E.framebufferRenderbuffer(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.RENDERBUFFER,_?this.renderBuffer.pointer:null)}stop(E){this.frameBuffer.free(E)}}d.a=T}]);