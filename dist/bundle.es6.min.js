var _Mathfloor=Math.floor,_NumberisInteger=Number.isInteger,_Mathpow=Math.pow,_MathPI=Math.PI,_Mathtan=Math.tan,_Mathcos=Math.cos,_Mathsin=Math.sin,_Mathsqrt=Math.sqrt,_Mathmax=Math.max,_Mathabs=Math.abs;(function(n){function d(u){if(o[u])return o[u].exports;var l=o[u]={i:u,l:!1,exports:{}};return n[u].call(l.exports,l,l.exports,d),l.l=!0,l.exports}var o={};return d.m=n,d.c=o,d.i=function(u){return u},d.d=function(u,l,m){d.o(u,l)||Object.defineProperty(u,l,{configurable:!1,enumerable:!0,get:m})},d.n=function(u){var l=u&&u.__esModule?function(){return u['default']}:function(){return u};return d.d(l,'a',l),l},d.o=function(u,l){return Object.prototype.hasOwnProperty.call(u,l)},d.p='',d(d.s=19)})([function(n,d){'use strict';d.a=class{constructor(l,m,T,E=!1){this.label=l,this.type=m,this.data=T,this._init(m,E)}_init(l){switch(this.type){case 35676:{this.draw=(T,E)=>{T.uniformMatrix4fv(E,!1,this.data)};break}case 35665:{this.draw=(T,E)=>{T.uniform3f(E,...this.data)};break}case 5124:this.draw=(T,E)=>{T.uniform1i(E,this.data)};break;case-1:this.draw=(T,E)=>{T.uniform1fv(E,this.data)};break;default:console.error('Uniform type unknow: {label:',this.label,', type:',l,'}');}}}},function(n,d,o){'use strict';var u=o(6),l=o(5),m=o(0),T=o(18);class E extends u.a{constructor(_,I='aVertexPosition',R='uSample'){const D=new l.a;D.addVertices(I,[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1],2),super(D,_)}resize(_,I){this.uWidth&&(this.uWidth.data=_),this.uHeight&&(this.uHeight.data=I)}useUWidth(_,I){const R=new m.a(_,5124,I);this.uWidth=R,this.addUniform(R)}useUHeight(_,I){const R=new m.a(_,5124,I);this.uHeight=R,this.addUniform(R)}useColorTexture(_){const I=new T.a(_);this.inColorTexture=I,this.addTexture(I)}useDepthTexture(_,I){const R=new T.a(_);this.inDepthTexture=R,this.addTexture(R);const D=new m.a(I,5124,1);this._inDetpthEnableUniform=D,this.addUniform(D)}setDepthTexture(_,I){this.rmTexture(this.inDepthTexture),_&&this.addTexture(this.inDepthTexture),this._inDetpthEnableUniform.data=_?1:0;const R=this.globalUniforms;this.dispose(),this.init(I,R)}}d.a=E},function(n,d){'use strict';const u=`      
    attribute vec3 aVertexPosition;
    attribute vec4 aVertexColor;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec4 vColor;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vColor = aVertexColor;
    }
`,l=`
    precision mediump float;

    varying vec4 vColor;

    void main(void) {
        gl_FragColor = vColor;
    }
`;let m=0;d.a=class{constructor(E=u,_=l){this.vertexShaderSrc=E,this.fragmentShaderSrc=_,this.attribLocation={},this.uniformLocation={},this.textureLocation={},this.textureIndex={},this.textureNum=0,this.id=++m}isInitialized(){return!!this.pointer}init(E){this.vertexShader=this._createShader(E,35633,this.vertexShaderSrc),this.fragmentShader=this._createShader(E,35632,this.fragmentShaderSrc);const _=E.createProgram();return(E.attachShader(_,this.vertexShader),E.attachShader(_,this.fragmentShader),E.linkProgram(_),!E.getProgramParameter(_,E.LINK_STATUS))?(console.error('Shader initialization error'),!1):(E.useProgram(_),this.pointer=_,!0)}getAttribLocation(E,_){const I=_.label;if(!this.attribLocation.hasOwnProperty(I)){const R=E.getAttribLocation(this.pointer,I);return E.enableVertexAttribArray(R),this.attribLocation[I]=R,R}return this.attribLocation[I]}getUniformLocation(E,_){const I=_.label;if(!this.uniformLocation.hasOwnProperty(I)){const R=E.getUniformLocation(this.pointer,I);return this.uniformLocation[I]=R,R}return this.uniformLocation[I]}getTextureLocationIndex(E,_){const I=_.label;if(!this.textureLocation.hasOwnProperty(I)||!this.textureIndex.hasOwnProperty(I)){const R=E.getUniformLocation(this.pointer,I);return this.textureLocation[I]=R,this.textureIndex[I]=this.textureNum,[R,this.textureNum++]}return[this.textureLocation[I],this.textureIndex[I]]}draw(E){E.useProgram(this.pointer)}_createShader(E,_,I){const R=E.createShader(_);return E.shaderSource(R,I),E.compileShader(R),E.getShaderParameter(R,E.COMPILE_STATUS)?R:console.error('Une erreur est survenue au cours de la compilation du shader: '+E.getShaderInfoLog(R))}}},function(n,d){'use strict';class u{constructor(){this.lastTexture=null,this.lastProgram=null}optimizeTexture(l){const m=this.lastTexture;return this.lastTexture=l,l===m}optimizeProgram(l){const m=this.lastProgram;return this.lastProgram=l,l===m}static getInstance(l){const m=u.glList.indexOf(l);if(0>m){const T=new u;return u.glList.push(l),u.list.push(T),T}return u.list[m]}}u.glList=[],u.list=[],d.a=u},function(n,d,o){'use strict';var u=o(7);class l extends u.a{constructor(m){super(),this.label=m}draw(m,T){super.draw(m),m.vertexAttribPointer(T,this.itemSize,this.itemType,!1,0,0)}}d.a=l},function(n,d,o){'use strict';var u=o(7),l=o(4);d.a=class{constructor(){this.attributes=[],this.buffers=[],this.hasIndices=!1,this.numItems=0}addVertices(T,E,_){const I=new l.a(T);I.setArray(new Float32Array(E),34962),I.setItems(5126,_),this.attributes.push(I),1>this.numItems&&(this.numItems=E.length/_)}addIndices(T){this.hasIndices=!0;const E=new u.a;E.setArray(new Uint16Array(T),34963),E.setItems(5125,1),this.buffers.push(E),this.numItems=T.length}display(T){this.hasIndices?T.drawElements(T.TRIANGLES,this.numItems,T.UNSIGNED_SHORT,0):T.drawArrays(T.TRIANGLES,0,this.numItems)}}},function(n,d,o){'use strict';var u=o(3);d.a=class{constructor(m,T){this.geom=m,this.program=T,this.uniforms=[],this.globalUniforms=[],this.textures=[],this.localCalls=[],this.globalCalls=[],this.order=0,this._isInitialized=!1}addUniform(m){this.uniforms.push(m)}rmUniform(m){const T=this.uniforms.indexOf(m);-1<T&&this.uniforms.splice(T,1)}addTexture(m){this.textures.push(m)}rmTexture(m){const T=this.textures.indexOf(m);-1<T&&this.textures.splice(T,1)}isInitialized(){let m=this._isInitialized;if(m)return m;this.program.isInitialized()||(m=!1);for(const T of this.geom.attributes)T.isInitialized()||(m=!1);for(const T of this.geom.buffers)T.isInitialized()||(m=!1);for(const T of this.textures)T.isInitialized()||(m=!1);return m}_setCalls(m,T){const E=this.program;for(const _ of this.geom.attributes){const I=E.getAttribLocation(m,_);this.localCalls.push(_.draw.bind(_,m,I))}for(const _ of this.geom.buffers)this.localCalls.push(_.draw.bind(_,m));for(const _ of this.uniforms){const I=E.getUniformLocation(m,_);this.localCalls.push(_.draw.bind(_,m,I))}for(const _ of this.textures){const[I,R]=E.getTextureLocationIndex(m,_);this.localCalls.push(_.draw.bind(_,m,I,R))}for(const _ of T){const I=E.getUniformLocation(m,_);this.globalCalls.push(_.draw.bind(_,m,I))}}_initData(m){this.program;let E=!0;for(const _ of this.geom.attributes)_.isInitialized()||_.init(m)||(E=!1);for(const _ of this.geom.buffers)_.isInitialized()||_.init(m)||(E=!1);for(const _ of this.textures)_.isInitialized()||_.init(m)||(E=!1);return E}dispose(){this._isInitialized=!1,this.localCalls.length=0}init(m,T){this.program;let _=!0;return this.program.isInitialized()?this.program.draw(m):!this.program.init(m)&&(_=!1),this._initData(m)||(_=!1),_&&1>this.localCalls.length&&this._setCalls(m,T),this.globalUniforms=[...T],this._isInitialized=_,_}draw(m,T=[]){const E=u.a.getInstance(m),_=this.program,I=E.optimizeProgram(_);if(!I){this.program.draw(m);for(const R of this.globalCalls)R()}for(const R of this.localCalls)R();for(const R of T)R();this.geom.display(m)}}},function(n,d){'use strict';d.a=class{constructor(){this.buffer=null}isInitialized(){return!!this.buffer}setArray(l,m=34962,T=35044){this.arrayType=m,this.data=l,this.arrayUsage=T}setItems(l=5126,m=3,T=null){this.itemType=l,this.itemSize=m}init(l){const m=l.createBuffer();return l.bindBuffer(this.arrayType,m),l.bufferData(this.arrayType,this.data,this.arrayUsage),this.buffer=m,!0}draw(l){l.bindBuffer(this.arrayType,this.buffer)}}},function(n,d,o){'use strict';var u=o(3);class l{constructor(m){this.label=m,this.mipmap=!0,this.img=null,this.width=null,this.height=null,this.pointer=null,this.parameters=[],this.setType(),this.setInternalFormat(),this.setFormat(),this.setTarget()}resize(m,T,E=null){this.width=m,this.height=T,E?(E.bindTexture(this.target,this.pointer),E.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img)):this.updated=!0}setTempColor(m){this.setImg(new Uint8Array(m),1,1)}setImg(m=new Uint8Array([255,255,255,255]),T=1,E=1){this.img=m,this.width=T,this.height=E}setType(m=5121){this.type=m}setInternalFormat(m=6408){this.internalFormat=m}setFormat(m=6408){this.format=m}setTarget(m=3553){this.target=m}setParam(m,T){const E=this.parameters.find((_)=>_[0]===m);-1<E?this.parameters[E][1]=T:this.parameters.push([m,T])}isInitialized(){return!!this.pointer}static IS_POWER_OF_2(m){return 0==(m&m-1)}static SET_DATA(m){l.MAX_SIZE=m.getParameter(m.MAX_TEXTURE_SIZE),l.FORMAT={};const T=m.getParameter(m.COMPRESSED_TEXTURE_FORMATS);for(let E=0;E<T.length;E++)l.FORMAT[T[E]]=!0;l._DATA_INITIALIZED=!0}setDefaultParams(m){this.mipmap?this.setParam(m.TEXTURE_MIN_FILTER,m.LINEAR_MIPMAP_LINEAR):(this.setParam(m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),this.setParam(m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),this.setParam(m.TEXTURE_MIN_FILTER,m.LINEAR))}initParams(m){if(this.mipmap){const T=this.img;null===T?console.warn('You need an image to set the parameters of texture'):l.IS_POWER_OF_2(T.width)&&l.IS_POWER_OF_2(T.height)?m.generateMipmap(this.target):(this.mipmap=!1,console.warn('You need a power of 2 for the size of the mipmaped texture'))}1>this.parameters.length&&this.setDefaultParams(m);for(const[T,E]of this.parameters)m.texParameteri(this.target,T,E)}init(m){const T=m.createTexture();return l._DATA_INITIALIZED||l.SET_DATA(m),m.bindTexture(this.target,T),m.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.initParams(m),this.pointer=T,!0}draw(m,T,E){const _=u.a.getInstance(m),I=_.optimizeTexture(this);I||(m.uniform1i(T,E),m.activeTexture(m.TEXTURE0+E),m.bindTexture(this.target,this.pointer),this.updated&&(m.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.updated=!1))}free(m){m.bindTexture(m.TEXTURE_2D,null)}}d.a=l},function(n,d){'use strict';function u(T,E,_,I,R,D,P,A,F,C,L,U,B,M,N,O,X){T[0]=E,T[1]=_,T[2]=I,T[3]=R,T[4]=D,T[5]=P,T[6]=A,T[7]=F,T[8]=C,T[9]=L,T[10]=U,T[11]=B,T[12]=M,T[13]=N,T[14]=O,T[15]=X}const l=1e-6;class m extends Float32Array{constructor(){super(16),this[0]=1,this[5]=1,this[10]=1,this[15]=1}clone(){const T=new m;return T.set(this),T}copy(T){return T.set(this),this}identity(){return u(this,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}add(T){return this[0]+=T[0],this[1]+=T[1],this[2]+=T[2],this[3]+=T[3],this[4]+=T[4],this[5]+=T[5],this[6]+=T[6],this[7]+=T[7],this[8]+=T[8],this[9]+=T[9],this[10]+=T[10],this[11]+=T[11],this[12]+=T[12],this[13]+=T[13],this[14]+=T[14],this[15]+=T[15],this}subtract(T){return this[0]-=T[0],this[1]-=T[1],this[2]-=T[2],this[3]-=T[3],this[4]-=T[4],this[5]-=T[5],this[6]-=T[6],this[7]-=T[7],this[8]-=T[8],this[9]-=T[9],this[10]-=T[10],this[11]-=T[11],this[12]-=T[12],this[13]-=T[13],this[14]-=T[14],this[15]-=T[15],this}multiplyScalar(T){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this[4]*=T,this[5]*=T,this[6]*=T,this[7]*=T,this[8]*=T,this[9]*=T,this[10]*=T,this[11]*=T,this[12]*=T,this[13]*=T,this[14]*=T,this[15]*=T,this}multiplyScalarAndAdd(T,E){return this[0]+=T[0]*E,this[1]+=T[1]*E,this[2]+=T[2]*E,this[3]+=T[3]*E,this[4]+=T[4]*E,this[5]+=T[5]*E,this[6]+=T[6]*E,this[7]+=T[7]*E,this[8]+=T[8]*E,this[9]+=T[9]*E,this[10]+=T[10]*E,this[11]+=T[11]*E,this[12]+=T[12]*E,this[13]+=T[13]*E,this[14]+=T[14]*E,this[15]+=T[15]*E,this}exactEquals(T){return this[0]===T[0]&&this[1]===T[1]&&this[2]===T[2]&&this[3]===T[3]&&this[4]===T[4]&&this[5]===T[5]&&this[6]===T[6]&&this[7]===T[7]&&this[8]===T[8]&&this[9]===T[9]&&this[10]===T[10]&&this[11]===T[11]&&this[12]===T[12]&&this[13]===T[13]&&this[14]===T[14]&&this[15]===T[15]}equals(T){const[E,_,I,R,D,P,A,F,C,L,U,B,M,N,O,X]=this,[v,W,G,V,H,q,Z,K,k,Y,$,J,Q,ee,te,re]=T;return _Mathabs(E-v)<=l*_Mathmax(1,_Mathabs(E),_Mathabs(v))&&_Mathabs(_-W)<=l*_Mathmax(1,_Mathabs(_),_Mathabs(W))&&_Mathabs(I-G)<=l*_Mathmax(1,_Mathabs(I),_Mathabs(G))&&_Mathabs(R-V)<=l*_Mathmax(1,_Mathabs(R),_Mathabs(V))&&_Mathabs(D-H)<=l*_Mathmax(1,_Mathabs(D),_Mathabs(H))&&_Mathabs(P-q)<=l*_Mathmax(1,_Mathabs(P),_Mathabs(q))&&_Mathabs(A-Z)<=l*_Mathmax(1,_Mathabs(A),_Mathabs(Z))&&_Mathabs(F-K)<=l*_Mathmax(1,_Mathabs(F),_Mathabs(K))&&_Mathabs(C-k)<=l*_Mathmax(1,_Mathabs(C),_Mathabs(k))&&_Mathabs(L-Y)<=l*_Mathmax(1,_Mathabs(L),_Mathabs(Y))&&_Mathabs(U-$)<=l*_Mathmax(1,_Mathabs(U),_Mathabs($))&&_Mathabs(B-J)<=l*_Mathmax(1,_Mathabs(B),_Mathabs(J))&&_Mathabs(M-Q)<=l*_Mathmax(1,_Mathabs(M),_Mathabs(Q))&&_Mathabs(N-ee)<=l*_Mathmax(1,_Mathabs(N),_Mathabs(ee))&&_Mathabs(O-te)<=l*_Mathmax(1,_Mathabs(O),_Mathabs(te))&&_Mathabs(X-re)<=l*_Mathmax(1,_Mathabs(X),_Mathabs(re))}transpose(T){if(T===this){const E=T[1],_=T[2],I=T[3],R=T[6],D=T[7],P=T[11];this[1]=T[4],this[2]=T[8],this[3]=T[12],this[4]=E,this[6]=T[9],this[7]=T[13],this[8]=_,this[9]=R,this[11]=T[14],this[12]=I,this[13]=D,this[14]=P}else u(this,T[0],T[4],T[8],T[12],T[1],T[5],T[9],T[13],T[2],T[6],T[10],T[14],T[3],T[7],T[11],T[15]);return this}invert(){const[T,E,_,I,R,D,P,A,F,C,L,U,B,M,N,O]=this,X=T*D-E*R,v=T*P-_*R,W=T*A-I*R,G=E*P-_*D,V=E*A-I*D,H=_*A-I*P,q=F*M-C*B,Z=F*N-L*B,K=F*O-U*B,k=C*N-L*M,Y=C*O-U*M,$=L*O-U*N;let J=X*$-v*Y+W*k+G*K-V*Z+H*q;return J?(J=1/J,u(this,(D*$-P*Y+A*k)*J,(_*Y-E*$-I*k)*J,(M*H-N*V+O*G)*J,(L*V-C*H-U*G)*J,(P*K-R*$-A*Z)*J,(T*$-_*K+I*Z)*J,(N*W-B*H-O*v)*J,(F*H-L*W+U*v)*J,(R*Y-D*K+A*q)*J,(E*K-T*Y-I*q)*J,(B*V-M*W+O*X)*J,(C*W-F*V-U*X)*J,(D*Z-R*k-P*q)*J,(T*k-E*Z+_*q)*J,(M*v-B*G-N*X)*J,(F*G-C*v+L*X)*J),this):this}adjoint(){const[T,E,_,I,R,D,P,A,F,C,L,U,B,M,N,O]=this;return u(this,D*(L*O-U*N)-C*(P*O-A*N)+M*(P*U-A*L),-(E*(L*O-U*N)-C*(_*O-I*N)+M*(_*U-I*L)),E*(P*O-A*N)-D*(_*O-I*N)+M*(_*A-I*P),-(E*(P*U-A*L)-D*(_*U-I*L)+C*(_*A-I*P)),-(R*(L*O-U*N)-F*(P*O-A*N)+B*(P*U-A*L)),T*(L*O-U*N)-F*(_*O-I*N)+B*(_*U-I*L),-(T*(P*O-A*N)-R*(_*O-I*N)+B*(_*A-I*P)),T*(P*U-A*L)-R*(_*U-I*L)+F*(_*A-I*P),R*(C*O-U*M)-F*(D*O-A*M)+B*(D*U-A*C),-(T*(C*O-U*M)-F*(E*O-I*M)+B*(E*U-I*C)),T*(D*O-A*M)-R*(E*O-I*M)+B*(E*A-I*D),-(T*(D*U-A*C)-R*(E*U-I*C)+F*(E*A-I*D)),-(R*(C*N-L*M)-F*(D*N-P*M)+B*(D*L-P*C)),T*(C*N-L*M)-F*(E*N-_*M)+B*(E*L-_*C),-(T*(D*N-P*M)-R*(E*N-_*M)+B*(E*P-_*D)),T*(D*L-P*C)-R*(E*L-_*C)+F*(E*P-_*D)),this}determinant(){const[T,E,_,I,R,D,P,A,F,C,L,U,B,M,N,O]=this;return(T*D-E*R)*(L*O-U*N)-(T*P-_*R)*(C*O-U*M)+(T*A-I*R)*(C*N-L*M)+(E*P-_*D)*(F*O-U*B)-(E*A-I*D)*(F*N-L*B)+(_*A-I*P)*(F*M-C*B)}multiply(T){const[E,_,I,R,D,P,A,F,C,L,U,B,M,N,O,X]=this;let[v,W,G,V]=T;return this[0]=v*E+W*D+G*C+V*M,this[1]=v*_+W*P+G*L+V*N,this[2]=v*I+W*A+G*U+V*O,this[3]=v*R+W*F+G*B+V*X,v=T[4],W=T[5],G=T[6],V=T[7],this[4]=v*E+W*D+G*C+V*M,this[5]=v*_+W*P+G*L+V*N,this[6]=v*I+W*A+G*U+V*O,this[7]=v*R+W*F+G*B+V*X,v=T[8],W=T[9],G=T[10],V=T[11],this[8]=v*E+W*D+G*C+V*M,this[9]=v*_+W*P+G*L+V*N,this[10]=v*I+W*A+G*U+V*O,this[11]=v*R+W*F+G*B+V*X,v=T[12],W=T[13],G=T[14],V=T[15],this[12]=v*E+W*D+G*C+V*M,this[13]=v*_+W*P+G*L+V*N,this[14]=v*I+W*A+G*U+V*O,this[15]=v*R+W*F+G*B+V*X,this}translate([T,E,_]){return this[12]=this[0]*T+this[4]*E+this[8]*_+this[12],this[13]=this[1]*T+this[5]*E+this[9]*_+this[13],this[14]=this[2]*T+this[6]*E+this[10]*_+this[14],this[15]=this[3]*T+this[7]*E+this[11]*_+this[15],this}scale([T,E,_]){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this[4]*=E,this[5]*=E,this[6]*=E,this[7]*=E,this[8]*=_,this[9]*=_,this[10]*=_,this[11]*=_,this}rotate(T,[E,_,I]){let R=_Mathsqrt(E*E+_*_+I*I);if(_Mathabs(R)>l){R=1/R,E*=R,_*=R,I*=R;const D=_Mathsin(T),P=_Mathcos(T),A=1-P,[F,C,L,U,B,M,N,O,X,v,W,G]=this,V=E*E*A+P,H=_*E*A+I*D,q=I*E*A-_*D,Z=E*_*A-I*D,K=_*_*A+P,k=I*_*A+E*D,Y=E*I*A+_*D,$=_*I*A-E*D,J=I*I*A+P;this[0]=F*V+B*H+X*q,this[1]=C*V+M*H+v*q,this[2]=L*V+N*H+W*q,this[3]=U*V+O*H+G*q,this[4]=F*Z+B*K+X*k,this[5]=C*Z+M*K+v*k,this[6]=L*Z+N*K+W*k,this[7]=U*Z+O*K+G*k,this[8]=F*Y+B*$+X*J,this[9]=C*Y+M*$+v*J,this[10]=L*Y+N*$+W*J,this[11]=U*Y+O*$+G*J}return this}rotateX(T){const E=_Mathsin(T),_=_Mathcos(T),I=this[4],R=this[5],D=this[6],P=this[7],A=this[8],F=this[9],C=this[10],L=this[11];return this[4]=I*_+A*E,this[5]=R*_+F*E,this[6]=D*_+C*E,this[7]=P*_+L*E,this[8]=A*_-I*E,this[9]=F*_-R*E,this[10]=C*_-D*E,this[11]=L*_-P*E,this}rotateY(T){const E=_Mathsin(T),_=_Mathcos(T),I=a[0],R=a[1],D=a[2],P=a[3],A=a[8],F=a[9],C=a[10],L=a[11];return this[0]=I*_-A*E,this[1]=R*_-F*E,this[2]=D*_-C*E,this[3]=P*_-L*E,this[8]=I*E+A*_,this[9]=R*E+F*_,this[10]=D*E+C*_,this[11]=P*E+L*_,this}rotateZ(T){const E=_Mathsin(T),_=_Mathcos(T),[I,R,D,P,A,F,C,L]=this;return this[0]=I*_+A*E,this[1]=R*_+F*E,this[2]=a02*_+C*E,this[3]=P*_+L*E,this[4]=A*_-I*E,this[5]=F*_-R*E,this[6]=C*_-a02*E,this[7]=L*_-P*E,this}fromTranslation(T){return u(this,1,0,0,0,0,1,0,0,0,0,1,0,T[0],T[1],T[2],1),this}fromScaling(T){return u(this,T[0],0,0,0,0,T[1],0,0,0,0,T[2],0,0,0,0,1),this}fromRotation(T,[E,_,I]){let R=_Mathsqrt(E*E+_*_+I*I);if(_Mathabs(R)>l){R=1/R,E*=R,_*=R,I*=R;const D=_Mathsin(T),P=_Mathcos(T),A=1-P;u(this,E*E*A+P,_*E*A+I*D,I*E*A-_*D,0,E*_*A-I*D,_*_*A+P,I*_*A+E*D,0,E*I*A+_*D,_*I*A-E*D,I*I*A+P,0,0,0,0,1)}return this}fromXRotation(T){const E=_Mathsin(T),_=_Mathcos(T);return u(this,1,0,0,0,0,_,E,0,0,-E,_,0,0,0,0,1),this}fromYRotation(T){const E=_Mathsin(T),_=_Mathcos(T);return u(this,_,0,-E,0,0,1,0,0,E,0,_,0,0,0,0,1),this}fromZRotation(T){const E=_Mathsin(T),_=_Mathcos(T);return u(this,_,E,0,0,-E,_,0,0,0,0,1,0,0,0,0,1),this}fromQuat(T){const[E,_,I,R]=T,D=E+E,P=_+_,A=I+I,F=E*D,C=_*D,L=_*P,U=I*D,B=I*P,M=I*A,N=R*D,O=R*P,X=R*A;return u(this,1-L-M,C+X,U-O,0,C-X,1-F-M,B+N,0,U+O,B-N,1-F-L,0,0,0,0,1),this}fromRotationTranslation(T,E){const[_,I,R,D]=T,P=_+_,A=I+I,F=R+R,C=_*P,L=_*A,U=_*F,B=I*A,M=I*F,N=R*F,O=D*P,X=D*A,v=D*F;return u(this,1-(B+N),L+v,U-X,0,L-v,1-(C+N),M+O,0,U+X,M-O,1-(C+B),0,E[0],E[1],E[2],1),this}fromRotationTranslationScale(T,E,[_,I,R]){const[D,P,A,F]=T,C=D+D,L=P+P,U=A+A,B=D*C,M=D*L,N=D*U,O=P*L,X=P*U,v=A*U,W=F*C,G=F*L,V=F*U;return u(this,(1-(O+v))*_,(M+V)*_,(N-G)*_,0,(M-V)*I,(1-(B+v))*I,(X+W)*I,0,(N+G)*R,(X-W)*R,(1-(B+O))*R,0,E[0],E[1],E[2],1),this}fromRotationTranslationScaleOrigin(T,E,_,I){const[R,D,P,A]=T,F=R+R,C=D+D,L=P+P,U=R*F,B=R*C,M=R*L,N=D*C,O=D*L,X=P*L,v=A*F,W=A*C,G=A*L,[V,H,q]=_,[Z,K,k]=I;return u(this,(1-(N+X))*V,(B+G)*V,(M-W)*V,0,(B-G)*H,(1-(U+X))*H,(O+v)*H,0,(M+W)*q,(O-v)*q,(1-(U+N))*q,0,E[0]+Z-(this[0]*Z+this[4]*K+this[8]*k),E[1]+K-(this[1]*Z+this[5]*K+this[9]*k),E[2]+k-(this[2]*Z+this[6]*K+this[10]*k),1),this}getTranslation(T,E=new Float32Array(3)){return E[0]=this[12],E[1]=this[13],E[2]=this[14],E}getRotation(T=new Float32Array(4)){var E=this[0]+this[5]+this[10];if(0<E){const _=2*_Mathsqrt(E+1);T[0]=(this[6]-this[9])/_,T[1]=(this[8]-this[2])/_,T[2]=(this[1]-this[4])/_,T[3]=0.25*_}else if(this[0]>this[5]&this[0]>this[10]){const _=2*_Mathsqrt(1+this[0]-this[5]-this[10]);T[0]=0.25*_,T[1]=(this[1]+this[4])/_,T[2]=(this[8]+this[2])/_,T[3]=(this[6]-this[9])/_}else if(this[5]>this[10]){const _=_Mathsqrt(1+this[5]-this[0]-this[10]);T[0]=2*((this[1]+this[4])/_),T[1]=0.25*_,T[2]=(this[6]+this[9])/_,T[3]=(this[8]-this[2])/_}else{const _=2*_Mathsqrt(1+this[10]-this[0]-this[5]);T[0]=(this[8]+this[2])/_,T[1]=(this[6]+this[9])/_,T[2]=0.25*_,T[3]=(this[1]-this[4])/_}return T}frustrum(T,E,_,I,R,D){const P=1/(E-T),A=1/(I-_),F=1/(R-D);return u(this,2*R*P,0,0,0,0,2*R*A,0,0,(E+T)*P,(I+_)*A,(D+R)*F,-1,0,0,2*(D*R)*F,0),this}perspective(T,E,_,I){const R=1/_Mathtan(T/2),D=1/(_-I);return u(this,R/E,0,0,0,0,R,0,0,0,0,(I+_)*D,-1,0,0,2*I*_*D,0),this}perspectiveFromFieldOfView(T,E,_){const I=_Mathtan(T.upDegrees*_MathPI/180),R=_Mathtan(T.downDegrees*_MathPI/180),D=_Mathtan(T.leftDegrees*_MathPI/180),P=_Mathtan(T.rightDegrees*_MathPI/180),A=2/(D+P),F=2/(I+R);return u(this,A,0,0,0,0,F,0,0,0.5*(-(D-P)*A),0.5*((I-R)*F),_/(E-_),-1,0,0,_*E/(E-_),0),this}ortho(T,E,_,I,R,D){const P=1/(T-E),A=1/(_-I),F=1/(R-D);return u(this,-2*P,0,0,0,0,-2*A,0,0,0,0,2*F,0,(T+E)*P,(I+_)*A,(D+R)*F,1),this}lookAt(T,E,_){const[I,R,D]=T,[P,A,F]=_,[C,L,U]=E;if(_Mathabs(I-C)<l&&_Mathabs(R-L)<l&&_Mathabs(D-U)<l)return this.identity();let B=I-C,M=R-L,N=D-U,O=1/_Mathsqrt(B*B+M*M+N*N);B*=O,M*=O,N*=O;let X=A*N-F*M,v=F*B-P*N,W=P*M-A*B;O=_Mathsqrt(X*X+v*v+W*W),O?(O=1/O,X*=O,v*=O,W*=O):(X=0,v=0,W=0);let G=M*W-N*v,V=N*X-B*W,H=B*v-M*X;return O=_Mathsqrt(G*G+V*V+H*H),O?(O=1/O,G*=O,V*=O,H*=O):(G=0,V=0,H=0),u(this,X,G,B,0,v,V,M,0,W,H,N,0,-(X*I+v*R+W*D),-(G*I+V*R+H*D),-(B*I+M*R+N*D),1),this}frob(){return _Mathsqrt(_Mathpow(this[0],2)+_Mathpow(this[1],2)+_Mathpow(this[2],2)+_Mathpow(this[3],2)+_Mathpow(this[4],2)+_Mathpow(this[5],2)+_Mathpow(this[6],2)+_Mathpow(this[7],2)+_Mathpow(this[8],2)+_Mathpow(this[9],2)+_Mathpow(this[10],2)+_Mathpow(this[11],2)+_Mathpow(this[12],2)+_Mathpow(this[13],2)+_Mathpow(this[14],2)+_Mathpow(this[15],2))}}d.a=m},function(n,d,o){'use strict';var u=o(9),l=o(0);class m extends l.a{constructor(T){super(T,35676,new u.a),this.fovy=45,this.near=0.1,this.far=1e3,this._matrix=new u.a,this.updated=!0}get matrix(){return this.updated=!0,this._matrix}update(T,E){this.data.perspective(this.fovy*_MathPI/180,T/E,0.1,100),this.data.multiply(this._matrix),this.updated=!1}}d.a=m},function(n,d,o){'use strict';o(3);class l{constructor(m,T){this.canvas=m,this.init(m),this.meshs=[],this.cam=T,this.uniforms=[T],this.depthTest=!0,this.sortCompare=(E,_)=>{return E.program.id-_.program.id},this.resize(m.width,m.height)}_addCamToMeshs(){const m=this.cam;this.uniforms.push(m)}addMesh(m){this.meshs.push(m),m.isInitialized()||m.init(this.gl,this.uniforms)}rmMesh(m){const T=this.meshs.indexOf(m);-1<T&&this.meshs.splice(T,1)}sort(){this.meshs.sort(this.sortCompare)}resize(m,T){this.width=m,this.height=T}init(m){let T;try{T=m.getContext('webgl')||m.getContext('experimental-webgl')}catch(E){console.error('Could not initialise WebGL:',E.message)}T||console.error('Could not initialise WebGL'),this.gl=T}set depthTest(m){const T=this.gl;!m?T.disable(T.DEPTH_TEST):T.enable(T.DEPTH_TEST),this._depthTest=!!m}get depthTest(){return this._depthTest}set bgColor([m,T,E,_=1]){this.gl.clearColor(m,T,E,_),this._bgColor=[m,T,E,_]}get bgColor(){return this._bgColor}draw(){const m=this.gl;m.viewport(0,0,this.width,this.height),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT),this.cam.updated&&this.cam.update(this.width,this.height);for(const T of this.meshs)T.isInitialized()?T.draw(m):T.init(m,this.uniforms)}}d.a=l},function(n,d,o){'use strict';var l=o(8),m=o(17),T=o.n(m);class E extends l.a{constructor(_){super(_),this.srcs=[],this.setTempColor([255,255,255,255])}setTempColor(_){this.setImg(new Uint8Array(_),1,1)}addDDSURL(_,I){const R={size:I,src:_,img:null,isImage:!1,priority:1,isValid:()=>!0,init:null};R.init=(D)=>{const P=T()(R.img),A=P.images[0],F=new Uint8Array(R.img,A.offset,A.length),C=D.getExtension('WEBGL_compressed_texture_s3tc')||D.getExtension('MOZ_WEBGL_compressed_texture_s3tc')||D.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');D.bindTexture(D.TEXTURE_2D,this.pointer),D.compressedTexImage2D(D.TEXTURE_2D,0,C.COMPRESSED_RGBA_S3TC_DXT5_EXT,P.shape[0],P.shape[1],0,F),D.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,!1),this.mipmap=!1,this.setParam(D.TEXTURE_MAG_FILTER,D.LINEAR),this.setParam(D.TEXTURE_MIN_FILTER,D.LINEAR),this.initParams(D)},this.srcs.push(R)}addURL(_,I=0){const R={size:I,src:_,img:null,priority:0,isImage:!0,isValid:()=>!0,init:null};R.init=(D)=>{D.bindTexture(D.TEXTURE_2D,this.pointer),D.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,!0),D.texImage2D(D.TEXTURE_2D,0,6408,this.format,D.UNSIGNED_BYTE,R.img),this.img=R.img,this.initParams(D)},this.srcs.push(R)}static START_LOAD(_,I){if(0<I.length){I.sort((D,P)=>D.size===P.size?D.size-P.size:D.priority-P.priority);I.filter((D)=>D.size>=l.a.MAX_SIZE&&D.isValid(_));if(1<I.length){const D=I[0],P=I[I.length-1];E.LOAD(D,()=>{D.init(_),E.LOAD(P,()=>{P.init(_)})})}else if(0<I.length){const D=I[0];E.LOAD(D,()=>{D.init(_)})}else console.warn('The GPU can\'nt load a texture with size > ',l.a.MAX_SIZE)}else console.warn('URL of your smart texture not found')}static LOAD(_,I){if(_.isImage){const R=new Image;R.onload=()=>{I(_)},_.img=R,R.src=_.src}else{const R=new XMLHttpRequest;R.responseType='arraybuffer',R.open('GET',_.src,!0),R.onreadystatechange=()=>{R.readyState===XMLHttpRequest.DONE&&(200===R.status?(_.img=R.response,I(_)):console.error('fail to load image ',_.src,'status:',R.status,'statuc text:',R.statusText))},R.send()}}init(_,I){const R=super.init(_,I),D=this.pointer;return E.START_LOAD(_,this.srcs),R}}d.a=E},function(n,d,o){'use strict';var u=o(9),l=o(0);class m extends l.a{constructor(T){super(T,35676,new u.a().identity())}}d.a=m},function(n,d,o){'use strict';var u=o(22);d.a=class{constructor(m){this.screenRecorder=new u.a(m.width,m.height,!0,!0),this.scene=m,this.passList=[],this.isEnable=!1,this.init(m.gl)}isInitialized(){return this.screenRecorder.isInitialized()}resize(m,T){this.scene.resize(m,T),this.screenRecorder.resize(m,T);for(const E of this.passList)E.resize(m,T)}_disableDepthInTexture(m,T){m.inDepthTexture&&m.setDepthTexture(!1,T)}init(m){if(this.screenRecorder.init(m),!this.screenRecorder.depthTexture)for(const T of this.passList)this._disableDepthInTexture(T,m);return!0}addPass(m){m.init(this.scene.gl,[]),this.screenRecorder.isInitialized()&&!this.screenRecorder.depthTexture&&this._disableDepthInTexture(m,this.scene.gl),m.uWidth&&(m.uWidth.data=this.scene.width),m.uHeight&&(m.uHeight.data=this.scene.height),this.passList.push(m),this.isEnable=!0}removePass(m){const T=this.passList.indexOf(m);-1<T&&this.passList.splice(T,1),this.isEnable=0<this.passList.length}draw(){const m=this.scene.gl,T=this.passList.length;if(0<T){this.screenRecorder.start(m,!0),this.scene.draw(),this.screenRecorder.stop(m),this.screenRecorder.pingpong();for(let E=0;E<T;E++){const _=this.passList[E],I=E>T-2;I||this.screenRecorder.start(m,!1),this.screenRecorder.pingpong(),_.inColorTexture&&_.inColorTexture.setTexture(this.screenRecorder.colorTexture),_.inDepthTexture&&this.screenRecorder.depthTexture&&_.inDepthTexture.setTexture(this.screenRecorder.depthTexture),_.draw(m),this.screenRecorder.stop(m)}}else this.scene.draw()}}},function(n,d,o){'use strict';function u(R){return _NumberisInteger(R)?R.toFixed(1):R}var l=o(1),m=o(2),T=o(0);const E=`
    attribute vec3 aVertexPosition;
    varying vec2 vTextureCoord;

    void main(void)
    {
        vTextureCoord = vec2(aVertexPosition.x * 0.5 + 0.5, aVertexPosition.y * 0.5 + 0.5);
        gl_Position = vec4(aVertexPosition, 1.0);
    }`,_=`
    precision mediump float;
    varying vec2 vTextureCoord;
    uniform sampler2D uColor;
    uniform sampler2D uDepth;

    uniform vec3 uColorFog;
    
    uniform int uDepthEnable;

    void main(void)
    {
        $chunkcall
        gl_FragColor = color;
    }`;class I extends l.a{constructor({minDepth:R=0.1,maxDepth:D=0.2,minPower:P=0.2,maxPower:A=1,depthCurve:F=100,color:C=[1,1,1]}){super(null,'aVertexPosition','uColor'),this.useColorTexture('uColor'),this.useDepthTexture('uDepth','uDepthEnable');const L=new T.a('uColorFog',35665,C);this.addUniform(L);const U=this._initFragmentShader(R,D,P,A,F);this.program=new m.a(E,U)}_initFragmentShader(R,D,P,A,F){let C=`
            float depthValue = 0.0;
            if (uDepthEnable >= 0) {
                vec4 depth = texture2D(uDepth, vTextureCoord.xy);
                depthValue = pow(depth.x, ${u(F)});
                depthValue = (depthValue - ${u(R)}) / ${u(D-R)};
                depthValue = clamp(depthValue, ${u(P)}, ${u(A)});
            }
            vec4 originalColor = texture2D(uColor, vTextureCoord.xy); 
            vec4 color = vec4(mix(originalColor.xyz, uColorFog, depthValue), originalColor.w);
        `;const L=_.replace('$chunkcall',C);return L}}d.a=I},function(n,d,o){'use strict';function u(R){return _NumberisInteger(R)?R.toFixed(1):R}var l=o(1),m=o(2),T=o(0);const E=`
    attribute vec3 aVertexPosition;
    varying vec2 vTextureCoord;

    void main(void)
    {
        vTextureCoord = vec2(aVertexPosition.x * 0.5 + 0.5, aVertexPosition.y * 0.5 + 0.5);
        gl_Position = vec4(aVertexPosition, 1.0);
    }`,_=`
    precision mediump float;
    varying vec2 vTextureCoord;
    uniform sampler2D uColor;
    uniform sampler2D uDepth;
    uniform int uSize;
    uniform int uDepthEnable;

    $chunkfct

    void main(void)
    {
        $chunkcall
        gl_FragColor = color;
    }`;class I extends l.a{constructor({minDepth:R=0.1,maxDepth:D=0.2,samples:P=5,xBlur:A=!0,power:F=1,depthCurve:C=100}){super(null,'aVertexPosition','uColor'),this.power=F,this.xBlur=A,this.depthCurve=C,this.useColorTexture('uColor'),this.useDepthTexture('uDepth','uDepthEnable');const L=this._initFragmentShader(R,D,P);this.program=new m.a(E,L),A?this.useUWidth('uSize',1):this.useUHeight('uSize',1)}_initFragmentShader(R=0.1,D=0.3,P=5){const A=this.xBlur,F=u(this.power),C=[];for(let M=0;M<P;M++){const N=this._getKernels(M+1);C.push(N)}let L='';for(let M=0;M<C.length;M++){const N=C[M];L+=`
            vec4 blur${M+1}(sampler2D i, vec2 uv) {
                vec2 m;
                vec4 color = texture2D(i, uv) * ${u(N[0])};`;for(let O=1;O<N.length;O++)L+=`
                m = ${A?'vec2('+O+'.0 * '+F+' / float(uSize), 0.0)':'vec2(0.0, '+O+'.0 * '+F+' / float(uSize))'};
                color += texture2D(i, uv + m) * ${u(N[O])};
                color += texture2D(i, uv - m) * ${u(N[O])};`;L+='return color; }'}let U=`
            float depthValue = 0.0;
            vec4 color;
            if (uDepthEnable >= 0) {
                vec4 depth = texture2D(uDepth, vTextureCoord.xy);
                depthValue = pow(depth.x, ${u(this.depthCurve)});
                
                int blurPower = int(floor(0.5 + (depthValue - ${u(R)}) * ${u(P)} / ${u(D-R)}));   
        `;for(let M=0;M<P;M++){const N='blurPower'+(M>P-2?' >= '+M:1>M?' < 1':' == '+M);U+=`${0<M?' else if':'if'} ( ${N}) {
                color = blur${M+1}(uColor, vTextureCoord.xy);
            }`}U+=`
        } else {
            color = texture2D(uColor, vTextureCoord.xy);
        }
        `;const B=_.replace('$chunkfct',L).replace('$chunkcall',U);return B}_getKernels(R){const D=[];let P=0;for(let A=1;A<R+2;A++){const F=3*(A-1)/R,C=Math.exp(-F*F);P+=2>A?C:C+C,D.push(C)}for(let A=0;A<D.length;A++)D[A]/=P;return D}}d.a=I},function(n){function u(V){return V.charCodeAt(0)+(V.charCodeAt(1)<<8)+(V.charCodeAt(2)<<16)+(V.charCodeAt(3)<<24)}function l(V){return String.fromCharCode(255&V,255&V>>8,255&V>>16,255&V>>24)}var _=u('DXT1'),I=u('DXT3'),R=u('DXT5'),D=u('DX10');n.exports=function(V){var H=new Int32Array(V,0,31);if(H[0]!==542327876)throw new Error('Invalid magic number in DDS header');if(!H[20]&4)throw new Error('Unsupported format, must contain a FourCC code');var q,Z,K=H[21];switch(K){case _:q=8,Z='dxt1';break;case I:q=16,Z='dxt3';break;case R:q=16,Z='dxt5';break;case 116:Z='rgba32f';break;case D:var k=new Uint32Array(V.slice(128,148));Z=k[0];var Y=k[1],$=k[2],J=k[3],Q=k[4];if(Y===3&&Z===2)Z='rgba32f';else throw new Error('Unsupported DX10 texture format '+Z);break;default:throw new Error('Unsupported FourCC code: '+l(K));}var ee=H[2],te=1;ee&131072&&(te=_Mathmax(1,H[7]));var re=!1,ae=H[28];ae&512&&(re=!0);var le,ie=H[4],se=H[3],ne=H[1]+4,de=ie,oe=se,ue=[];if(K===D&&(ne+=20),re)for(var pe=0;6>pe;pe++){if('rgba32f'!==Z)throw new Error('Only RGBA32f cubemaps are supported');ie=de,se=oe;for(var me=Math.log(ie)/0.6931471805599453+1,he=0;he<me;he++)le=ie*se*16,ue.push({offset:ne,length:le,shape:[ie,se]}),he<te&&(ne+=le),ie=_Mathfloor(ie/2),se=_Mathfloor(se/2)}else for(var he=0;he<te;he++)le=_Mathmax(4,ie)/4*_Mathmax(4,se)/4*q,ue.push({offset:ne,length:le,shape:[ie,se]}),ne+=le,ie=_Mathfloor(ie/2),se=_Mathfloor(se/2);return{shape:[de,oe],images:ue,format:Z,flags:ee,cubemap:re}}},function(n,d){'use strict';d.a=class{constructor(l){this.label=l}isInitialized(){return!0}init(){return!0}setTexture(l){this.pointer=l.pointer,this.target=l.target}draw(l,m,T){l.uniform1i(m,T),l.activeTexture(l.TEXTURE0+T),l.bindTexture(this.target,this.pointer)}}},function(n,d,o){'use strict';function u(){V.matrix.rotate(5e-3,[0,1,0]),Q.matrix.rotate(-5e-3,[0,1,0]),$.matrix.rotate(0.01,[0,1,0]),oe.matrix.rotate(-0.01,[0,1,0]),le.matrix.rotate(0.025,[0.72,-0.33,0.5]),me.draw(),requestAnimationFrame(u)}Object.defineProperty(d,'__esModule',{value:!0});var l=o(0),m=o(13),T=o(4),E=o(2),_=o(5),I=o(12),R=o(6),D=o(10),P=o(11),A=o(1),F=o(14),C=o(16),L=o(15);const U=document.body.querySelector('canvas'),B=new D.a('uPMatrix'),M=new P.a(U,B);M.bgColor=[0,0,0.1,1],M.depthTest=!0;const N=new E.a,O=`
    attribute vec3 aVertexPosition;
    attribute vec4 aVertexColor;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec4 vColor;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        float zDepth = 0.2 * (8.0 - gl_Position.z);
        vec4 modifyColor = vec4(aVertexColor.rgb * zDepth, aVertexColor.a);
        vColor = modifyColor;
    }
`,X=new E.a(O),G=new _.a;G.addVertices('aVertexPosition',[0,1,0,-1,-1,1,1,-1,1,0,1,0,1,-1,1,1,-1,-1,0,1,0,1,-1,-1,-1,-1,-1,0,1,0,-1,-1,-1,-1,-1,1],3),G.addVertices('aVertexColor',[1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,1,0,1],4);const V=new R.a(G,N),H=new m.a('uMVMatrix');V.addUniform(H),V.matrix=H.data,V.matrix.translate([-1.5,-1.5,-8]),M.addMesh(V);const q=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],Z=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],K=[[1,0,0,1],[1,1,0,1],[0,1,0,1],[1,0.5,0.5,1],[1,0,1,1],[0,0,1,1]];let k=[];for(let ge in K)for(let xe=0;4>xe;xe++)k=k.concat(K[ge]);const Y=new _.a;Y.addVertices('aVertexPosition',q,3),Y.addVertices('aVertexColor',k,4),Y.addIndices(Z);const $=new R.a(Y,X),J=new m.a('uMVMatrix');$.addUniform(J),$.matrix=J.data,$.matrix.translate([1.5,-1.5,-8]),M.addMesh($);const Q=new R.a(G,N),ee=new m.a('uMVMatrix');Q.addUniform(ee),Q.matrix=ee.data,Q.matrix.translate([-1.5,1.5,-8]),Q.matrix.scale([1,-1,1]),M.addMesh(Q);const te=`   
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec2 vTextureCoord;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vTextureCoord = aTextureCoord;
    }`,re=`
    precision mediump float;

    varying vec2 vTextureCoord;

    uniform sampler2D uDiffuse1;
    uniform sampler2D uDiffuse2;

    void main(void) {
        vec4 color1 = texture2D(uDiffuse1, vec2(vTextureCoord.s, vTextureCoord.t));
        vec4 color2 = texture2D(uDiffuse2, vec2(vTextureCoord.s, vTextureCoord.t));
        float power = ((sin(vTextureCoord.s * 3.1415)) * (sin(vTextureCoord.t * 3.1415)));
        gl_FragColor = mix(color1, color2, power);
    }`,ae=new E.a(te,re);const se=new I.a('uDiffuse1');se.addURL('cube-diffuse.jpg');const ne=new I.a('uDiffuse2');ne.setParam(10240,9728),ne.setParam(10241,9728),ne.addURL('cube-diffuse-2.png');const de=new _.a;de.addVertices('aVertexPosition',q,3),de.addVertices('aTextureCoord',[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],2),de.addIndices(Z);const oe=new R.a(de,ae),ue=new m.a('uMVMatrix');oe.addUniform(ue),oe.matrix=ue.data,oe.addTexture(se),oe.addTexture(ne),oe.matrix.translate([1.5,1.5,-8]),M.addMesh(oe);const le=new R.a(de,ae),pe=new m.a('uMVMatrix');le.addUniform(pe),le.matrix=pe.data,le.addTexture(se),le.addTexture(ne),le.matrix.translate([0,0,-15]),M.addMesh(le),M.sort();const fe=!0;let me;{me=new F.a(M);const ge=new L.a({minDepth:0.5,maxDepth:0.6,minPower:0,maxPower:1,depthCurve:100,color:[0.9,0.95,1]});me.addPass(ge);const xe={minDepth:0.52,maxDepth:0.7,samples:20,xBlur:!0,power:1,depthCurve:50},Te=new C.a(xe);me.addPass(Te),xe.xBlur=!1;const ce=new C.a(xe);me.addPass(ce)}const he=()=>{const ge=[window.innerWidth,window.innerHeight],xe=1;me.resize(ge[0]*xe,ge[1]*xe),U.width=ge[0]*xe,U.height=ge[1]*xe,U.style.width=ge[0]+'px',U.style.height=ge[1]+'px',B.update(...ge)};window.onresize=he,he(),window.scene=M,window.passManager=me,u()},function(n,d){'use strict';d.a=class{constructor(){this.pointer=null}isInitialized(){return!!this.pointer}init(l){const m=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,m),this.pointer=m,!0}bind(l){l.bindFramebuffer(l.FRAMEBUFFER,this.pointer)}free(l){l.bindFramebuffer(l.FRAMEBUFFER,null)}}},function(n,d){'use strict';d.a=class{constructor(l,m){this.pointer=null,this.width=l,this.height=m}resize(l,m){this.width=l,this.height=m,this.updated=!0}isInitialized(){return!!this.pointer}init(l){const m=l.createRenderbuffer();l.bindRenderbuffer(l.RENDERBUFFER,m),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,this.width,this.height),this.pointer=m}bind(l){l.bindRenderbuffer(l.RENDERBUFFER,renderBuffer),this.updated&&(l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,this.width,this.height),this.updated=!1)}}},function(n,d,o){'use strict';var u=o(8),l=o(21),m=o(20);class T{constructor(E,_,I=!0,R=!1){this.captureDepth=I,this.recordDepth=R,this.width=E,this.height=_,this.updated=!1,this._pingpong=!1,this._colorTextures=[this._genColorTexture('frameBufferColor0',E,_),this._genColorTexture('frameBufferColor1',E,_)],this.frameBuffer=new m.a}_genDepthTexture(E,_,I){const R=new u.a;return R.mipmap=!1,R.setInternalFormat(6402),R.setFormat(6402),R.setType(5123),R.setParam(10242,33071),R.setParam(10243,33071),R.setParam(10241,9728),R.setParam(10240,9728),R.setImg(null,_,I),R}_genColorTexture(E,_,I){const R=new u.a(E);return R.mipmap=!1,!1,R.setImg(null,_,I),R}pingpong(){this._pingpong=!this._pingpong}get colorTexture(){return this._colorTextures[this._pingpong?1:0]}resize(E,_){this.width=E,this.height=_,this.updated=!0}isInitialized(){return!!this.frameBuffer.pointer}static SET_DATA(E){T.WEBGL_depth_texture=E.getExtension('WEBGL_depth_texture')||E.getExtension('WEBKIT_WEBGL_depth_texture')||E.getExtension('MOZ_WEBGL_depth_texture'),T._DATA_INITIALIZED=!0}init(E){return T._DATA_INITIALIZED||T.SET_DATA(E),this.recordDepth&&(T.WEBGL_depth_texture?(this.depthTexture=this._genDepthTexture('frameBufferDepth',this.width,this.height),this.depthTexture.init(E)):(console.warn('WEBGL_depth_texture Extension not available!'),this.recordDepth=!1)),this.captureDepth&&(this.renderBuffer=new l.a(this.width,this.height),this.renderBuffer.init(E)),this.frameBuffer.init(E),this.pingpong(),this.colorTexture.init(E),this.pingpong(),this.colorTexture.init(E),this.depthTexture?E.framebufferTexture2D(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.TEXTURE_2D,this.depthTexture.pointer,0):this.renderBuffer&&E.framebufferRenderbuffer(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.RENDERBUFFER,this.renderBuffer.pointer),E.bindTexture(E.TEXTURE_2D,null),E.bindFramebuffer(E.FRAMEBUFFER,null),E.bindRenderbuffer(E.RENDERBUFFER,null),!0}_update(E){const _=this.width,I=this.height;this.pingpong(),this.colorTexture.resize(_,I,E),this.pingpong(),this.colorTexture.resize(_,I,E),this.depthTexture&&this.depthTexture.resize(_,I,E),this.renderBuffer&&this.renderBuffer.resize(_,I,E),this.updated=!1}start(E,_=!0){this.updated&&this._update(E),this.frameBuffer.bind(E),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,this.colorTexture.pointer,0),this.depthTexture?E.framebufferTexture2D(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.TEXTURE_2D,_?this.depthTexture.pointer:null,0):this.renderBuffer&&E.framebufferRenderbuffer(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.RENDERBUFFER,_?this.renderBuffer.pointer:null)}stop(E){this.frameBuffer.free(E)}}d.a=T}]);