var _Mathpow=Math.pow,_MathPI=Math.PI,_Mathtan=Math.tan,_Mathcos=Math.cos,_Mathsin=Math.sin,_Mathsqrt=Math.sqrt,_Mathmax=Math.max,_Mathabs=Math.abs;(function(n){function o(l){if(d[l])return d[l].exports;var u=d[l]={i:l,l:!1,exports:{}};return n[l].call(u.exports,u,u.exports,o),u.l=!0,u.exports}var d={};return o.m=n,o.c=d,o.i=function(l){return l},o.d=function(l,u,m){o.o(l,u)||Object.defineProperty(l,u,{configurable:!1,enumerable:!0,get:m})},o.n=function(l){var u=l&&l.__esModule?function(){return l['default']}:function(){return l};return o.d(u,'a',u),u},o.o=function(l,u){return Object.prototype.hasOwnProperty.call(l,u)},o.p='',o(o.s=27)})([function(n,o){'use strict';class l{constructor(u,m,T,I=!1){this.label=u,this.type=m,this._data=T,this._init(m,I)}get data(){return this._data}set data(u){this._data=u}_init(u){switch(this.type){case 35675:{this.bind=(T,I)=>{T.uniformMatrix3fv(I,!1,this.data)};break}case 35676:{this.bind=(T,I)=>{T.uniformMatrix4fv(I,!1,this.data)};break}case 35665:{this.bind=(T,I)=>{T.uniform3f(I,...this.data)};break}case 5124:this.bind=(T,I)=>{T.uniform1i(I,this.data)};break;case-1:this.bind=(T,I)=>{T.uniform1fv(I,this.data)};break;default:console.error('Uniform type unknow: {label:',this.label,', type:',u,'}');}}}o.a=l},function(n,o){'use strict';class l{constructor(){this.lastTexture=null,this.lastProgram=null,this.lastDepthTest=!1}optimizeTexture(u){const m=this.lastTexture;return this.lastTexture=u,u===m}optimizeProgram(u){const m=this.lastProgram;return this.lastProgram=u,u===m}optimizeDepthTest(u){const m=this.lastDepthTest;return this.lastDepthTest=u,m===u}static getInstance(u){const m=l.glList.indexOf(u);if(0>m){const T=new l;return l.glList.push(u),l.list.push(T),T}return l.list[m]}}l.glList=[],l.list=[],o.a=l},function(n,o){'use strict';let l=0;o.a=class{constructor(m,T){this.vertexShaderSrc=m,this.fragmentShaderSrc=T,this.attribLocation={},this.uniformLocation={},this.textureLocation={},this.textureIndex={},this.textureNum=0,this.id=l++}isInitialized(){return!!this.pointer}init(m){this.vertexShader=this._createShader(m,35633,this.vertexShaderSrc),this.fragmentShader=this._createShader(m,35632,this.fragmentShaderSrc);const T=m.createProgram();return(m.attachShader(T,this.vertexShader),m.attachShader(T,this.fragmentShader),m.linkProgram(T),!m.getProgramParameter(T,m.LINK_STATUS))?(console.error('Shader initialization error'),!1):(m.useProgram(T),this.pointer=T,!0)}getAttribLocation(m,T){const I=T.label;if(!this.attribLocation.hasOwnProperty(I)){const _=m.getAttribLocation(this.pointer,I);return m.enableVertexAttribArray(_),this.attribLocation[I]=_,_}return this.attribLocation[I]}getUniformLocation(m,T){const I=T.label;if(!this.uniformLocation.hasOwnProperty(I)){const _=m.getUniformLocation(this.pointer,I);return this.uniformLocation[I]=_,_}return this.uniformLocation[I]}getTextureLocationIndex(m,T){const I=T.label;if(!this.textureLocation.hasOwnProperty(I)||!this.textureIndex.hasOwnProperty(I)){const _=m.getUniformLocation(this.pointer,I);return this.textureLocation[I]=_,this.textureIndex[I]=this.textureNum,[_,this.textureNum++]}return[this.textureLocation[I],this.textureIndex[I]]}bind(m){m.useProgram(this.pointer)}_createShader(m,T,I){const _=m.createShader(T);return m.shaderSource(_,I),m.compileShader(_),m.getShaderParameter(_,m.COMPILE_STATUS)?_:console.error('Une erreur est survenue au cours de la compilation du shader: '+m.getShaderInfoLog(_))}}},function(n,o,d){'use strict';var l=d(1);o.a=class{constructor(m,T){this.geom=m,this.program=T,this.uniforms=[],this.globalUniforms=[],this.textures=[],this.localCalls=[],this.globalCalls=[],this.order=1,this.visible=!0,this.depthTest=!1,this._isInitialized=!1}addUniform(m){this.uniforms.push(m)}rmUniform(m){const T=this.uniforms.indexOf(m);-1<T&&this.uniforms.splice(T,1)}addGlobalUniform(m){this.globalUniforms.push(m)}rmGlobalUniform(m){const T=this.globalUniforms.indexOf(m);-1<T&&this.globalUniforms.splice(T,1)}addTexture(m){this.textures.push(m)}rmTexture(m){const T=this.textures.indexOf(m);-1<T&&this.textures.splice(T,1)}isInitialized(){let m=this._isInitialized;if(m)return m;this.program.isInitialized()||(m=!1);for(const T of this.geom.attributes)T.isInitialized()||(m=!1);for(const T of this.geom.buffers)T.isInitialized()||(m=!1);for(const T of this.textures)T.isInitialized()||(m=!1);return m}_setCalls(m){const T=this.program;for(const I of this.geom.attributes){const _=T.getAttribLocation(m,I);this.localCalls.push(I.bind.bind(I,m,_))}for(const I of this.geom.buffers)this.localCalls.push(I.bind.bind(I,m));for(const I of this.uniforms){const _=T.getUniformLocation(m,I);this.localCalls.push(I.bind.bind(I,m,_))}for(const I of this.textures){const[_,E]=T.getTextureLocationIndex(m,I);this.localCalls.push(I.bind.bind(I,m,_,E))}for(const I of this.globalUniforms){const _=T.getUniformLocation(m,I);this.globalCalls.push(I.bind.bind(I,m,_))}}_initData(m){this.program;let I=!0;for(const _ of this.geom.attributes)_.isInitialized()||_.init(m)||(I=!1);for(const _ of this.geom.buffers)_.isInitialized()||_.init(m)||(I=!1);for(const _ of this.textures)_.isInitialized()||_.init(m)||(I=!1);return I}dispose(){this._isInitialized=!1,this.localCalls.length=0}init(m){this.program;let I=!0;return this.program.isInitialized()?this.program.bind(m):!this.program.init(m)&&(I=!1),this._initData(m)||(I=!1),I&&1>this.localCalls.length&&this._setCalls(m),this._callOptimizer=l.a.getInstance(m),this._isInitialized=I,I}draw(m,T=[]){this._callOptimizer.optimizeDepthTest(this.depthTest)||(this.depthTest?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST));const I=this.program;if(!this._callOptimizer.optimizeProgram(I)){this.program.bind(m);for(const _ of this.globalCalls)_()}for(const _ of this.localCalls)_();for(const _ of T)_();this.geom.display(m)}}},function(n,o,d){'use strict';var l=d(7),u=d(8);class m{constructor(){this.attributes=[],this.buffers=[],this.hasIndices=!1,this.numItems=0}addVertices(T,I,_){const E=new u.a(T);E.setArray(new Float32Array(I),34962),E.setItems(5126,_),this.attributes.push(E),1>this.numItems&&(this.numItems=I.length/_)}addIndices(T){this.hasIndices=!0;const I=new l.a;I.setArray(new Uint16Array(T),34963),I.setItems(5125,1),this.buffers.push(I),this.numItems=T.length}display(T){this.hasIndices?T.drawElements(T.TRIANGLES,this.numItems,T.UNSIGNED_SHORT,0):T.drawArrays(T.TRIANGLES,0,this.numItems)}clone(T=new m){return T.attributes=this.attributes.map((I)=>I.clone()),T.buffers=this.buffers.map((I)=>I.clone()),T.hasIndices=this.hasIndices,T.numItems=this.numItems,T}}o.a=m},function(n,o,d){'use strict';var l=d(3),u=d(9);class m extends l.a{constructor(T,I){super(T,I),this.depthTest=!0,this._initTransform3D()}_initTransform3D(){const T=new u.a('uMVMatrix'),I=T.data;this.transform3D=T,this.matrix4=I,this.translate=I.translate.bind(I),this.scale=I.scale.bind(I),this.rotate=I.rotate.bind(I),this.rotateX=I.rotateX.bind(I),this.rotateY=I.rotateY.bind(I),this.rotateZ=I.rotateZ.bind(I),this.lookAt=I.lookAt.bind(I),this.addUniform(T)}get position(){return this.transform3D.getTranslation()}get rotation(){return this.transform3D.getRotation()}}o.a=m},function(n,o){'use strict';function l(T,I,_,E,P,D,L,A,U,C,R,O,M,v,N,F,X){T[0]=I,T[1]=_,T[2]=E,T[3]=P,T[4]=D,T[5]=L,T[6]=A,T[7]=U,T[8]=C,T[9]=R,T[10]=O,T[11]=M,T[12]=v,T[13]=N,T[14]=F,T[15]=X}const u=1e-6;class m extends Float32Array{constructor(){super(16),this[0]=1,this[5]=1,this[10]=1,this[15]=1}clone(){const T=new m;return T.set(this),T}copy(T){return T.set(this),this}identity(){return l(this,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}add(T){return this[0]+=T[0],this[1]+=T[1],this[2]+=T[2],this[3]+=T[3],this[4]+=T[4],this[5]+=T[5],this[6]+=T[6],this[7]+=T[7],this[8]+=T[8],this[9]+=T[9],this[10]+=T[10],this[11]+=T[11],this[12]+=T[12],this[13]+=T[13],this[14]+=T[14],this[15]+=T[15],this}subtract(T){return this[0]-=T[0],this[1]-=T[1],this[2]-=T[2],this[3]-=T[3],this[4]-=T[4],this[5]-=T[5],this[6]-=T[6],this[7]-=T[7],this[8]-=T[8],this[9]-=T[9],this[10]-=T[10],this[11]-=T[11],this[12]-=T[12],this[13]-=T[13],this[14]-=T[14],this[15]-=T[15],this}multiplyScalar(T){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this[4]*=T,this[5]*=T,this[6]*=T,this[7]*=T,this[8]*=T,this[9]*=T,this[10]*=T,this[11]*=T,this[12]*=T,this[13]*=T,this[14]*=T,this[15]*=T,this}multiplyScalarAndAdd(T,I){return this[0]+=T[0]*I,this[1]+=T[1]*I,this[2]+=T[2]*I,this[3]+=T[3]*I,this[4]+=T[4]*I,this[5]+=T[5]*I,this[6]+=T[6]*I,this[7]+=T[7]*I,this[8]+=T[8]*I,this[9]+=T[9]*I,this[10]+=T[10]*I,this[11]+=T[11]*I,this[12]+=T[12]*I,this[13]+=T[13]*I,this[14]+=T[14]*I,this[15]+=T[15]*I,this}exactEquals(T){return this[0]===T[0]&&this[1]===T[1]&&this[2]===T[2]&&this[3]===T[3]&&this[4]===T[4]&&this[5]===T[5]&&this[6]===T[6]&&this[7]===T[7]&&this[8]===T[8]&&this[9]===T[9]&&this[10]===T[10]&&this[11]===T[11]&&this[12]===T[12]&&this[13]===T[13]&&this[14]===T[14]&&this[15]===T[15]}equals(T){const[I,_,E,P,D,L,A,U,C,R,O,M,v,N,F,X]=this,[G,B,Z,q,k,Y,W,H,V,j,K,J,Q,$,ee,ae]=T;return _Mathabs(I-G)<=u*_Mathmax(1,_Mathabs(I),_Mathabs(G))&&_Mathabs(_-B)<=u*_Mathmax(1,_Mathabs(_),_Mathabs(B))&&_Mathabs(E-Z)<=u*_Mathmax(1,_Mathabs(E),_Mathabs(Z))&&_Mathabs(P-q)<=u*_Mathmax(1,_Mathabs(P),_Mathabs(q))&&_Mathabs(D-k)<=u*_Mathmax(1,_Mathabs(D),_Mathabs(k))&&_Mathabs(L-Y)<=u*_Mathmax(1,_Mathabs(L),_Mathabs(Y))&&_Mathabs(A-W)<=u*_Mathmax(1,_Mathabs(A),_Mathabs(W))&&_Mathabs(U-H)<=u*_Mathmax(1,_Mathabs(U),_Mathabs(H))&&_Mathabs(C-V)<=u*_Mathmax(1,_Mathabs(C),_Mathabs(V))&&_Mathabs(R-j)<=u*_Mathmax(1,_Mathabs(R),_Mathabs(j))&&_Mathabs(O-K)<=u*_Mathmax(1,_Mathabs(O),_Mathabs(K))&&_Mathabs(M-J)<=u*_Mathmax(1,_Mathabs(M),_Mathabs(J))&&_Mathabs(v-Q)<=u*_Mathmax(1,_Mathabs(v),_Mathabs(Q))&&_Mathabs(N-$)<=u*_Mathmax(1,_Mathabs(N),_Mathabs($))&&_Mathabs(F-ee)<=u*_Mathmax(1,_Mathabs(F),_Mathabs(ee))&&_Mathabs(X-ae)<=u*_Mathmax(1,_Mathabs(X),_Mathabs(ae))}transpose(T){if(T===this){const I=T[1],_=T[2],E=T[3],P=T[6],D=T[7],L=T[11];this[1]=T[4],this[2]=T[8],this[3]=T[12],this[4]=I,this[6]=T[9],this[7]=T[13],this[8]=_,this[9]=P,this[11]=T[14],this[12]=E,this[13]=D,this[14]=L}else l(this,T[0],T[4],T[8],T[12],T[1],T[5],T[9],T[13],T[2],T[6],T[10],T[14],T[3],T[7],T[11],T[15]);return this}invert(){const[T,I,_,E,P,D,L,A,U,C,R,O,M,v,N,F]=this,X=T*D-I*P,G=T*L-_*P,B=T*A-E*P,Z=I*L-_*D,q=I*A-E*D,k=_*A-E*L,Y=U*v-C*M,W=U*N-R*M,H=U*F-O*M,V=C*N-R*v,j=C*F-O*v,K=R*F-O*N;let J=X*K-G*j+B*V+Z*H-q*W+k*Y;return J?(J=1/J,l(this,(D*K-L*j+A*V)*J,(_*j-I*K-E*V)*J,(v*k-N*q+F*Z)*J,(R*q-C*k-O*Z)*J,(L*H-P*K-A*W)*J,(T*K-_*H+E*W)*J,(N*B-M*k-F*G)*J,(U*k-R*B+O*G)*J,(P*j-D*H+A*Y)*J,(I*H-T*j-E*Y)*J,(M*q-v*B+F*X)*J,(C*B-U*q-O*X)*J,(D*W-P*V-L*Y)*J,(T*V-I*W+_*Y)*J,(v*G-M*Z-N*X)*J,(U*Z-C*G+R*X)*J),this):this}adjoint(){const[T,I,_,E,P,D,L,A,U,C,R,O,M,v,N,F]=this;return l(this,D*(R*F-O*N)-C*(L*F-A*N)+v*(L*O-A*R),-(I*(R*F-O*N)-C*(_*F-E*N)+v*(_*O-E*R)),I*(L*F-A*N)-D*(_*F-E*N)+v*(_*A-E*L),-(I*(L*O-A*R)-D*(_*O-E*R)+C*(_*A-E*L)),-(P*(R*F-O*N)-U*(L*F-A*N)+M*(L*O-A*R)),T*(R*F-O*N)-U*(_*F-E*N)+M*(_*O-E*R),-(T*(L*F-A*N)-P*(_*F-E*N)+M*(_*A-E*L)),T*(L*O-A*R)-P*(_*O-E*R)+U*(_*A-E*L),P*(C*F-O*v)-U*(D*F-A*v)+M*(D*O-A*C),-(T*(C*F-O*v)-U*(I*F-E*v)+M*(I*O-E*C)),T*(D*F-A*v)-P*(I*F-E*v)+M*(I*A-E*D),-(T*(D*O-A*C)-P*(I*O-E*C)+U*(I*A-E*D)),-(P*(C*N-R*v)-U*(D*N-L*v)+M*(D*R-L*C)),T*(C*N-R*v)-U*(I*N-_*v)+M*(I*R-_*C),-(T*(D*N-L*v)-P*(I*N-_*v)+M*(I*L-_*D)),T*(D*R-L*C)-P*(I*R-_*C)+U*(I*L-_*D)),this}determinant(){const[T,I,_,E,P,D,L,A,U,C,R,O,M,v,N,F]=this;return(T*D-I*P)*(R*F-O*N)-(T*L-_*P)*(C*F-O*v)+(T*A-E*P)*(C*N-R*v)+(I*L-_*D)*(U*F-O*M)-(I*A-E*D)*(U*N-R*M)+(_*A-E*L)*(U*v-C*M)}multiply(T){const[I,_,E,P,D,L,A,U,C,R,O,M,v,N,F,X]=this;let[G,B,Z,q]=T;return this[0]=G*I+B*D+Z*C+q*v,this[1]=G*_+B*L+Z*R+q*N,this[2]=G*E+B*A+Z*O+q*F,this[3]=G*P+B*U+Z*M+q*X,G=T[4],B=T[5],Z=T[6],q=T[7],this[4]=G*I+B*D+Z*C+q*v,this[5]=G*_+B*L+Z*R+q*N,this[6]=G*E+B*A+Z*O+q*F,this[7]=G*P+B*U+Z*M+q*X,G=T[8],B=T[9],Z=T[10],q=T[11],this[8]=G*I+B*D+Z*C+q*v,this[9]=G*_+B*L+Z*R+q*N,this[10]=G*E+B*A+Z*O+q*F,this[11]=G*P+B*U+Z*M+q*X,G=T[12],B=T[13],Z=T[14],q=T[15],this[12]=G*I+B*D+Z*C+q*v,this[13]=G*_+B*L+Z*R+q*N,this[14]=G*E+B*A+Z*O+q*F,this[15]=G*P+B*U+Z*M+q*X,this}translate([T,I,_]){return this[12]=this[0]*T+this[4]*I+this[8]*_+this[12],this[13]=this[1]*T+this[5]*I+this[9]*_+this[13],this[14]=this[2]*T+this[6]*I+this[10]*_+this[14],this[15]=this[3]*T+this[7]*I+this[11]*_+this[15],this}scale([T,I,_]){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this[4]*=I,this[5]*=I,this[6]*=I,this[7]*=I,this[8]*=_,this[9]*=_,this[10]*=_,this[11]*=_,this}rotate(T,[I,_,E]){let P=_Mathsqrt(I*I+_*_+E*E);if(_Mathabs(P)>u){P=1/P,I*=P,_*=P,E*=P;const D=_Mathsin(T),L=_Mathcos(T),A=1-L,[U,C,R,O,M,v,N,F,X,G,B,Z]=this,q=I*I*A+L,k=_*I*A+E*D,Y=E*I*A-_*D,W=I*_*A-E*D,H=_*_*A+L,V=E*_*A+I*D,j=I*E*A+_*D,K=_*E*A-I*D,J=E*E*A+L;this[0]=U*q+M*k+X*Y,this[1]=C*q+v*k+G*Y,this[2]=R*q+N*k+B*Y,this[3]=O*q+F*k+Z*Y,this[4]=U*W+M*H+X*V,this[5]=C*W+v*H+G*V,this[6]=R*W+N*H+B*V,this[7]=O*W+F*H+Z*V,this[8]=U*j+M*K+X*J,this[9]=C*j+v*K+G*J,this[10]=R*j+N*K+B*J,this[11]=O*j+F*K+Z*J}return this}rotateX(T){const I=_Mathsin(T),_=_Mathcos(T),E=this[4],P=this[5],D=this[6],L=this[7],A=this[8],U=this[9],C=this[10],R=this[11];return this[4]=E*_+A*I,this[5]=P*_+U*I,this[6]=D*_+C*I,this[7]=L*_+R*I,this[8]=A*_-E*I,this[9]=U*_-P*I,this[10]=C*_-D*I,this[11]=R*_-L*I,this}rotateY(T){const I=_Mathsin(T),_=_Mathcos(T),[E,P,D,L]=this,A=this[8],U=this[9],C=this[10],R=this[11];return this[0]=E*_-A*I,this[1]=P*_-U*I,this[2]=D*_-C*I,this[3]=L*_-R*I,this[8]=E*I+A*_,this[9]=P*I+U*_,this[10]=D*I+C*_,this[11]=L*I+R*_,this}rotateZ(T){const I=_Mathsin(T),_=_Mathcos(T),[E,P,D,L,A,U,C,R]=this;return this[0]=E*_+A*I,this[1]=P*_+U*I,this[2]=D*_+C*I,this[3]=L*_+R*I,this[4]=A*_-E*I,this[5]=U*_-P*I,this[6]=C*_-D*I,this[7]=R*_-L*I,this}fromTranslation(T){return l(this,1,0,0,0,0,1,0,0,0,0,1,0,T[0],T[1],T[2],1),this}fromScaling(T){return l(this,T[0],0,0,0,0,T[1],0,0,0,0,T[2],0,0,0,0,1),this}fromRotation(T,[I,_,E]){let P=_Mathsqrt(I*I+_*_+E*E);if(_Mathabs(P)>u){P=1/P,I*=P,_*=P,E*=P;const D=_Mathsin(T),L=_Mathcos(T),A=1-L;l(this,I*I*A+L,_*I*A+E*D,E*I*A-_*D,0,I*_*A-E*D,_*_*A+L,E*_*A+I*D,0,I*E*A+_*D,_*E*A-I*D,E*E*A+L,0,0,0,0,1)}return this}fromXRotation(T){const I=_Mathsin(T),_=_Mathcos(T);return l(this,1,0,0,0,0,_,I,0,0,-I,_,0,0,0,0,1),this}fromYRotation(T){const I=_Mathsin(T),_=_Mathcos(T);return l(this,_,0,-I,0,0,1,0,0,I,0,_,0,0,0,0,1),this}fromZRotation(T){const I=_Mathsin(T),_=_Mathcos(T);return l(this,_,I,0,0,-I,_,0,0,0,0,1,0,0,0,0,1),this}fromQuat(T){const[I,_,E,P]=T,D=I+I,L=_+_,A=E+E,U=I*D,C=_*D,R=_*L,O=E*D,M=E*L,v=E*A,N=P*D,F=P*L,X=P*A;return l(this,1-R-v,C+X,O-F,0,C-X,1-U-v,M+N,0,O+F,M-N,1-U-R,0,0,0,0,1),this}fromRotationTranslation(T,I){const[_,E,P,D]=T,L=_+_,A=E+E,U=P+P,C=_*L,R=_*A,O=_*U,M=E*A,v=E*U,N=P*U,F=D*L,X=D*A,G=D*U;return l(this,1-(M+N),R+G,O-X,0,R-G,1-(C+N),v+F,0,O+X,v-F,1-(C+M),0,I[0],I[1],I[2],1),this}fromRotationTranslationScale(T,I,[_,E,P]){const[D,L,A,U]=T,C=D+D,R=L+L,O=A+A,M=D*C,v=D*R,N=D*O,F=L*R,X=L*O,G=A*O,B=U*C,Z=U*R,q=U*O;return l(this,(1-(F+G))*_,(v+q)*_,(N-Z)*_,0,(v-q)*E,(1-(M+G))*E,(X+B)*E,0,(N+Z)*P,(X-B)*P,(1-(M+F))*P,0,I[0],I[1],I[2],1),this}fromRotationTranslationScaleOrigin(T,I,_,E){const[P,D,L,A]=T,U=P+P,C=D+D,R=L+L,O=P*U,M=P*C,v=P*R,N=D*C,F=D*R,X=L*R,G=A*U,B=A*C,Z=A*R,[q,k,Y]=_,[W,H,V]=E;return l(this,(1-(N+X))*q,(M+Z)*q,(v-B)*q,0,(M-Z)*k,(1-(O+X))*k,(F+G)*k,0,(v+B)*Y,(F-G)*Y,(1-(O+N))*Y,0,I[0]+W-(this[0]*W+this[4]*H+this[8]*V),I[1]+H-(this[1]*W+this[5]*H+this[9]*V),I[2]+V-(this[2]*W+this[6]*H+this[10]*V),1),this}getTranslation(T=new Float32Array(3)){return T[0]=this[12],T[1]=this[13],T[2]=this[14],T}getRotation(T=new Float32Array(4)){var I=this[0]+this[5]+this[10];if(0<I){const _=2*_Mathsqrt(I+1);T[0]=(this[6]-this[9])/_,T[1]=(this[8]-this[2])/_,T[2]=(this[1]-this[4])/_,T[3]=0.25*_}else if(this[0]>this[5]&this[0]>this[10]){const _=2*_Mathsqrt(1+this[0]-this[5]-this[10]);T[0]=0.25*_,T[1]=(this[1]+this[4])/_,T[2]=(this[8]+this[2])/_,T[3]=(this[6]-this[9])/_}else if(this[5]>this[10]){const _=_Mathsqrt(1+this[5]-this[0]-this[10]);T[0]=2*((this[1]+this[4])/_),T[1]=0.25*_,T[2]=(this[6]+this[9])/_,T[3]=(this[8]-this[2])/_}else{const _=2*_Mathsqrt(1+this[10]-this[0]-this[5]);T[0]=(this[8]+this[2])/_,T[1]=(this[6]+this[9])/_,T[2]=0.25*_,T[3]=(this[1]-this[4])/_}return T}frustrum(T,I,_,E,P,D){const L=1/(I-T),A=1/(E-_),U=1/(P-D);return l(this,2*P*L,0,0,0,0,2*P*A,0,0,(I+T)*L,(E+_)*A,(D+P)*U,-1,0,0,2*(D*P)*U,0),this}perspective(T,I,_,E){const P=1/_Mathtan(T/2),D=1/(_-E);return l(this,P/I,0,0,0,0,P,0,0,0,0,(E+_)*D,-1,0,0,2*E*_*D,0),this}perspectiveFromFieldOfView(T,I,_){const E=_Mathtan(T.upDegrees*_MathPI/180),P=_Mathtan(T.downDegrees*_MathPI/180),D=_Mathtan(T.leftDegrees*_MathPI/180),L=_Mathtan(T.rightDegrees*_MathPI/180),A=2/(D+L),U=2/(E+P);return l(this,A,0,0,0,0,U,0,0,0.5*(-(D-L)*A),0.5*((E-P)*U),_/(I-_),-1,0,0,_*I/(I-_),0),this}ortho(T,I,_,E,P,D){const L=1/(T-I),A=1/(_-E),U=1/(P-D);return l(this,-2*L,0,0,0,0,-2*A,0,0,0,0,2*U,0,(T+I)*L,(E+_)*A,(D+P)*U,1),this}lookAt(T,I,_){const[E,P,D]=T,[L,A,U]=_,[C,R,O]=I;if(_Mathabs(E-C)<u&&_Mathabs(P-R)<u&&_Mathabs(D-O)<u)return this.identity();let M=E-C,v=P-R,N=D-O,F=1/_Mathsqrt(M*M+v*v+N*N);M*=F,v*=F,N*=F;let X=A*N-U*v,G=U*M-L*N,B=L*v-A*M;F=_Mathsqrt(X*X+G*G+B*B),F?(F=1/F,X*=F,G*=F,B*=F):(X=0,G=0,B=0);let Z=v*B-N*G,q=N*X-M*B,k=M*G-v*X;return F=_Mathsqrt(Z*Z+q*q+k*k),F?(F=1/F,Z*=F,q*=F,k*=F):(Z=0,q=0,k=0),l(this,X,Z,M,0,G,q,v,0,B,k,N,0,-(X*E+G*P+B*D),-(Z*E+q*P+k*D),-(M*E+v*P+N*D),1),this}frob(){return _Mathsqrt(_Mathpow(this[0],2)+_Mathpow(this[1],2)+_Mathpow(this[2],2)+_Mathpow(this[3],2)+_Mathpow(this[4],2)+_Mathpow(this[5],2)+_Mathpow(this[6],2)+_Mathpow(this[7],2)+_Mathpow(this[8],2)+_Mathpow(this[9],2)+_Mathpow(this[10],2)+_Mathpow(this[11],2)+_Mathpow(this[12],2)+_Mathpow(this[13],2)+_Mathpow(this[14],2)+_Mathpow(this[15],2))}}o.a=m},function(n,o){'use strict';class l{constructor(){this.pointer=null,this.gl=null,this.arrayType=34962,this.data=null,this.arrayUsage=35044}isInitialized(){return!!this.pointer}setArray(u,m=this.arrayType,T=this.arrayUsage){this.arrayType=m,this.data=u,this.arrayUsage=T;const I=this.gl;I&&(I.bindBuffer(m,this.pointer),I.bufferData(m,u,arrayUsage))}setItems(u=5126,m=3,T=null){this.itemType=u,this.itemSize=m}init(u){const m=u.createBuffer();return u.bindBuffer(this.arrayType,m),u.bufferData(this.arrayType,this.data,this.arrayUsage),this.pointer=m,this.gl=u,!0}bind(u){u.bindBuffer(this.arrayType,this.pointer)}clone(u=new l){return u.setArray(this.data,this.arrayType,this.arrayUsage),u.setItems(this.itemType,this.itemSize),u}}o.a=l},function(n,o,d){'use strict';var l=d(7);class u extends l.a{constructor(m){super(),this.label=m}bind(m,T){super.bind(m),m.vertexAttribPointer(T,this.itemSize,this.itemType,!1,0,0)}clone(m=new u(this.label)){return m.label=this.label,super.clone(m),m}}o.a=u},function(n,o,d){'use strict';var l=d(6),u=d(0);class m extends u.a{constructor(T){super(T,35676,new l.a().identity())}}o.a=m},function(n,o,d){'use strict';var l=d(1);class u{constructor(m,T={antialias:!0,stencil:!0}){this.canvas=m,this.init(m,T),this.meshs=[],this.depthTest=!0,this.sortCompare=(I,_)=>{if(I.order!==_.order)return I.order-_.order;return I.program&&_.program&&I.program!==_.program?I.program.id-_.program.id:I.textures&&_.textures&&0<I.textures.length&&0<I.textures.length?I.textures[0].id-_.textures[1].id:0},this.resize(m.width,m.height)}addMesh(m){this.meshs.push(m),m.isInitialized()||m.init(this.gl,this.uniforms)}rmMesh(m){const T=this.meshs.indexOf(m);-1<T&&this.meshs.splice(T,1)}sort(){this.meshs.sort(this.sortCompare)}resize(m,T){this.width=m,this.height=T}init(m,T){let I;try{I=m.getContext('webgl',T)||m.getContext('experimental-webgl',T)}catch(_){console.error('Could not initialise WebGL:',_.message)}I||console.error('Could not initialise WebGL'),this._callOptimizer=l.a.getInstance(I),this.gl=I}set bgColor([m,T,I,_=1]){this.gl.clearColor(m,T,I,_),this._bgColor=[m,T,I,_]}get bgColor(){return this._bgColor}draw(){const m=this.gl;this._callOptimizer.optimizeDepthTest(this.depthTest)||(this.depthTest?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST)),m.viewport(0,0,this.width,this.height),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT|m.STENCIL_BUFFER_BIT);for(const T of this.meshs)T.visible&&(T.isInitialized()?T.draw(m):T.init(m,this.uniforms))}}o.a=u},function(n,o,d){'use strict';var u=d(12);class m extends u.a{constructor(T){super(T),this.srcs=[],this.setTempColor([255,255,255,255])}setTempColor(T){this.setImg(new Uint8Array(T),1,1)}addURL(T,I=0){const _={size:I,src:T,img:null,priority:0,isImage:!0,isValid:()=>!0,init:null};_.init=(E)=>{E.bindTexture(E.TEXTURE_2D,this.pointer),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,!0),E.texImage2D(E.TEXTURE_2D,0,6408,this.format,E.UNSIGNED_BYTE,_.img),this.img=_.img,this.initParams(E)},this.srcs.push(_)}static START_LOAD(T,I){if(0<I.length){I.sort((E,P)=>E.size===P.size?E.size-P.size:E.priority-P.priority);I.filter((E)=>E.size>=u.a.MAX_SIZE&&E.isValid(T));if(1<I.length){const E=I[0],P=I[I.length-1];m.LOAD(E,()=>{E.init(T),m.LOAD(P,()=>{P.init(T)})})}else if(0<I.length){const E=I[0];m.LOAD(E,()=>{E.init(T)})}else console.warn('The GPU can\'nt load a texture with size > ',u.a.MAX_SIZE)}else console.warn('URL of your smart texture not found')}static LOAD(T,I){if(T.isImage){const _=new Image;_.onload=()=>{I(T)},T.img=_,_.src=T.src}else{const _=new XMLHttpRequest;_.responseType='arraybuffer',_.open('GET',T.src,!0),_.onreadystatechange=()=>{_.readyState===XMLHttpRequest.DONE&&(200===_.status?(T.img=_.response,I(T)):console.error('fail to load image ',T.src,'status:',_.status,'statuc text:',_.statusText))},_.send()}}init(T,I){const _=super.init(T,I),E=this.pointer;return m.START_LOAD(T,this.srcs),_}}o.a=m},function(n,o,d){'use strict';var l=d(1);let u=0;class m{constructor(T){this.id=u++,this.label=T,this.mipmap=!0,this.img=null,this.width=null,this.height=null,this.pointer=null,this.parameters=[],this.setType(),this.setInternalFormat(),this.setFormat(),this.setTarget()}resize(T,I,_=null){this.width=T,this.height=I,_?(_.bindTexture(this.target,this.pointer),_.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img)):this.updated=!0}setTempColor(T){this.setImg(new Uint8Array(T),1,1)}setImg(T=new Uint8Array([255,255,255,255]),I=1,_=1){this.img=T,this.width=I,this.height=_}setType(T=5121){this.type=T}setInternalFormat(T=6408){this.internalFormat=T}setFormat(T=6408){this.format=T}setTarget(T=3553){this.target=T}setParam(T,I){const _=this.parameters.find((E)=>E[0]===T);-1<_?this.parameters[_][1]=I:this.parameters.push([T,I])}isInitialized(){return!!this.pointer}static IS_POWER_OF_2(T){return 0==(T&T-1)}static SET_DATA(T){m.MAX_SIZE=T.getParameter(T.MAX_TEXTURE_SIZE),m.FORMAT={};const I=T.getParameter(T.COMPRESSED_TEXTURE_FORMATS);for(let _=0;_<I.length;_++)m.FORMAT[I[_]]=!0;m._DATA_INITIALIZED=!0}setDefaultParams(T){this.mipmap?this.setParam(T.TEXTURE_MIN_FILTER,T.LINEAR_MIPMAP_LINEAR):(this.setParam(T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),this.setParam(T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),this.setParam(T.TEXTURE_MIN_FILTER,T.LINEAR))}initParams(T){if(this.mipmap){const I=this.img;null===I?console.warn('You need an image to set the parameters of texture'):m.IS_POWER_OF_2(I.width)&&m.IS_POWER_OF_2(I.height)?T.generateMipmap(this.target):(this.mipmap=!1,console.warn('You need a power of 2 for the size of the mipmaped texture'))}1>this.parameters.length&&this.setDefaultParams(T);for(const[I,_]of this.parameters)T.texParameteri(this.target,I,_)}init(T){const I=T.createTexture();return m._DATA_INITIALIZED||m.SET_DATA(T),T.bindTexture(this.target,I),T.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.initParams(T),this._callOptimizer=l.a.getInstance(T),this.pointer=I,!0}bind(T,I,_){this._callOptimizer.optimizeTexture(this)||(T.uniform1i(I,_),T.activeTexture(T.TEXTURE0+_),T.bindTexture(this.target,this.pointer),this.updated&&(T.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.updated=!1))}free(T){T.bindTexture(T.TEXTURE_2D,null)}}o.a=m},function(n,o,d){'use strict';var l=d(6),u=d(0);class m extends u.a{constructor(){super('uPMatrix',35676,new l.a),this.fovy=45,this.near=0.1,this.far=100;const T=new l.a;this._matrix=T,this.updated=!0,this.updateNum=0,this._ratio=0,this.clear=()=>{T.identity(),this.updated=!0},this.translate=(I)=>{T.translate(I),this.updated=!0},this.scale=(I)=>{T.scale(I),this.updated=!0},this.rotate=(I,_)=>{T.rotate(I,_),this.updated=!0},this.rotateX=(I)=>{T.rotateX(I),this.updated=!0},this.rotateY=(I)=>{T.rotateY(I),this.updated=!0},this.rotateZ=(I)=>{T.rotateZ(I),this.updated=!0},this.lookAt=(I,_,E)=>{T.lookAt(I,_,E),this.updated=!0}}get data(){return this.updated&&this.update(),this._data}get ratio(){return this._ratio}set ratio(T){this._ratio=T,this.updated=!0}resize(T,I){this._ratio=T/I,this.updated=!0}update(){this._data.perspective(this.fovy*_MathPI/180,this._ratio,this.near,this.far),this._data.multiply(this._matrix),this.updated=!1,this.updateNum++}}o.a=m},,,,,,,,,,,,function(n,o,d){'use strict';function u(A,U,C){const R=[],O=[];let M;for(const v of A.camera){const N=C.initCamera3D(v);N.name=v.name,N.fovy=v.fovy,N.near=v.near,N.far=v.far;const F=v.transform;N.lookAt(F.pos,F.lookAt,F.up),R.push(N),M||(M=N)}for(const v of A.mesh){const N=C.initdMesh3D(v);N.name=v.name;const F=v.transform;N.translate(F.pos),M&&N.addGlobalUniform(M);const X=F.rot;if(N.rotateZ(X[2]*_MathPI/180),N.rotateY(X[1]*_MathPI/180),N.rotateX(X[0]*_MathPI/180),v.geom){const G=v.geom,B=N.geom;G.vertices&&B.addVertices('aVertexPosition',G.vertices,3),G.uv&&B.addVertices('aTextureCoord',G.uv,2),G.indices&&B.addIndices(G.indices)}O.push(N)}U({camera:R,mesh:O})}function m(A,U,C){const R=new XMLHttpRequest;R.open('GET',A,!0),R.overrideMimeType('application/json'),R.onreadystatechange=()=>{if(4===R.readyState)if(200===R.status){let O;try{O=JSON.parse(R.responseText)}catch(M){return C.onError(M.message)}u(O,U,C)}else C.onError(R)},R.send(null)}var T=d(5),I=d(13),_=d(2),E=d(4);const P=`attribute vec3 aVertexPosition;
uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;
void main(void){
gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition,1.0);
}`,D=`precision mediump float;
void main(void){
gl_FragColor = vec4(1.0,1.0,1.0,1.0);
}`;o.a=function(A,U,{onError:C=(M)=>{throw new Error('Mesh load error '+M)},initCamera3D:R=()=>new I.a,initdMesh3D:O=()=>new T.a(new E.a(),new _.a(P,D))}){m(A,U,{onError:C,initCamera3D:R,initdMesh3D:O})}},,function(n,o,d){'use strict';function u(){const N=[window.innerWidth,window.innerHeight];A.resize(N[0],N[1]),L.width=N[0],L.height=N[1],U.resize(...N)}function m(){if(U){U.clear();const N=15*_Mathcos(1e-3*Date.now()),F=15*_Mathsin(1e-3*Date.now());U.lookAt([N,10,F],[0,0,0],[0,1,0])}A.draw(),requestAnimationFrame(m)}Object.defineProperty(o,'__esModule',{value:!0});var T=d(2),I=d(4),_=d(11),E=d(5),P=d(10),D=d(25);const L=document.body.querySelector('canvas'),A=new P.a(L);A.bgColor=[1,1,1,1],A.depthTest=!0;let U;const C=`      
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec4 vColor;
    varying vec2 vTextureCoord;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vColor = vec4(normalize(aVertexPosition), 1.0);
        vTextureCoord = aTextureCoord;
    }
`,R=`
    precision mediump float;

    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uDiffuse;

    void main(void) {
        vec4 color = texture2D(uDiffuse, vec2(vTextureCoord.s, vTextureCoord.t));
        gl_FragColor = color;
    }
`,O=new _.a('uDiffuse');O.addURL('assets/suzanne-plane-diffuse.jpg');const M=new _.a('uDiffuse');M.addURL('assets/suzanne-diffuse.jpg');const v=new _.a('uDiffuse');v.addURL('assets/suzanne-cube-diffuse.jpg'),d.i(D.a)('assets/suzanne.min.json',({camera:N,mesh:F})=>{U=N[0];for(const X of F)A.addMesh(X);u()},{initdMesh3D:function(N){const F=new E.a(new I.a(),new T.a(C,R));switch(N.name){case'Suzanne':F.addTexture(M);break;case'Cube':F.addTexture(v);break;case'Plane':F.addTexture(O);break;default:throw new Error('Mesh unexpected '+N.name);}return F}}),window.onresize=u,m()}]);