var _Mathpow=Math.pow,_MathPI=Math.PI,_Mathtan=Math.tan,_Mathcos=Math.cos,_Mathsin=Math.sin,_Mathsqrt=Math.sqrt,_Mathmax=Math.max,_Mathabs=Math.abs;(function(n){function o(u){if(d[u])return d[u].exports;var l=d[u]={i:u,l:!1,exports:{}};return n[u].call(l.exports,l,l.exports,o),l.l=!0,l.exports}var d={};return o.m=n,o.c=d,o.i=function(u){return u},o.d=function(u,l,m){o.o(u,l)||Object.defineProperty(u,l,{configurable:!1,enumerable:!0,get:m})},o.n=function(u){var l=u&&u.__esModule?function(){return u['default']}:function(){return u};return o.d(l,'a',l),l},o.o=function(u,l){return Object.prototype.hasOwnProperty.call(u,l)},o.p='',o(o.s=28)})([function(n,o){'use strict';class u{constructor(l,m,T,I=!1){this.label=l,this.type=m,this._data=T,this._init(m,I)}get data(){return this._data}set data(l){this._data=l}_init(l){switch(this.type){case 35675:{this.bind=(T,I)=>{T.uniformMatrix3fv(I,!1,this.data)};break}case 35676:{this.bind=(T,I)=>{T.uniformMatrix4fv(I,!1,this.data)};break}case 35665:{this.bind=(T,I)=>{T.uniform3f(I,...this.data)};break}case 5124:this.bind=(T,I)=>{T.uniform1i(I,this.data)};break;case-1:this.bind=(T,I)=>{T.uniform1fv(I,this.data)};break;default:console.error('Uniform type unknow: {label:',this.label,', type:',l,'}');}}}o.a=u},function(n,o){'use strict';class u{constructor(){this.lastTexture=null,this.lastProgram=null,this.lastDepthTest=!1}optimizeTexture(l){const m=this.lastTexture;return this.lastTexture=l,l===m}optimizeProgram(l){const m=this.lastProgram;return this.lastProgram=l,l===m}optimizeDepthTest(l){const m=this.lastDepthTest;return this.lastDepthTest=l,m===l}static getInstance(l){const m=u.glList.indexOf(l);if(0>m){const T=new u;return u.glList.push(l),u.list.push(T),T}return u.list[m]}}u.glList=[],u.list=[],o.a=u},function(n,o){'use strict';let u=0;o.a=class{constructor(m,T){this.vertexShaderSrc=m,this.fragmentShaderSrc=T,this.attribLocation={},this.uniformLocation={},this.textureLocation={},this.textureIndex={},this.textureNum=0,this.id=u++}isInitialized(){return!!this.pointer}init(m){this.vertexShader=this._createShader(m,35633,this.vertexShaderSrc),this.fragmentShader=this._createShader(m,35632,this.fragmentShaderSrc);const T=m.createProgram();return(m.attachShader(T,this.vertexShader),m.attachShader(T,this.fragmentShader),m.linkProgram(T),!m.getProgramParameter(T,m.LINK_STATUS))?(console.error('Shader initialization error'),!1):(m.useProgram(T),this.pointer=T,!0)}getAttribLocation(m,T){const I=T.label;if(!this.attribLocation.hasOwnProperty(I)){const _=m.getAttribLocation(this.pointer,I);return m.enableVertexAttribArray(_),this.attribLocation[I]=_,_}return this.attribLocation[I]}getUniformLocation(m,T){const I=T.label;if(!this.uniformLocation.hasOwnProperty(I)){const _=m.getUniformLocation(this.pointer,I);return this.uniformLocation[I]=_,_}return this.uniformLocation[I]}getTextureLocationIndex(m,T){const I=T.label;if(!this.textureLocation.hasOwnProperty(I)||!this.textureIndex.hasOwnProperty(I)){const _=m.getUniformLocation(this.pointer,I);return this.textureLocation[I]=_,this.textureIndex[I]=this.textureNum,[_,this.textureNum++]}return[this.textureLocation[I],this.textureIndex[I]]}bind(m){m.useProgram(this.pointer)}_createShader(m,T,I){const _=m.createShader(T);return m.shaderSource(_,I),m.compileShader(_),m.getShaderParameter(_,m.COMPILE_STATUS)?_:console.error('Une erreur est survenue au cours de la compilation du shader: '+m.getShaderInfoLog(_))}}},function(n,o,d){'use strict';var u=d(5),l=d(10);class m extends u.a{constructor(T,I){super(T,I),this.depthTest=!0;const _=new l.a('uMVMatrix');this.transform=_,this.addUniform(_)}get position(){return this.transform.getTranslation()}get rotation(){return this.transform.getRotation()}draw(T,I=[]){this.transform&&this.transform.update(),super.draw(T,I)}}o.a=m},function(n,o){'use strict';function u(T,I,_,E,P,L,D,A,U,N,C,R,O,M,v,F,X){T[0]=I,T[1]=_,T[2]=E,T[3]=P,T[4]=L,T[5]=D,T[6]=A,T[7]=U,T[8]=N,T[9]=C,T[10]=R,T[11]=O,T[12]=M,T[13]=v,T[14]=F,T[15]=X}const l=1e-6;class m extends Float32Array{constructor(){super(16),this[0]=1,this[5]=1,this[10]=1,this[15]=1}clone(){const T=new m;return T.set(this),T}copy(T){return T.set(this),this}identity(){return u(this,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}add(T){return this[0]+=T[0],this[1]+=T[1],this[2]+=T[2],this[3]+=T[3],this[4]+=T[4],this[5]+=T[5],this[6]+=T[6],this[7]+=T[7],this[8]+=T[8],this[9]+=T[9],this[10]+=T[10],this[11]+=T[11],this[12]+=T[12],this[13]+=T[13],this[14]+=T[14],this[15]+=T[15],this}subtract(T){return this[0]-=T[0],this[1]-=T[1],this[2]-=T[2],this[3]-=T[3],this[4]-=T[4],this[5]-=T[5],this[6]-=T[6],this[7]-=T[7],this[8]-=T[8],this[9]-=T[9],this[10]-=T[10],this[11]-=T[11],this[12]-=T[12],this[13]-=T[13],this[14]-=T[14],this[15]-=T[15],this}multiplyScalar(T){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this[4]*=T,this[5]*=T,this[6]*=T,this[7]*=T,this[8]*=T,this[9]*=T,this[10]*=T,this[11]*=T,this[12]*=T,this[13]*=T,this[14]*=T,this[15]*=T,this}multiplyScalarAndAdd(T,I){return this[0]+=T[0]*I,this[1]+=T[1]*I,this[2]+=T[2]*I,this[3]+=T[3]*I,this[4]+=T[4]*I,this[5]+=T[5]*I,this[6]+=T[6]*I,this[7]+=T[7]*I,this[8]+=T[8]*I,this[9]+=T[9]*I,this[10]+=T[10]*I,this[11]+=T[11]*I,this[12]+=T[12]*I,this[13]+=T[13]*I,this[14]+=T[14]*I,this[15]+=T[15]*I,this}exactEquals(T){return this[0]===T[0]&&this[1]===T[1]&&this[2]===T[2]&&this[3]===T[3]&&this[4]===T[4]&&this[5]===T[5]&&this[6]===T[6]&&this[7]===T[7]&&this[8]===T[8]&&this[9]===T[9]&&this[10]===T[10]&&this[11]===T[11]&&this[12]===T[12]&&this[13]===T[13]&&this[14]===T[14]&&this[15]===T[15]}equals(T){const[I,_,E,P,L,D,A,U,N,C,R,O,M,v,F,X]=this,[G,B,q,Z,Y,W,H,k,V,j,K,Q,J,$,ee,ae]=T;return _Mathabs(I-G)<=l*_Mathmax(1,_Mathabs(I),_Mathabs(G))&&_Mathabs(_-B)<=l*_Mathmax(1,_Mathabs(_),_Mathabs(B))&&_Mathabs(E-q)<=l*_Mathmax(1,_Mathabs(E),_Mathabs(q))&&_Mathabs(P-Z)<=l*_Mathmax(1,_Mathabs(P),_Mathabs(Z))&&_Mathabs(L-Y)<=l*_Mathmax(1,_Mathabs(L),_Mathabs(Y))&&_Mathabs(D-W)<=l*_Mathmax(1,_Mathabs(D),_Mathabs(W))&&_Mathabs(A-H)<=l*_Mathmax(1,_Mathabs(A),_Mathabs(H))&&_Mathabs(U-k)<=l*_Mathmax(1,_Mathabs(U),_Mathabs(k))&&_Mathabs(N-V)<=l*_Mathmax(1,_Mathabs(N),_Mathabs(V))&&_Mathabs(C-j)<=l*_Mathmax(1,_Mathabs(C),_Mathabs(j))&&_Mathabs(R-K)<=l*_Mathmax(1,_Mathabs(R),_Mathabs(K))&&_Mathabs(O-Q)<=l*_Mathmax(1,_Mathabs(O),_Mathabs(Q))&&_Mathabs(M-J)<=l*_Mathmax(1,_Mathabs(M),_Mathabs(J))&&_Mathabs(v-$)<=l*_Mathmax(1,_Mathabs(v),_Mathabs($))&&_Mathabs(F-ee)<=l*_Mathmax(1,_Mathabs(F),_Mathabs(ee))&&_Mathabs(X-ae)<=l*_Mathmax(1,_Mathabs(X),_Mathabs(ae))}transpose(T){if(T===this){const I=T[1],_=T[2],E=T[3],P=T[6],L=T[7],D=T[11];this[1]=T[4],this[2]=T[8],this[3]=T[12],this[4]=I,this[6]=T[9],this[7]=T[13],this[8]=_,this[9]=P,this[11]=T[14],this[12]=E,this[13]=L,this[14]=D}else u(this,T[0],T[4],T[8],T[12],T[1],T[5],T[9],T[13],T[2],T[6],T[10],T[14],T[3],T[7],T[11],T[15]);return this}invert(){const[T,I,_,E,P,L,D,A,U,N,C,R,O,M,v,F]=this,X=T*L-I*P,G=T*D-_*P,B=T*A-E*P,q=I*D-_*L,Z=I*A-E*L,Y=_*A-E*D,W=U*M-N*O,H=U*v-C*O,k=U*F-R*O,V=N*v-C*M,j=N*F-R*M,K=C*F-R*v;let Q=X*K-G*j+B*V+q*k-Z*H+Y*W;return Q?(Q=1/Q,u(this,(L*K-D*j+A*V)*Q,(_*j-I*K-E*V)*Q,(M*Y-v*Z+F*q)*Q,(C*Z-N*Y-R*q)*Q,(D*k-P*K-A*H)*Q,(T*K-_*k+E*H)*Q,(v*B-O*Y-F*G)*Q,(U*Y-C*B+R*G)*Q,(P*j-L*k+A*W)*Q,(I*k-T*j-E*W)*Q,(O*Z-M*B+F*X)*Q,(N*B-U*Z-R*X)*Q,(L*H-P*V-D*W)*Q,(T*V-I*H+_*W)*Q,(M*G-O*q-v*X)*Q,(U*q-N*G+C*X)*Q),this):this}adjoint(){const[T,I,_,E,P,L,D,A,U,N,C,R,O,M,v,F]=this;return u(this,L*(C*F-R*v)-N*(D*F-A*v)+M*(D*R-A*C),-(I*(C*F-R*v)-N*(_*F-E*v)+M*(_*R-E*C)),I*(D*F-A*v)-L*(_*F-E*v)+M*(_*A-E*D),-(I*(D*R-A*C)-L*(_*R-E*C)+N*(_*A-E*D)),-(P*(C*F-R*v)-U*(D*F-A*v)+O*(D*R-A*C)),T*(C*F-R*v)-U*(_*F-E*v)+O*(_*R-E*C),-(T*(D*F-A*v)-P*(_*F-E*v)+O*(_*A-E*D)),T*(D*R-A*C)-P*(_*R-E*C)+U*(_*A-E*D),P*(N*F-R*M)-U*(L*F-A*M)+O*(L*R-A*N),-(T*(N*F-R*M)-U*(I*F-E*M)+O*(I*R-E*N)),T*(L*F-A*M)-P*(I*F-E*M)+O*(I*A-E*L),-(T*(L*R-A*N)-P*(I*R-E*N)+U*(I*A-E*L)),-(P*(N*v-C*M)-U*(L*v-D*M)+O*(L*C-D*N)),T*(N*v-C*M)-U*(I*v-_*M)+O*(I*C-_*N),-(T*(L*v-D*M)-P*(I*v-_*M)+O*(I*D-_*L)),T*(L*C-D*N)-P*(I*C-_*N)+U*(I*D-_*L)),this}determinant(){const[T,I,_,E,P,L,D,A,U,N,C,R,O,M,v,F]=this;return(T*L-I*P)*(C*F-R*v)-(T*D-_*P)*(N*F-R*M)+(T*A-E*P)*(N*v-C*M)+(I*D-_*L)*(U*F-R*O)-(I*A-E*L)*(U*v-C*O)+(_*A-E*D)*(U*M-N*O)}multiply(T){const[I,_,E,P,L,D,A,U,N,C,R,O,M,v,F,X]=this;let[G,B,q,Z]=T;return this[0]=G*I+B*L+q*N+Z*M,this[1]=G*_+B*D+q*C+Z*v,this[2]=G*E+B*A+q*R+Z*F,this[3]=G*P+B*U+q*O+Z*X,G=T[4],B=T[5],q=T[6],Z=T[7],this[4]=G*I+B*L+q*N+Z*M,this[5]=G*_+B*D+q*C+Z*v,this[6]=G*E+B*A+q*R+Z*F,this[7]=G*P+B*U+q*O+Z*X,G=T[8],B=T[9],q=T[10],Z=T[11],this[8]=G*I+B*L+q*N+Z*M,this[9]=G*_+B*D+q*C+Z*v,this[10]=G*E+B*A+q*R+Z*F,this[11]=G*P+B*U+q*O+Z*X,G=T[12],B=T[13],q=T[14],Z=T[15],this[12]=G*I+B*L+q*N+Z*M,this[13]=G*_+B*D+q*C+Z*v,this[14]=G*E+B*A+q*R+Z*F,this[15]=G*P+B*U+q*O+Z*X,this}translate([T,I,_]){return this[12]=this[0]*T+this[4]*I+this[8]*_+this[12],this[13]=this[1]*T+this[5]*I+this[9]*_+this[13],this[14]=this[2]*T+this[6]*I+this[10]*_+this[14],this[15]=this[3]*T+this[7]*I+this[11]*_+this[15],this}scale([T,I,_]){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this[4]*=I,this[5]*=I,this[6]*=I,this[7]*=I,this[8]*=_,this[9]*=_,this[10]*=_,this[11]*=_,this}rotate(T,[I,_,E]){let P=_Mathsqrt(I*I+_*_+E*E);if(_Mathabs(P)>l){P=1/P,I*=P,_*=P,E*=P;const L=_Mathsin(T),D=_Mathcos(T),A=1-D,[U,N,C,R,O,M,v,F,X,G,B,q]=this,Z=I*I*A+D,Y=_*I*A+E*L,W=E*I*A-_*L,H=I*_*A-E*L,k=_*_*A+D,V=E*_*A+I*L,j=I*E*A+_*L,K=_*E*A-I*L,Q=E*E*A+D;this[0]=U*Z+O*Y+X*W,this[1]=N*Z+M*Y+G*W,this[2]=C*Z+v*Y+B*W,this[3]=R*Z+F*Y+q*W,this[4]=U*H+O*k+X*V,this[5]=N*H+M*k+G*V,this[6]=C*H+v*k+B*V,this[7]=R*H+F*k+q*V,this[8]=U*j+O*K+X*Q,this[9]=N*j+M*K+G*Q,this[10]=C*j+v*K+B*Q,this[11]=R*j+F*K+q*Q}return this}rotateX(T){const I=_Mathsin(T),_=_Mathcos(T),E=this[4],P=this[5],L=this[6],D=this[7],A=this[8],U=this[9],N=this[10],C=this[11];return this[4]=E*_+A*I,this[5]=P*_+U*I,this[6]=L*_+N*I,this[7]=D*_+C*I,this[8]=A*_-E*I,this[9]=U*_-P*I,this[10]=N*_-L*I,this[11]=C*_-D*I,this}rotateY(T){const I=_Mathsin(T),_=_Mathcos(T),[E,P,L,D]=this,A=this[8],U=this[9],N=this[10],C=this[11];return this[0]=E*_-A*I,this[1]=P*_-U*I,this[2]=L*_-N*I,this[3]=D*_-C*I,this[8]=E*I+A*_,this[9]=P*I+U*_,this[10]=L*I+N*_,this[11]=D*I+C*_,this}rotateZ(T){const I=_Mathsin(T),_=_Mathcos(T),[E,P,L,D,A,U,N,C]=this;return this[0]=E*_+A*I,this[1]=P*_+U*I,this[2]=L*_+N*I,this[3]=D*_+C*I,this[4]=A*_-E*I,this[5]=U*_-P*I,this[6]=N*_-L*I,this[7]=C*_-D*I,this}fromTranslation(T){return u(this,1,0,0,0,0,1,0,0,0,0,1,0,T[0],T[1],T[2],1),this}fromScaling(T){return u(this,T[0],0,0,0,0,T[1],0,0,0,0,T[2],0,0,0,0,1),this}fromRotation(T,[I,_,E]){let P=_Mathsqrt(I*I+_*_+E*E);if(_Mathabs(P)>l){P=1/P,I*=P,_*=P,E*=P;const L=_Mathsin(T),D=_Mathcos(T),A=1-D;u(this,I*I*A+D,_*I*A+E*L,E*I*A-_*L,0,I*_*A-E*L,_*_*A+D,E*_*A+I*L,0,I*E*A+_*L,_*E*A-I*L,E*E*A+D,0,0,0,0,1)}return this}fromXRotation(T){const I=_Mathsin(T),_=_Mathcos(T);return u(this,1,0,0,0,0,_,I,0,0,-I,_,0,0,0,0,1),this}fromYRotation(T){const I=_Mathsin(T),_=_Mathcos(T);return u(this,_,0,-I,0,0,1,0,0,I,0,_,0,0,0,0,1),this}fromZRotation(T){const I=_Mathsin(T),_=_Mathcos(T);return u(this,_,I,0,0,-I,_,0,0,0,0,1,0,0,0,0,1),this}fromQuat(T){const[I,_,E,P]=T,L=I+I,D=_+_,A=E+E,U=I*L,N=_*L,C=_*D,R=E*L,O=E*D,M=E*A,v=P*L,F=P*D,X=P*A;return u(this,1-C-M,N+X,R-F,0,N-X,1-U-M,O+v,0,R+F,O-v,1-U-C,0,0,0,0,1),this}fromRotationTranslation(T,I){const[_,E,P,L]=T,D=_+_,A=E+E,U=P+P,N=_*D,C=_*A,R=_*U,O=E*A,M=E*U,v=P*U,F=L*D,X=L*A,G=L*U;return u(this,1-(O+v),C+G,R-X,0,C-G,1-(N+v),M+F,0,R+X,M-F,1-(N+O),0,I[0],I[1],I[2],1),this}fromRotationTranslationScale(T,I,[_,E,P]){const[L,D,A,U]=T,N=L+L,C=D+D,R=A+A,O=L*N,M=L*C,v=L*R,F=D*C,X=D*R,G=A*R,B=U*N,q=U*C,Z=U*R;return u(this,(1-(F+G))*_,(M+Z)*_,(v-q)*_,0,(M-Z)*E,(1-(O+G))*E,(X+B)*E,0,(v+q)*P,(X-B)*P,(1-(O+F))*P,0,I[0],I[1],I[2],1),this}fromRotationTranslationScaleOrigin(T,I,_,E){const[P,L,D,A]=T,U=P+P,N=L+L,C=D+D,R=P*U,O=P*N,M=P*C,v=L*N,F=L*C,X=D*C,G=A*U,B=A*N,q=A*C,[Z,Y,W]=_,[H,k,V]=E;return u(this,(1-(v+X))*Z,(O+q)*Z,(M-B)*Z,0,(O-q)*Y,(1-(R+X))*Y,(F+G)*Y,0,(M+B)*W,(F-G)*W,(1-(R+v))*W,0,I[0]+H-(this[0]*H+this[4]*k+this[8]*V),I[1]+k-(this[1]*H+this[5]*k+this[9]*V),I[2]+V-(this[2]*H+this[6]*k+this[10]*V),1),this}getTranslation(T=new Float32Array(3)){return T[0]=this[12],T[1]=this[13],T[2]=this[14],T}getRotation(T=new Float32Array(4)){var I=this[0]+this[5]+this[10];if(0<I){const _=2*_Mathsqrt(I+1);T[0]=(this[6]-this[9])/_,T[1]=(this[8]-this[2])/_,T[2]=(this[1]-this[4])/_,T[3]=0.25*_}else if(this[0]>this[5]&this[0]>this[10]){const _=2*_Mathsqrt(1+this[0]-this[5]-this[10]);T[0]=0.25*_,T[1]=(this[1]+this[4])/_,T[2]=(this[8]+this[2])/_,T[3]=(this[6]-this[9])/_}else if(this[5]>this[10]){const _=_Mathsqrt(1+this[5]-this[0]-this[10]);T[0]=2*((this[1]+this[4])/_),T[1]=0.25*_,T[2]=(this[6]+this[9])/_,T[3]=(this[8]-this[2])/_}else{const _=2*_Mathsqrt(1+this[10]-this[0]-this[5]);T[0]=(this[8]+this[2])/_,T[1]=(this[6]+this[9])/_,T[2]=0.25*_,T[3]=(this[1]-this[4])/_}return T}frustrum(T,I,_,E,P,L){const D=1/(I-T),A=1/(E-_),U=1/(P-L);return u(this,2*P*D,0,0,0,0,2*P*A,0,0,(I+T)*D,(E+_)*A,(L+P)*U,-1,0,0,2*(L*P)*U,0),this}perspective(T,I,_,E){const P=1/_Mathtan(T/2),L=1/(_-E);return u(this,P/I,0,0,0,0,P,0,0,0,0,(E+_)*L,-1,0,0,2*E*_*L,0),this}perspectiveFromFieldOfView(T,I,_){const E=_Mathtan(T.upDegrees*_MathPI/180),P=_Mathtan(T.downDegrees*_MathPI/180),L=_Mathtan(T.leftDegrees*_MathPI/180),D=_Mathtan(T.rightDegrees*_MathPI/180),A=2/(L+D),U=2/(E+P);return u(this,A,0,0,0,0,U,0,0,0.5*(-(L-D)*A),0.5*((E-P)*U),_/(I-_),-1,0,0,_*I/(I-_),0),this}ortho(T,I,_,E,P,L){const D=1/(T-I),A=1/(_-E),U=1/(P-L);return u(this,-2*D,0,0,0,0,-2*A,0,0,0,0,2*U,0,(T+I)*D,(E+_)*A,(L+P)*U,1),this}lookAt(T,I,_){const[E,P,L]=T,[D,A,U]=_,[N,C,R]=I;if(_Mathabs(E-N)<l&&_Mathabs(P-C)<l&&_Mathabs(L-R)<l)return this.identity();let O=E-N,M=P-C,v=L-R,F=1/_Mathsqrt(O*O+M*M+v*v);O*=F,M*=F,v*=F;let X=A*v-U*M,G=U*O-D*v,B=D*M-A*O;F=_Mathsqrt(X*X+G*G+B*B),F?(F=1/F,X*=F,G*=F,B*=F):(X=0,G=0,B=0);let q=M*B-v*G,Z=v*X-O*B,Y=O*G-M*X;return F=_Mathsqrt(q*q+Z*Z+Y*Y),F?(F=1/F,q*=F,Z*=F,Y*=F):(q=0,Z=0,Y=0),u(this,X,q,O,0,G,Z,M,0,B,Y,v,0,-(X*E+G*P+B*L),-(q*E+Z*P+Y*L),-(O*E+M*P+v*L),1),this}frob(){return _Mathsqrt(_Mathpow(this[0],2)+_Mathpow(this[1],2)+_Mathpow(this[2],2)+_Mathpow(this[3],2)+_Mathpow(this[4],2)+_Mathpow(this[5],2)+_Mathpow(this[6],2)+_Mathpow(this[7],2)+_Mathpow(this[8],2)+_Mathpow(this[9],2)+_Mathpow(this[10],2)+_Mathpow(this[11],2)+_Mathpow(this[12],2)+_Mathpow(this[13],2)+_Mathpow(this[14],2)+_Mathpow(this[15],2))}}o.a=m},function(n,o,d){'use strict';var u=d(1);o.a=class{constructor(m,T){this.geom=m,this.program=T,this.uniforms=[],this.globalUniforms=[],this.textures=[],this.localCalls=[],this.globalCalls=[],this.order=1,this.visible=!0,this.depthTest=!1,this._isInitialized=!1}addUniform(m){this.uniforms.push(m)}rmUniform(m){const T=this.uniforms.indexOf(m);-1<T&&this.uniforms.splice(T,1)}addGlobalUniform(m){this.globalUniforms.push(m)}rmGlobalUniform(m){const T=this.globalUniforms.indexOf(m);-1<T&&this.globalUniforms.splice(T,1)}addTexture(m){this.textures.push(m)}rmTexture(m){const T=this.textures.indexOf(m);-1<T&&this.textures.splice(T,1)}isInitialized(){let m=this._isInitialized;if(m)return m;this.program.isInitialized()||(m=!1);for(const T of this.geom.attributes)T.isInitialized()||(m=!1);for(const T of this.geom.buffers)T.isInitialized()||(m=!1);for(const T of this.textures)T.isInitialized()||(m=!1);return m}_setCalls(m){const T=this.program;for(const I of this.geom.attributes){const _=T.getAttribLocation(m,I);this.localCalls.push(I.bind.bind(I,m,_))}for(const I of this.geom.buffers)this.localCalls.push(I.bind.bind(I,m));for(const I of this.uniforms){const _=T.getUniformLocation(m,I);this.localCalls.push(I.bind.bind(I,m,_))}for(const I of this.textures){const[_,E]=T.getTextureLocationIndex(m,I);this.localCalls.push(I.bind.bind(I,m,_,E))}for(const I of this.globalUniforms){const _=T.getUniformLocation(m,I);this.globalCalls.push(I.bind.bind(I,m,_))}}_initData(m){this.program;let I=!0;for(const _ of this.geom.attributes)_.isInitialized()||_.init(m)||(I=!1);for(const _ of this.geom.buffers)_.isInitialized()||_.init(m)||(I=!1);for(const _ of this.textures)_.isInitialized()||_.init(m)||(I=!1);return I}dispose(){this._isInitialized=!1,this.localCalls.length=0}init(m){this.program;let I=!0;return this.program.isInitialized()?this.program.bind(m):!this.program.init(m)&&(I=!1),this._initData(m)||(I=!1),I&&1>this.localCalls.length&&this._setCalls(m),this._callOptimizer=u.a.getInstance(m),this._isInitialized=I,I}draw(m,T=[]){this._callOptimizer.optimizeDepthTest(this.depthTest)||(this.depthTest?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST));const I=this.program;if(!this._callOptimizer.optimizeProgram(I)){this.program.bind(m);for(const _ of this.globalCalls)_()}for(const _ of this.localCalls)_();for(const _ of T)_();this.geom.display(m)}}},function(n,o,d){'use strict';var u=d(7),l=d(9);class m{constructor(){this.attributes=[],this.buffers=[],this.hasIndices=!1,this.numItems=0}addVertices(T,I,_){const E=new l.a(T);E.setArray(new Float32Array(I),34962),E.setItems(5126,_),this.attributes.push(E),1>this.numItems&&(this.numItems=I.length/_)}addIndices(T){this.hasIndices=!0;const I=new u.a;I.setArray(new Uint16Array(T),34963),I.setItems(5125,1),this.buffers.push(I),this.numItems=T.length}display(T){this.hasIndices?T.drawElements(T.TRIANGLES,this.numItems,T.UNSIGNED_SHORT,0):T.drawArrays(T.TRIANGLES,0,this.numItems)}clone(T=new m){return T.attributes=this.attributes.map((I)=>I.clone()),T.buffers=this.buffers.map((I)=>I.clone()),T.hasIndices=this.hasIndices,T.numItems=this.numItems,T}}o.a=m},function(n,o){'use strict';class u{constructor(){this.pointer=null,this.gl=null,this.arrayType=34962,this.data=null,this.arrayUsage=35044}isInitialized(){return!!this.pointer}setArray(l,m=this.arrayType,T=this.arrayUsage){this.arrayType=m,this.data=l,this.arrayUsage=T;const I=this.gl;I&&(I.bindBuffer(m,this.pointer),I.bufferData(m,l,arrayUsage))}setItems(l=5126,m=3,T=null){this.itemType=l,this.itemSize=m}init(l){const m=l.createBuffer();return l.bindBuffer(this.arrayType,m),l.bufferData(this.arrayType,this.data,this.arrayUsage),this.pointer=m,this.gl=l,!0}bind(l){l.bindBuffer(this.arrayType,this.pointer)}clone(l=new u){return l.setArray(this.data,this.arrayType,this.arrayUsage),l.setItems(this.itemType,this.itemSize),l}}o.a=u},function(n,o,d){'use strict';var u=d(1);class l{constructor(m,T={antialias:!0,stencil:!0}){this.canvas=m,this.init(m,T),this.meshs=[],this.depthTest=!0,this.sortCompare=(I,_)=>{if(I.order!==_.order)return I.order-_.order;return I.program&&_.program&&I.program!==_.program?I.program.id-_.program.id:I.textures&&_.textures&&0<I.textures.length&&0<I.textures.length?I.textures[0].id-_.textures[1].id:0},this.resize(m.width,m.height)}addMesh(m){this.meshs.push(m),m.isInitialized()||m.init(this.gl,this.uniforms)}rmMesh(m){const T=this.meshs.indexOf(m);-1<T&&this.meshs.splice(T,1)}sort(){this.meshs.sort(this.sortCompare)}resize(m,T){this.width=m,this.height=T}init(m,T){let I;try{I=m.getContext('webgl',T)||m.getContext('experimental-webgl',T)}catch(_){console.error('Could not initialise WebGL:',_.message)}I||console.error('Could not initialise WebGL'),this._callOptimizer=u.a.getInstance(I),this.gl=I}set bgColor([m,T,I,_=1]){this.gl.clearColor(m,T,I,_),this._bgColor=[m,T,I,_]}get bgColor(){return this._bgColor}draw(){const m=this.gl;this._callOptimizer.optimizeDepthTest(this.depthTest)||(this.depthTest?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST)),m.viewport(0,0,this.width,this.height),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT|m.STENCIL_BUFFER_BIT);for(const T of this.meshs)T.visible&&(T.isInitialized()?T.draw(m):T.init(m,this.uniforms))}}o.a=l},function(n,o,d){'use strict';var u=d(7);class l extends u.a{constructor(m){super(),this.label=m}bind(m,T){super.bind(m),m.vertexAttribPointer(T,this.itemSize,this.itemType,!1,0,0)}clone(m=new l(this.label)){return m.label=this.label,super.clone(m),m}}o.a=l},function(n,o,d){'use strict';var u=d(4),l=d(0);class m extends l.a{constructor(T){super(T,35676,new u.a),this.updateNum=0,this.updated=!0,this.local=new u.a,this.parent=null}get global(){return this.update(),this._data}update(){const T=this.parent,I=null!==this.parent;if(this.updated||I&&this._parentUpdateNum!==T.updateNum){const _=this._data;I?(T.global.copy(_),_.multiply(this.local),this._parentUpdateNum=T.updateNum):this.local.copy(_),this.updateNum++,this.updated=!0}}clear(){this.local.identity(),this.updateNum++,this.updated=!0}scale(T){this.local.scale(T),this.updateNum++,this.updated=!0}translate(T){this.local.translate(T),this.updateNum++,this.updated=!0}rotate(T,I){this.local.rotate(T,I),this.updateNum++,this.updated=!0}rotateX(T){this.local.rotateX(T),this.updateNum++,this.updated=!0}rotateY(T){this.local.rotateY(T),this.updateNum++,this.updated=!0}rotateZ(T){this.local.rotateZ(T),this.updateNum++,this.updated=!0}attach(T){this.parent=T,this._parentUpdateNum=T.updateNum,this.updateNum++,this.updated=!0}detach(){this.parent=null,this.updateNum++,this.updated=!0}}o.a=m},function(n,o,d){'use strict';var u=d(4),l=d(0);class m extends l.a{constructor(){super('uPMatrix',35676,new u.a),this.fovy=45,this.near=0.1,this.far=100;const T=new u.a;this._matrix=T,this.updated=!0,this.updateNum=0,this._ratio=0,this.clear=()=>{T.identity(),this.updated=!0},this.translate=(I)=>{T.translate(I),this.updated=!0},this.scale=(I)=>{T.scale(I),this.updated=!0},this.rotate=(I,_)=>{T.rotate(I,_),this.updated=!0},this.rotateX=(I)=>{T.rotateX(I),this.updated=!0},this.rotateY=(I)=>{T.rotateY(I),this.updated=!0},this.rotateZ=(I)=>{T.rotateZ(I),this.updated=!0},this.lookAt=(I,_,E)=>{T.lookAt(I,_,E),this.updated=!0}}get data(){return this.updated&&this.update(),this._data}get ratio(){return this._ratio}set ratio(T){this._ratio=T,this.updated=!0}resize(T,I){this._ratio=T/I,this.updated=!0}update(){this._data.perspective(this.fovy*_MathPI/180,this._ratio,this.near,this.far),this._data.multiply(this._matrix),this.updated=!1,this.updateNum++}}o.a=m},function(n,o,d){'use strict';var l=d(13);class m extends l.a{constructor(T){super(T),this.srcs=[],this.setTempColor([255,255,255,255])}setTempColor(T){this.setImg(new Uint8Array(T),1,1)}addURL(T,I=0){const _={size:I,src:T,img:null,priority:0,isImage:!0,isValid:()=>!0,init:null};_.init=(E)=>{E.bindTexture(E.TEXTURE_2D,this.pointer),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,!0),E.texImage2D(E.TEXTURE_2D,0,6408,this.format,E.UNSIGNED_BYTE,_.img),this.img=_.img,this.initParams(E)},this.srcs.push(_)}static START_LOAD(T,I){if(0<I.length){I.sort((E,P)=>E.size===P.size?E.size-P.size:E.priority-P.priority);I.filter((E)=>E.size>=l.a.MAX_SIZE&&E.isValid(T));if(1<I.length){const E=I[0],P=I[I.length-1];m.LOAD(E,()=>{E.init(T),m.LOAD(P,()=>{P.init(T)})})}else if(0<I.length){const E=I[0];m.LOAD(E,()=>{E.init(T)})}else console.warn('The GPU can\'nt load a texture with size > ',l.a.MAX_SIZE)}else console.warn('URL of your smart texture not found')}static LOAD(T,I){if(T.isImage){const _=new Image;_.onload=()=>{I(T)},T.img=_,_.src=T.src}else{const _=new XMLHttpRequest;_.responseType='arraybuffer',_.open('GET',T.src,!0),_.onreadystatechange=()=>{_.readyState===XMLHttpRequest.DONE&&(200===_.status?(T.img=_.response,I(T)):console.error('fail to load image ',T.src,'status:',_.status,'statuc text:',_.statusText))},_.send()}}init(T,I){const _=super.init(T,I),E=this.pointer;return m.START_LOAD(T,this.srcs),_}}o.a=m},function(n,o,d){'use strict';var u=d(1);let l=0;class m{constructor(T){this.id=l++,this.label=T,this.mipmap=!0,this.img=null,this.width=null,this.height=null,this.pointer=null,this.parameters=[],this.setType(),this.setInternalFormat(),this.setFormat(),this.setTarget()}resize(T,I,_=null){this.width=T,this.height=I,_?(_.bindTexture(this.target,this.pointer),_.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img)):this.updated=!0}setTempColor(T){this.setImg(new Uint8Array(T),1,1)}setImg(T=new Uint8Array([255,255,255,255]),I=1,_=1){this.img=T,this.width=I,this.height=_}setType(T=5121){this.type=T}setInternalFormat(T=6408){this.internalFormat=T}setFormat(T=6408){this.format=T}setTarget(T=3553){this.target=T}setParam(T,I){const _=this.parameters.find((E)=>E[0]===T);-1<_?this.parameters[_][1]=I:this.parameters.push([T,I])}isInitialized(){return!!this.pointer}static IS_POWER_OF_2(T){return 0==(T&T-1)}static SET_DATA(T){m.MAX_SIZE=T.getParameter(T.MAX_TEXTURE_SIZE),m.FORMAT={};const I=T.getParameter(T.COMPRESSED_TEXTURE_FORMATS);for(let _=0;_<I.length;_++)m.FORMAT[I[_]]=!0;m._DATA_INITIALIZED=!0}setDefaultParams(T){this.mipmap?this.setParam(T.TEXTURE_MIN_FILTER,T.LINEAR_MIPMAP_LINEAR):(this.setParam(T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),this.setParam(T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),this.setParam(T.TEXTURE_MIN_FILTER,T.LINEAR))}initParams(T){if(this.mipmap){const I=this.img;null===I?console.warn('You need an image to set the parameters of texture'):m.IS_POWER_OF_2(I.width)&&m.IS_POWER_OF_2(I.height)?T.generateMipmap(this.target):(this.mipmap=!1,console.warn('You need a power of 2 for the size of the mipmaped texture'))}1>this.parameters.length&&this.setDefaultParams(T);for(const[I,_]of this.parameters)T.texParameteri(this.target,I,_)}init(T){const I=T.createTexture();return m._DATA_INITIALIZED||m.SET_DATA(T),T.bindTexture(this.target,I),T.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.initParams(T),this._callOptimizer=u.a.getInstance(T),this.pointer=I,!0}bind(T,I,_){this._callOptimizer.optimizeTexture(this)||(T.uniform1i(I,_),T.activeTexture(T.TEXTURE0+_),T.bindTexture(this.target,this.pointer),this.updated&&(T.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.updated=!1))}free(T){T.bindTexture(T.TEXTURE_2D,null)}}o.a=m},,,,,,,,,,,,,function(n,o,d){'use strict';function l(A,U,N){const C=[],R=[];let O;for(const M of A.camera){const v=N.initCamera3D(M);v.name=M.name,v.fovy=M.fovy,v.near=M.near,v.far=M.far;const F=M.transform;v.lookAt(F.pos,F.lookAt,F.up),C.push(v),O||(O=v)}for(const M of A.mesh){const v=N.initdMesh(M);if(v.name=M.name,O&&v.addGlobalUniform(O),M.transform){const F=M.transform;v.translate(F.pos);const X=F.rot;v.rotateZ(X[2]*_MathPI/180),v.rotateY(X[1]*_MathPI/180),v.rotateX(X[0]*_MathPI/180)}if(M.geom){const F=M.geom,X=v.geom;F.vertices&&X.addVertices('aVertexPosition',F.vertices,3),F.uv&&X.addVertices('aTextureCoord',F.uv,2),F.indices&&X.addIndices(F.indices)}R.push(v)}U({camera:C,mesh:R})}function m(A,U,N){const C=new XMLHttpRequest;C.open('GET',A,!0),C.overrideMimeType('application/json'),C.onreadystatechange=()=>{if(4===C.readyState)if(200===C.status){let R;try{R=JSON.parse(C.responseText)}catch(O){return N.onError(O.message)}l(R,U,N)}else N.onError(C)},C.send(null)}var T=d(3),I=d(11),_=d(2),E=d(6);const P=`attribute vec3 aVertexPosition;
uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;
void main(void){
gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition,1.0);
}`,L=`precision mediump float;
void main(void){
gl_FragColor = vec4(1.0,1.0,1.0,1.0);
}`;o.a=function(A,U,{onError:N=(O)=>{throw new Error('Mesh load error '+O)},initCamera3D:C=()=>new I.a,initdMesh:R=()=>new T.a(new E.a(),new _.a(P,L))}){m(A,U,{onError:N,initCamera3D:C,initdMesh:R})}},,function(n,o,d){'use strict';function l(){const F=[window.innerWidth,window.innerHeight];A.resize(F[0],F[1]),D.width=F[0],D.height=F[1],U.resize(...F)}function m(){if(U){U.clear();const F=15*_Mathcos(1e-3*Date.now()),X=15*_Mathsin(1e-3*Date.now());U.lookAt([F,10,X],[0,0,0],[0,1,0])}A.draw(),requestAnimationFrame(m)}Object.defineProperty(o,'__esModule',{value:!0});var T=d(2),I=d(6),_=d(12),E=d(3),P=d(8),L=d(26);const D=document.body.querySelector('canvas'),A=new P.a(D);A.bgColor=[1,1,1,1],A.depthTest=!0;let U;const N=`      
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec4 vColor;
    varying vec2 vTextureCoord;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vColor = vec4(normalize(aVertexPosition), 1.0);
        vTextureCoord = aTextureCoord;
    }
`,C=`      
    attribute vec3 aVertexPosition;
    attribute vec2 aTextureCoord;

    uniform mat4 uPMatrix;

    varying vec4 vColor;
    varying vec2 vTextureCoord;

    void main(void) {
        gl_Position = uPMatrix * vec4(aVertexPosition, 1.0);
        vColor = vec4(normalize(aVertexPosition), 1.0);
        vTextureCoord = aTextureCoord;
    }
`,R=`
    precision mediump float;

    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uDiffuse;

    void main(void) {
        vec4 color = texture2D(uDiffuse, vec2(vTextureCoord.s, vTextureCoord.t));
        gl_FragColor = color;
    }
`,O=new _.a('uDiffuse');O.addURL('assets/suzanne-plane-diffuse.jpg');const M=new _.a('uDiffuse');M.addURL('assets/suzanne-diffuse.jpg');const v=new _.a('uDiffuse');v.addURL('assets/suzanne-cube-diffuse.jpg'),d.i(L.a)('assets/suzanne.min.json',({camera:F,mesh:X})=>{U=F[0];for(const G of X)A.addMesh(G);l()},{initdMesh:function(F){let X;switch(F.name){case'Suzanne':X=new E.a(new I.a(),new T.a(C,R)),X.addTexture(M);break;case'Cube':X=new E.a(new I.a(),new T.a(N,R)),X.addTexture(v);break;case'Plane':X=new E.a(new I.a(),new T.a(N,R)),X.addTexture(O);break;default:throw new Error('Mesh unexpected '+F.name);}return X}}),window.onresize=l,m()}]);