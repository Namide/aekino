!function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=12)}([function(t,e,r){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=function(){function t(e,r,i){n(this,t),this.label=e,this.type=r,this.data=i}return a(t,[{key:"draw",value:function(t,e){switch(this.type){case 35676:t.uniformMatrix4fv(e,!1,this.data);break;case 35665:t.uniform3f.apply(t,[e].concat(i(this.data)));break;default:console.error("Uniform type unknow: {label:",this.label,", type:",this.type,"}")}}}]),t}();e.default=o},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},u=r(2),h=function(t){return t&&t.__esModule?t:{default:t}}(u),l=function(t){function e(t){i(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.label=t,r}return a(e,t),o(e,[{key:"draw",value:function(t,r){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t),t.vertexAttribPointer(r,this.itemSize,this.itemType,!1,0,0)}}]),e}(h.default);e.default=l},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(){i(this,t),this.buffer=null}return n(t,[{key:"isInitialized",value:function(){return!!this.buffer}},{key:"setArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:34962,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:35044;this.arrayType=e,this.data=t,this.arrayUsage=r}},{key:"setItems",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5126,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.itemType=t,this.itemSize=e}},{key:"init",value:function(t){var e=t.createBuffer();return t.bindBuffer(this.arrayType,e),t.bufferData(this.arrayType,this.data,this.arrayUsage),this.buffer=e,!0}},{key:"draw",value:function(t){t.bindBuffer(this.arrayType,this.buffer)}}]),t}();e.default=a},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(){i(this,t),this.lastTexture=null,this.lastProgram=null}return n(t,[{key:"optimizeTexture",value:function(t){var e=this.lastTexture;return this.lastTexture=t,t===e}},{key:"optimizeProgram",value:function(t){var e=this.lastProgram;return this.lastProgram=t,t===e}}],[{key:"getInstance",value:function(e){var r=t.glList.indexOf(e);if(r<0){var i=new t;return t.glList.push(e),t.list.push(i),i}return t.list[r]}}]),t}();a.glList=[],a.list=[],e.default=a},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e,r,i,n,a,o,s,u,h,l,f,c,v,d,y,p){t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=h,t[9]=l,t[10]=f,t[11]=c,t[12]=v,t[13]=d,t[14]=y,t[15]=p}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),l=function(t){function e(){i(this,e);var t=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,16));return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}return o(e,t),h(e,[{key:"clone",value:function(){var t=new e;return t.set(this),t}},{key:"copy",value:function(t){return t.set(this),this}},{key:"identity",value:function(){return s(this,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"add",value:function(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this[3]+=t[3],this[4]+=t[4],this[5]+=t[5],this[6]+=t[6],this[7]+=t[7],this[8]+=t[8],this[9]+=t[9],this[10]+=t[10],this[11]+=t[11],this[12]+=t[12],this[13]+=t[13],this[14]+=t[14],this[15]+=t[15],this}},{key:"subtract",value:function(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this[3]-=t[3],this[4]-=t[4],this[5]-=t[5],this[6]-=t[6],this[7]-=t[7],this[8]-=t[8],this[9]-=t[9],this[10]-=t[10],this[11]-=t[11],this[12]-=t[12],this[13]-=t[13],this[14]-=t[14],this[15]-=t[15],this}},{key:"multiplyScalar",value:function(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this[4]*=t,this[5]*=t,this[6]*=t,this[7]*=t,this[8]*=t,this[9]*=t,this[10]*=t,this[11]*=t,this[12]*=t,this[13]*=t,this[14]*=t,this[15]*=t,this}},{key:"multiplyScalarAndAdd",value:function(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this[2]+=t[2]*e,this[3]+=t[3]*e,this[4]+=t[4]*e,this[5]+=t[5]*e,this[6]+=t[6]*e,this[7]+=t[7]*e,this[8]+=t[8]*e,this[9]+=t[9]*e,this[10]+=t[10]*e,this[11]+=t[11]*e,this[12]+=t[12]*e,this[13]+=t[13]*e,this[14]+=t[14]*e,this[15]+=t[15]*e,this}},{key:"exactEquals",value:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]&&this[4]===t[4]&&this[5]===t[5]&&this[6]===t[6]&&this[7]===t[7]&&this[8]===t[8]&&this[9]===t[9]&&this[10]===t[10]&&this[11]===t[11]&&this[12]===t[12]&&this[13]===t[13]&&this[14]===t[14]&&this[15]===t[15]}},{key:"equals",value:function(t){var e=u(this,16),r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],h=e[6],l=e[7],f=e[8],c=e[9],v=e[10],d=e[11],y=e[12],p=e[13],m=e[14],b=e[15],g=u(t,16),M=g[0],_=g[1],w=g[2],x=g[3],T=g[4],P=g[5],E=g[6],k=g[7],O=g[8],I=g[9],S=g[10],A=g[11],C=g[12],R=g[13],L=g[14],j=g[15];return Math.abs(r-M)<=1e-6*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(i-_)<=1e-6*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(n-w)<=1e-6*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(a-x)<=1e-6*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-T)<=1e-6*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(s-P)<=1e-6*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(h-E)<=1e-6*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(l-k)<=1e-6*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(f-O)<=1e-6*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(c-I)<=1e-6*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(v-S)<=1e-6*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(d-A)<=1e-6*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(y-C)<=1e-6*Math.max(1,Math.abs(y),Math.abs(C))&&Math.abs(p-R)<=1e-6*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-L)<=1e-6*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(b-j)<=1e-6*Math.max(1,Math.abs(b),Math.abs(j))}},{key:"transpose",value:function(t){if(t===this){var e=t[1],r=t[2],i=t[3],n=t[6],a=t[7],o=t[11];this[1]=t[4],this[2]=t[8],this[3]=t[12],this[4]=e,this[6]=t[9],this[7]=t[13],this[8]=r,this[9]=n,this[11]=t[14],this[12]=i,this[13]=a,this[14]=o}else s(this,t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]);return this}},{key:"invert",value:function(){var t=u(this,16),e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],f=t[8],c=t[9],v=t[10],d=t[11],y=t[12],p=t[13],m=t[14],b=t[15],g=e*o-r*a,M=e*h-i*a,_=e*l-n*a,w=r*h-i*o,x=r*l-n*o,T=i*l-n*h,P=f*p-c*y,E=f*m-v*y,k=f*b-d*y,O=c*m-v*p,I=c*b-d*p,S=v*b-d*m,A=g*S-M*I+_*O+w*k-x*E+T*P;return A?(A=1/A,s(this,(o*S-h*I+l*O)*A,(i*I-r*S-n*O)*A,(p*T-m*x+b*w)*A,(v*x-c*T-d*w)*A,(h*k-a*S-l*E)*A,(e*S-i*k+n*E)*A,(m*_-y*T-b*M)*A,(f*T-v*_+d*M)*A,(a*I-o*k+l*P)*A,(r*k-e*I-n*P)*A,(y*x-p*_+b*g)*A,(c*_-f*x-d*g)*A,(o*E-a*O-h*P)*A,(e*O-r*E+i*P)*A,(p*M-y*w-m*g)*A,(f*w-c*M+v*g)*A),this):this}},{key:"adjoint",value:function(){var t=u(this,16),e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],f=t[8],c=t[9],v=t[10],d=t[11],y=t[12],p=t[13],m=t[14],b=t[15];return s(this,o*(v*b-d*m)-c*(h*b-l*m)+p*(h*d-l*v),-(r*(v*b-d*m)-c*(i*b-n*m)+p*(i*d-n*v)),r*(h*b-l*m)-o*(i*b-n*m)+p*(i*l-n*h),-(r*(h*d-l*v)-o*(i*d-n*v)+c*(i*l-n*h)),-(a*(v*b-d*m)-f*(h*b-l*m)+y*(h*d-l*v)),e*(v*b-d*m)-f*(i*b-n*m)+y*(i*d-n*v),-(e*(h*b-l*m)-a*(i*b-n*m)+y*(i*l-n*h)),e*(h*d-l*v)-a*(i*d-n*v)+f*(i*l-n*h),a*(c*b-d*p)-f*(o*b-l*p)+y*(o*d-l*c),-(e*(c*b-d*p)-f*(r*b-n*p)+y*(r*d-n*c)),e*(o*b-l*p)-a*(r*b-n*p)+y*(r*l-n*o),-(e*(o*d-l*c)-a*(r*d-n*c)+f*(r*l-n*o)),-(a*(c*m-v*p)-f*(o*m-h*p)+y*(o*v-h*c)),e*(c*m-v*p)-f*(r*m-i*p)+y*(r*v-i*c),-(e*(o*m-h*p)-a*(r*m-i*p)+y*(r*h-i*o)),e*(o*v-h*c)-a*(r*v-i*c)+f*(r*h-i*o)),this}},{key:"determinant",value:function(){var t=u(this,16),e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],s=t[6],h=t[7],l=t[8],f=t[9],c=t[10],v=t[11],d=t[12],y=t[13],p=t[14],m=t[15];return(e*o-r*a)*(c*m-v*p)-(e*s-i*a)*(f*m-v*y)+(e*h-n*a)*(f*p-c*y)+(r*s-i*o)*(l*m-v*d)-(r*h-n*o)*(l*p-c*d)+(i*h-n*s)*(l*y-f*d)}},{key:"multiply",value:function(t){var e=u(this,16),r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],h=e[6],l=e[7],f=e[8],c=e[9],v=e[10],d=e[11],y=e[12],p=e[13],m=e[14],b=e[15],g=u(t,4),M=g[0],_=g[1],w=g[2],x=g[3];return this[0]=M*r+_*o+w*f+x*y,this[1]=M*i+_*s+w*c+x*p,this[2]=M*n+_*h+w*v+x*m,this[3]=M*a+_*l+w*d+x*b,M=t[4],_=t[5],w=t[6],x=t[7],this[4]=M*r+_*o+w*f+x*y,this[5]=M*i+_*s+w*c+x*p,this[6]=M*n+_*h+w*v+x*m,this[7]=M*a+_*l+w*d+x*b,M=t[8],_=t[9],w=t[10],x=t[11],this[8]=M*r+_*o+w*f+x*y,this[9]=M*i+_*s+w*c+x*p,this[10]=M*n+_*h+w*v+x*m,this[11]=M*a+_*l+w*d+x*b,M=t[12],_=t[13],w=t[14],x=t[15],this[12]=M*r+_*o+w*f+x*y,this[13]=M*i+_*s+w*c+x*p,this[14]=M*n+_*h+w*v+x*m,this[15]=M*a+_*l+w*d+x*b,this}},{key:"translate",value:function(t){var e=u(t,3),r=e[0],i=e[1],n=e[2];return this[12]=this[0]*r+this[4]*i+this[8]*n+this[12],this[13]=this[1]*r+this[5]*i+this[9]*n+this[13],this[14]=this[2]*r+this[6]*i+this[10]*n+this[14],this[15]=this[3]*r+this[7]*i+this[11]*n+this[15],this}},{key:"scale",value:function(t){var e=u(t,3),r=e[0],i=e[1],n=e[2];return this[0]*=r,this[1]*=r,this[2]*=r,this[3]*=r,this[4]*=i,this[5]*=i,this[6]*=i,this[7]*=i,this[8]*=n,this[9]*=n,this[10]*=n,this[11]*=n,this}},{key:"rotate",value:function(t,e){var r=u(e,3),i=r[0],n=r[1],a=r[2],o=Math.sqrt(i*i+n*n+a*a);if(Math.abs(o)>1e-6){o=1/o,i*=o,n*=o,a*=o;var s=Math.sin(t),h=Math.cos(t),l=1-h,f=u(this,12),c=f[0],v=f[1],d=f[2],y=f[3],p=f[4],m=f[5],b=f[6],g=f[7],M=f[8],_=f[9],w=f[10],x=f[11],T=i*i*l+h,P=n*i*l+a*s,E=a*i*l-n*s,k=i*n*l-a*s,O=n*n*l+h,I=a*n*l+i*s,S=i*a*l+n*s,A=n*a*l-i*s,C=a*a*l+h;this[0]=c*T+p*P+M*E,this[1]=v*T+m*P+_*E,this[2]=d*T+b*P+w*E,this[3]=y*T+g*P+x*E,this[4]=c*k+p*O+M*I,this[5]=v*k+m*O+_*I,this[6]=d*k+b*O+w*I,this[7]=y*k+g*O+x*I,this[8]=c*S+p*A+M*C,this[9]=v*S+m*A+_*C,this[10]=d*S+b*A+w*C,this[11]=y*S+g*A+x*C}return this}},{key:"rotateX",value:function(t){var e=Math.sin(t),r=Math.cos(t),i=this[4],n=this[5],a=this[6],o=this[7],s=this[8],u=this[9],h=this[10],l=this[11];return this[4]=i*r+s*e,this[5]=n*r+u*e,this[6]=a*r+h*e,this[7]=o*r+l*e,this[8]=s*r-i*e,this[9]=u*r-n*e,this[10]=h*r-a*e,this[11]=l*r-o*e,this}},{key:"rotateY",value:function(t){var e=Math.sin(t),r=Math.cos(t),i=a[0],n=a[1],o=a[2],s=a[3],u=a[8],h=a[9],l=a[10],f=a[11];return this[0]=i*r-u*e,this[1]=n*r-h*e,this[2]=o*r-l*e,this[3]=s*r-f*e,this[8]=i*e+u*r,this[9]=n*e+h*r,this[10]=o*e+l*r,this[11]=s*e+f*r,this}},{key:"rotateZ",value:function(t){var e=Math.sin(t),r=Math.cos(t),i=u(this,8),n=i[0],a=i[1],o=(i[2],i[3]),s=i[4],h=i[5],l=i[6],f=i[7];return this[0]=n*r+s*e,this[1]=a*r+h*e,this[2]=a02*r+l*e,this[3]=o*r+f*e,this[4]=s*r-n*e,this[5]=h*r-a*e,this[6]=l*r-a02*e,this[7]=f*r-o*e,this}},{key:"fromTranslation",value:function(t){return s(this,1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1),this}},{key:"fromScaling",value:function(t){return s(this,t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,1),this}},{key:"fromRotation",value:function(t,e){var r=u(e,3),i=r[0],n=r[1],a=r[2],o=Math.sqrt(i*i+n*n+a*a);if(Math.abs(o)>1e-6){o=1/o,i*=o,n*=o,a*=o;var h=Math.sin(t),l=Math.cos(t),f=1-l;s(this,i*i*f+l,n*i*f+a*h,a*i*f-n*h,0,i*n*f-a*h,n*n*f+l,a*n*f+i*h,0,i*a*f+n*h,n*a*f-i*h,a*a*f+l,0,0,0,0,1)}return this}},{key:"fromXRotation",value:function(t){var e=Math.sin(t),r=Math.cos(t);return s(this,1,0,0,0,0,r,e,0,0,-e,r,0,0,0,0,1),this}},{key:"fromYRotation",value:function(t){var e=Math.sin(t),r=Math.cos(t);return s(this,r,0,-e,0,0,1,0,0,e,0,r,0,0,0,0,1),this}},{key:"fromZRotation",value:function(t){var e=Math.sin(t),r=Math.cos(t);return s(this,r,e,0,0,-e,r,0,0,0,0,1,0,0,0,0,1),this}},{key:"fromQuat",value:function(t){var e=u(t,4),r=e[0],i=e[1],n=e[2],a=e[3],o=r+r,h=i+i,l=n+n,f=r*o,c=i*o,v=i*h,d=n*o,y=n*h,p=n*l,m=a*o,b=a*h,g=a*l;return s(this,1-v-p,c+g,d-b,0,c-g,1-f-p,y+m,0,d+b,y-m,1-f-v,0,0,0,0,1),this}},{key:"fromRotationTranslation",value:function(t,e){var r=u(t,4),i=r[0],n=r[1],a=r[2],o=r[3],h=i+i,l=n+n,f=a+a,c=i*h,v=i*l,d=i*f,y=n*l,p=n*f,m=a*f,b=o*h,g=o*l,M=o*f;return s(this,1-(y+m),v+M,d-g,0,v-M,1-(c+m),p+b,0,d+g,p-b,1-(c+y),0,e[0],e[1],e[2],1),this}},{key:"fromRotationTranslationScale",value:function(t,e,r){var i=u(r,3),n=i[0],a=i[1],o=i[2],h=u(t,4),l=h[0],f=h[1],c=h[2],v=h[3],d=l+l,y=f+f,p=c+c,m=l*d,b=l*y,g=l*p,M=f*y,_=f*p,w=c*p,x=v*d,T=v*y,P=v*p;return s(this,(1-(M+w))*n,(b+P)*n,(g-T)*n,0,(b-P)*a,(1-(m+w))*a,(_+x)*a,0,(g+T)*o,(_-x)*o,(1-(m+M))*o,0,e[0],e[1],e[2],1),this}},{key:"fromRotationTranslationScaleOrigin",value:function(t,e,r,i){var n=u(t,4),a=n[0],o=n[1],h=n[2],l=n[3],f=a+a,c=o+o,v=h+h,d=a*f,y=a*c,p=a*v,m=o*c,b=o*v,g=h*v,M=l*f,_=l*c,w=l*v,x=u(r,3),T=x[0],P=x[1],E=x[2],k=u(i,3),O=k[0],I=k[1],S=k[2];return s(this,(1-(m+g))*T,(y+w)*T,(p-_)*T,0,(y-w)*P,(1-(d+g))*P,(b+M)*P,0,(p+_)*E,(b-M)*E,(1-(d+m))*E,0,e[0]+O-(this[0]*O+this[4]*I+this[8]*S),e[1]+I-(this[1]*O+this[5]*I+this[9]*S),e[2]+S-(this[2]*O+this[6]*I+this[10]*S),1),this}},{key:"getTranslation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Float32Array(3);return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Float32Array(4),e=this[0]+this[5]+this[10];if(e>0){var r=2*Math.sqrt(e+1);t[0]=(this[6]-this[9])/r,t[1]=(this[8]-this[2])/r,t[2]=(this[1]-this[4])/r,t[3]=.25*r}else if(this[0]>this[5]&this[0]>this[10]){var i=2*Math.sqrt(1+this[0]-this[5]-this[10]);t[0]=.25*i,t[1]=(this[1]+this[4])/i,t[2]=(this[8]+this[2])/i,t[3]=(this[6]-this[9])/i}else if(this[5]>this[10]){var n=Math.sqrt(1+this[5]-this[0]-this[10]);t[0]=(this[1]+this[4])/n*2,t[1]=.25*n,t[2]=(this[6]+this[9])/n,t[3]=(this[8]-this[2])/n}else{var a=2*Math.sqrt(1+this[10]-this[0]-this[5]);t[0]=(this[8]+this[2])/a,t[1]=(this[6]+this[9])/a,t[2]=.25*a,t[3]=(this[1]-this[4])/a}return t}},{key:"frustrum",value:function(t,e,r,i,n,a){var o=1/(e-t),u=1/(i-r),h=1/(n-a);return s(this,2*n*o,0,0,0,0,2*n*u,0,0,(e+t)*o,(i+r)*u,(a+n)*h,-1,0,0,a*n*2*h,0),this}},{key:"perspective",value:function(t,e,r,i){var n=1/Math.tan(t/2),a=1/(r-i);return s(this,n/e,0,0,0,0,n,0,0,0,0,(i+r)*a,-1,0,0,2*i*r*a,0),this}},{key:"perspectiveFromFieldOfView",value:function(t,e,r){var i=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+o),h=2/(i+n);return s(this,u,0,0,0,0,h,0,0,-(a-o)*u*.5,(i-n)*h*.5,r/(e-r),-1,0,0,r*e/(e-r),0),this}},{key:"ortho",value:function(t,e,r,i,n,a){var o=1/(t-e),u=1/(r-i),h=1/(n-a);return s(this,-2*o,0,0,0,0,-2*u,0,0,0,0,2*h,0,(t+e)*o,(i+r)*u,(a+n)*h,1),this}},{key:"lookAt",value:function(t,e,r){var i=u(t,3),n=i[0],a=i[1],o=i[2],h=u(r,3),l=h[0],f=h[1],c=h[2],v=u(e,3),d=v[0],y=v[1],p=v[2];if(Math.abs(n-d)<1e-6&&Math.abs(a-y)<1e-6&&Math.abs(o-p)<1e-6)return this.identity();var m=n-d,b=a-y,g=o-p,M=1/Math.sqrt(m*m+b*b+g*g);m*=M,b*=M,g*=M;var _=f*g-c*b,w=c*m-l*g,x=l*b-f*m;M=Math.sqrt(_*_+w*w+x*x),M?(M=1/M,_*=M,w*=M,x*=M):(_=0,w=0,x=0);var T=b*x-g*w,P=g*_-m*x,E=m*w-b*_;return M=Math.sqrt(T*T+P*P+E*E),M?(M=1/M,T*=M,P*=M,E*=M):(T=0,P=0,E=0),s(this,_,T,m,0,w,P,b,0,x,E,g,0,-(_*n+w*a+x*o),-(T*n+P*a+E*o),-(m*n+b*a+g*o),1),this}},{key:"frob",value:function(){return Math.sqrt(Math.pow(this[0],2)+Math.pow(this[1],2)+Math.pow(this[2],2)+Math.pow(this[3],2)+Math.pow(this[4],2)+Math.pow(this[5],2)+Math.pow(this[6],2)+Math.pow(this[7],2)+Math.pow(this[8],2)+Math.pow(this[9],2)+Math.pow(this[10],2)+Math.pow(this[11],2)+Math.pow(this[12],2)+Math.pow(this[13],2)+Math.pow(this[14],2)+Math.pow(this[15],2))}}]),e}(Float32Array);e.default=l},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=r(2),s=i(o),u=r(1),h=i(u),l=function(){function t(){n(this,t),this.attributes=[],this.buffers=[],this.hasIndices=!1,this.numItems=0}return a(t,[{key:"addVertices",value:function(t,e,r){var i=new h.default(t);i.setArray(new Float32Array(e),34962),i.setItems(5126,r),this.attributes.push(i),this.numItems<1&&(this.numItems=e.length/r)}},{key:"addIndices",value:function(t){this.hasIndices=!0;var e=new s.default;e.setArray(new Uint16Array(t),34963),e.setItems(5125,1),this.buffers.push(e),this.numItems=t.length}},{key:"display",value:function(t){this.hasIndices?t.drawElements(t.TRIANGLES,this.numItems,t.UNSIGNED_SHORT,0):t.drawArrays(t.TRIANGLES,0,this.numItems)}}]),t}();e.default=l},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a="      \n    attribute vec3 aVertexPosition;\n    attribute vec4 aVertexColor;\n\n    uniform mat4 uMVMatrix;\n    uniform mat4 uPMatrix;\n\n    varying vec4 vColor;\n\n    void main(void) {\n        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n        vColor = aVertexColor;\n    }\n",o="\n    precision mediump float;\n\n    varying vec4 vColor;\n\n    void main(void) {\n        gl_FragColor = vColor;\n    }\n",s=0,u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;i(this,t),this.vertexShaderSrc=e,this.fragmentShaderSrc=r,this.attribLocation={},this.uniformLocation={},this.textureLocation={},this.textureIndex={},this.textureNum=0,this.id=++s}return n(t,[{key:"isInitialized",value:function(){return!!this.pointer}},{key:"init",value:function(t){this.vertexShader=this._createShader(t,35633,this.vertexShaderSrc),this.fragmentShader=this._createShader(t,35632,this.fragmentShaderSrc);var e=t.createProgram();return t.attachShader(e,this.vertexShader),t.attachShader(e,this.fragmentShader),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)?(t.useProgram(e),this.pointer=e,!0):(console.error("Shader initialization error"),!1)}},{key:"getAttribLocation",value:function(t,e){var r=e.label;if(!this.attribLocation.hasOwnProperty(r)){var i=t.getAttribLocation(this.pointer,r);return t.enableVertexAttribArray(i),this.attribLocation[r]=i,i}return this.attribLocation[r]}},{key:"getUniformLocation",value:function(t,e){var r=e.label;if(!this.uniformLocation.hasOwnProperty(r)){var i=t.getUniformLocation(this.pointer,r);return this.uniformLocation[r]=i,i}return this.uniformLocation[r]}},{key:"getTextureLocationIndex",value:function(t,e){var r=e.label;if(!this.textureLocation.hasOwnProperty(r)||!this.textureIndex.hasOwnProperty(r)){var i=t.getUniformLocation(this.pointer,e.label);return this.textureLocation[r]=i,this.textureIndex[r]=this.textureNum,[i,this.textureNum++]}return[this.textureLocation[r],this.textureIndex[r]]}},{key:"draw",value:function(t){t.useProgram(this.pointer)}},{key:"_createShader",value:function(t,e,r){var i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:console.error("Une erreur est survenue au cours de la compilation du shader: "+t.getShaderInfoLog(i))}}]),t}();e.default=u},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),u=r(4),h=i(u),l=r(0),f=i(l),c=function(t){function e(t){n(this,e);var r=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,35676,new h.default));return r.fovy=45,r.near=.1,r.far=1e3,r._matrix=new h.default,r.updated=!0,r}return o(e,t),s(e,[{key:"update",value:function(t,e){this.data.perspective(this.fovy*Math.PI/180,t/e,.1,100),this.data.multiply(this._matrix),this.updated=!1}},{key:"matrix",get:function(){return this.updated=!0,this._matrix}}]),e}(f.default);e.default=c},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=function(){function t(e,r){i(this,t),this.geom=e,this.program=r,this.uniforms=[],this.textures=[],this.localCalls=[],this.globalCalls=[],this.order=0,this._isInitialized=!1}return a(t,[{key:"addUniform",value:function(t){this.uniforms.push(t)}},{key:"addTexture",value:function(t){this.textures.push(t)}},{key:"isInitialized",value:function(){var t=this._isInitialized;if(t)return t;this.program.isInitialized()||(t=!1);var e=!0,r=!1,i=void 0;try{for(var n,a=this.geom.attributes[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){n.value.isInitialized()||(t=!1)}}catch(t){r=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw i}}var o=!0,s=!1,u=void 0;try{for(var h,l=this.geom.buffers[Symbol.iterator]();!(o=(h=l.next()).done);o=!0){h.value.isInitialized()||(t=!1)}}catch(t){s=!0,u=t}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}var f=!0,c=!1,v=void 0;try{for(var d,y=this.textures[Symbol.iterator]();!(f=(d=y.next()).done);f=!0){d.value.isInitialized()||(t=!1)}}catch(t){c=!0,v=t}finally{try{!f&&y.return&&y.return()}finally{if(c)throw v}}return t}},{key:"_setCalls",value:function(t,e){var r=this.program,i=!0,a=!1,o=void 0;try{for(var s,u=this.geom.attributes[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var h=s.value,l=r.getAttribLocation(t,h);this.localCalls.push(h.draw.bind(h,t,l))}}catch(t){a=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(a)throw o}}var f=!0,c=!1,v=void 0;try{for(var d,y=this.geom.buffers[Symbol.iterator]();!(f=(d=y.next()).done);f=!0){var p=d.value;this.localCalls.push(p.draw.bind(p,t))}}catch(t){c=!0,v=t}finally{try{!f&&y.return&&y.return()}finally{if(c)throw v}}var m=!0,b=!1,g=void 0;try{for(var M,_=this.uniforms[Symbol.iterator]();!(m=(M=_.next()).done);m=!0){var w=M.value,x=r.getUniformLocation(t,w);this.localCalls.push(w.draw.bind(w,t,x))}}catch(t){b=!0,g=t}finally{try{!m&&_.return&&_.return()}finally{if(b)throw g}}var T=!0,P=!1,E=void 0;try{for(var k,O=this.textures[Symbol.iterator]();!(T=(k=O.next()).done);T=!0){var I=k.value,S=r.getTextureLocationIndex(t,I),A=n(S,2),C=A[0],R=A[1];this.localCalls.push(I.draw.bind(I,t,C,R))}}catch(t){P=!0,E=t}finally{try{!T&&O.return&&O.return()}finally{if(P)throw E}}var L=!0,j=!1,D=void 0;try{for(var U,z=e[Symbol.iterator]();!(L=(U=z.next()).done);L=!0){var V=U.value,X=r.getUniformLocation(t,V);this.globalCalls.push(V.draw.bind(V,t,X))}}catch(t){j=!0,D=t}finally{try{!L&&z.return&&z.return()}finally{if(j)throw D}}}},{key:"_initData",value:function(t){var e=(this.program,!0),r=!0,i=!1,n=void 0;try{for(var a,o=this.geom.attributes[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;s.isInitialized()||s.init(t)||(e=!1)}}catch(t){i=!0,n=t}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}var u=!0,h=!1,l=void 0;try{for(var f,c=this.geom.buffers[Symbol.iterator]();!(u=(f=c.next()).done);u=!0){var v=f.value;v.isInitialized()||v.init(t)||(e=!1)}}catch(t){h=!0,l=t}finally{try{!u&&c.return&&c.return()}finally{if(h)throw l}}var d=!0,y=!1,p=void 0;try{for(var m,b=this.textures[Symbol.iterator]();!(d=(m=b.next()).done);d=!0){var g=m.value;g.isInitialized()||g.init(t)||(e=!1)}}catch(t){y=!0,p=t}finally{try{!d&&b.return&&b.return()}finally{if(y)throw p}}return e}},{key:"init",value:function(t,e){var r=(this.program,!0);return this.program.isInitialized()||(this.program.init(t)?this.program.draw(t):r=!1),this._initData(t)||(r=!1),r&&this.localCalls.length<1&&this._setCalls(t,e),this._isInitialized=r,r}},{key:"draw",value:function(t,e){var r=this.program;if(!e.optimizeProgram(r)){this.program.draw(t);var i=!0,n=!1,a=void 0;try{for(var o,s=this.globalCalls[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)(0,o.value)()}catch(t){n=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}}var u=!0,h=!1,l=void 0;try{for(var f,c=this.localCalls[Symbol.iterator]();!(u=(f=c.next()).done);u=!0){(0,f.value)()}}catch(t){h=!0,l=t}finally{try{!u&&c.return&&c.return()}finally{if(h)throw l}}this.geom.display(t)}}]),t}();e.default=o},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=r(3),s=function(t){return t&&t.__esModule?t:{default:t}}(o),u=function(){function t(e,r){i(this,t),this.canvas=e,this.init(e),this.meshs=[],this.cam=r,this.uniforms=[r],this.depthTest=!0,this.sortCompare=function(t,e){return t.program.id-e.program.id},this.resize(e.width,e.height)}return a(t,[{key:"_addCamToMeshs",value:function(){var t=this.cam;this.uniforms.push(t)}},{key:"addMesh",value:function(t){this.meshs.push(t),t.isInitialized()||t.init(this.gl,this.uniforms)}},{key:"rmMesh",value:function(t){var e=this.meshs.indexOf(t);e>-1&&this.meshs.splice(e,1)}},{key:"sort",value:function(){this.meshs.sort(this.sortCompare)}},{key:"resize",value:function(t,e){this.width=t,this.height=e}},{key:"init",value:function(t){var e=void 0;try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(t){console.error("Could not initialise WebGL:",t.message)}e||console.error("Could not initialise WebGL"),this.gl=e}},{key:"draw",value:function(){var t=this.gl,e=s.default.getInstance(t);t.viewport(0,0,this.width,this.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.cam.updated&&this.cam.update(this.width,this.height);var r=!0,i=!1,n=void 0;try{for(var a,o=this.meshs[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;u.isInitialized()?u.draw(t,e):u.init(t,this.uniforms)}}catch(t){i=!0,n=t}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}}},{key:"depthTest",set:function(t){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._depthTest=!!t},get:function(){return this._depthTest}},{key:"bgColor",set:function(t){var e=n(t,4),r=e[0],i=e[1],a=e[2],o=e[3],s=void 0===o?1:o;this.gl.clearColor(r,i,a,s),this._bgColor=[r,i,a,s]},get:function(){return this._bgColor}}]),t}();e.default=u},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),u=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},h=r(13),l=i(h),f=r(14),c=i(f),v=function(t){function e(t){n(this,e);var r=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.srcs=[],r}return o(e,t),s(e,[{key:"addDDSURL",value:function(t,e){var r=this,i={size:e,src:t,img:null,isImage:!1,priority:1,isValid:function(){return!0},init:null};i.init=function(t){var e=(0,c.default)(i.img),n=e.images[0],a=new Uint8Array(i.img,n.offset,n.length),o=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");t.bindTexture(t.TEXTURE_2D,r.pointer),t.compressedTexImage2D(t.TEXTURE_2D,0,o.COMPRESSED_RGBA_S3TC_DXT5_EXT,e.shape[0],e.shape[1],0,a),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),r.mipmap=!1,r.setParam(t.TEXTURE_MAG_FILTER,t.LINEAR),r.setParam(t.TEXTURE_MIN_FILTER,t.LINEAR),r.initParams(t)},this.srcs.push(i)}},{key:"addURL",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i={size:r,src:t,img:null,priority:0,isImage:!0,isValid:function(){return!0},init:null};i.init=function(t){t.bindTexture(t.TEXTURE_2D,e.pointer),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,6408,e.format,t.UNSIGNED_BYTE,i.img),e.img=i.img,e.initParams(t)},this.srcs.push(i)}},{key:"init",value:function(t,r){var i=u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this,t,r);this.pointer;return e.START_LOAD(t,this.srcs),i}}],[{key:"START_LOAD",value:function(t,r){if(r.length>0){r.sort(function(t,e){return t.size===e.size?t.size-e.size:t.priority-e.priority});r.filter(function(e){return e.size>=l.default.MAX_SIZE&&e.isValid(t)});if(r.length>1){var i=r[0],n=r[r.length-1];e.LOAD(i,function(){i.init(t),e.LOAD(n,function(){n.init(t)})})}else if(r.length>0){var a=r[0];e.LOAD(a,function(){a.init(t)})}else console.warn("The GPU can'nt load a texture with size > ",l.default.MAX_SIZE)}else console.warn("URL of your texture",this.label,"not found: texture.addURL(URL, size = 0)")}},{key:"LOAD",value:function(t,e){if(t.isImage){var r=new Image;r.onload=function(){e(t)},t.img=r,r.src=t.src}else{var i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",t.src,!0),i.onreadystatechange=function(r){i.readyState===XMLHttpRequest.DONE&&(200===i.status?(t.img=i.response,e(t)):console.error("fail to load image ",t.src,"status:",i.status,"statuc text:",i.statusText))},i.send()}}}]),e}(l.default);e.default=v},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=r(4),u=i(s),h=r(0),l=i(h),f=function(t){function e(t){return n(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,35676,(new u.default).identity()))}return o(e,t),e}(l.default);e.default=f},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(){I.matrix.rotate(.005,[0,1,0]),F.matrix.rotate(-.005,[0,1,0]),V.matrix.rotate(.01,[0,1,0]),Z.matrix.rotate(-.01,[0,1,0]),x.draw(),requestAnimationFrame(n)}var a=r(0),o=(i(a),r(11)),s=i(o),u=r(1),h=(i(u),r(6)),l=i(h),f=r(5),c=i(f),v=r(10),d=i(v),y=r(8),p=i(y),m=r(7),b=i(m),g=r(9),M=i(g),_=document.body.querySelector("canvas"),w=new b.default("uPMatrix"),x=new M.default(_,w);x.bgColor=[0,0,.1,1],x.depthTest=!0;var T=new l.default,P=new l.default("\n    attribute vec3 aVertexPosition;\n    attribute vec4 aVertexColor;\n\n    uniform mat4 uMVMatrix;\n    uniform mat4 uPMatrix;\n\n    varying vec4 vColor;\n\n    void main(void) {\n        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n        float zDepth = 0.2 * (8.0 - gl_Position.z);\n        vec4 modifyColor = vec4(aVertexColor.rgb * zDepth, aVertexColor.a);\n        vColor = modifyColor;\n    }\n"),E=[0,1,0,-1,-1,1,1,-1,1,0,1,0,1,-1,1,1,-1,-1,0,1,0,1,-1,-1,-1,-1,-1,0,1,0,-1,-1,-1,-1,-1,1],k=[1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,1,0,1],O=new c.default;O.addVertices("aVertexPosition",E,3),O.addVertices("aVertexColor",k,4);var I=new p.default(O,T),S=new s.default("uMVMatrix");I.addUniform(S),I.matrix=S.data,I.matrix.translate([-1.5,-1.5,-8]),x.addMesh(I);var A=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],C=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],R=[[1,0,0,1],[1,1,0,1],[0,1,0,1],[1,.5,.5,1],[1,0,1,1],[0,0,1,1]],L=[];for(var j in R)for(var D=R[j],U=0;U<4;U++)L=L.concat(D);var z=new c.default;z.addVertices("aVertexPosition",A,3),z.addVertices("aVertexColor",L,4),z.addIndices(C);var V=new p.default(z,P),X=new s.default("uMVMatrix");V.addUniform(X),V.matrix=X.data,V.matrix.translate([1.5,-1.5,-8]),x.addMesh(V);var F=new p.default(O,T),N=new s.default("uMVMatrix");F.addUniform(N),F.matrix=N.data,F.matrix.translate([-1.5,1.5,-8]),F.matrix.scale([1,-1,1]),x.addMesh(F);var G=new l.default("   \n    attribute vec3 aVertexPosition;\n    attribute vec2 aTextureCoord;\n\n    uniform mat4 uMVMatrix;\n    uniform mat4 uPMatrix;\n\n    varying vec2 vTextureCoord;\n\n    void main(void) {\n        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n        vTextureCoord = aTextureCoord;\n    }","\n    precision mediump float;\n\n    varying vec2 vTextureCoord;\n\n    uniform sampler2D uSampler;\n\n    void main(void) {\n        gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n    }"),B=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],q=new d.default("uSampler");q.addURL("cube-diffuse.jpg");var W=new c.default;W.addVertices("aVertexPosition",A,3),W.addVertices("aTextureCoord",B,2),W.addIndices(C);var Z=new p.default(W,G),Y=new s.default("uMVMatrix");Z.addUniform(Y),Z.matrix=Y.data,Z.addTexture(q),Z.matrix.translate([1.5,1.5,-8]),x.addMesh(Z),x.sort();var H=[500,500];x.resize(1*H[0],1*H[1]),_.width=1*H[0],_.height=1*H[1],_.style.width=H[0]+"px",_.style.height=H[1]+"px",n()},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=r(3),s=function(t){return t&&t.__esModule?t:{default:t}}(o),u=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uint8Array([255,255,255,255]);i(this,t),this.label=e,this.mipmap=!0,this.pointer=null,this.parameters=[],this.img=r,this.setFormat(),this.setTarget()}return a(t,[{key:"setFormat",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6408;this.format=t}},{key:"setTarget",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3553;this.target=t}},{key:"setParam",value:function(t,e){var r=this.parameters.find(function(e){return e[0]===t});r>-1?this.parameters[r][1]=e:this.parameters.push([t,e])}},{key:"isInitialized",value:function(){return!!this.pointer}},{key:"setDefaultParams",value:function(t){this.mipmap?this.setParam(t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR):(this.setParam(t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),this.setParam(t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.setParam(t.TEXTURE_MIN_FILTER,t.LINEAR))}},{key:"initParams",value:function(e){if(this.mipmap){var r=this.img;null===r?console.warn("You need an image to set the parameters:",this.label):t.IS_POWER_OF_2(r.width)&&t.IS_POWER_OF_2(r.height)?e.generateMipmap(e.TEXTURE_2D):(this.mipmap=!1,console.warn("You need a power of 2 for the size of the mipmaped texture:",this.label))}this.parameters.length<1&&this.setDefaultParams(e);var i=!0,a=!1,o=void 0;try{for(var s,u=this.parameters[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var h=n(s.value,2),l=h[0],f=h[1];e.texParameteri(this.target,l,f)}}catch(t){a=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(a)throw o}}}},{key:"init",value:function(e){var r=e.createTexture();return t._DATA_INITIALIZED||t.SET_DATA(e),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGB,1,1,0,e.RGB,e.UNSIGNED_BYTE,this.img),this.pointer=r,!0}},{key:"draw",value:function(t,e,r){s.default.getInstance(t).optimizeTexture(this)||(t.uniform1i(e,r),t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,this.pointer))}}],[{key:"IS_POWER_OF_2",value:function(t){return 0==(t&t-1)}},{key:"SET_DATA",value:function(e){t.MAX_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),t.FORMAT={};for(var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),i=0;i<r.length;i++)t.FORMAT[r[i]]=!0;t._DATA_INITIALIZED=!0}}]),t}();e.default=u},function(t,e){function r(t){var e=new Int32Array(t,0,p);if(e[m]!==a)throw new Error("Invalid magic number in DDS header");if(!e[x]&s)throw new Error("Unsupported format, must contain a FourCC code");var r,i,E=e[T];switch(E){case u:r=8,i="dxt1";break;case h:r=16,i="dxt3";break;case l:r=16,i="dxt5";break;case c:i="rgba32f";break;case f:var k=new Uint32Array(t.slice(128,148));i=k[0];var O=k[1];k[2],k[3],k[4];if(O!==d||i!==y)throw new Error("Unsupported DX10 texture format "+i);i="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+n(E))}var I=e[g],S=1;I&o&&(S=Math.max(1,e[w]));var A=!1;e[P]&v&&(A=!0);var C,R=e[_],L=e[M],j=e[b]+4,D=R,U=L,z=[];if(E===f&&(j+=20),A)for(var V=0;V<6;V++){if("rgba32f"!==i)throw new Error("Only RGBA32f cubemaps are supported");R=D,L=U;for(var X=Math.log(R)/Math.log(2)+1,F=0;F<X;F++)C=R*L*16,z.push({offset:j,length:C,shape:[R,L]}),F<S&&(j+=C),R=Math.floor(R/2),L=Math.floor(L/2)}else for(var F=0;F<S;F++)C=Math.max(4,R)/4*Math.max(4,L)/4*r,z.push({offset:j,length:C,shape:[R,L]}),j+=C,R=Math.floor(R/2),L=Math.floor(L/2);return{shape:[D,U],images:z,format:i,flags:I,cubemap:A}}function i(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function n(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}var a=542327876,o=131072,s=4,u=i("DXT1"),h=i("DXT3"),l=i("DXT5"),f=i("DX10"),c=116,v=512,d=3,y=2,p=31,m=0,b=1,g=2,M=3,_=4,w=7,x=20,T=21,P=28;t.exports=r}]);