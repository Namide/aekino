!function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=18)}([function(t,e,r){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=function(){function t(e,r,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n(this,t),this.label=e,this.type=r,this.data=i,this._init(r,a)}return a(t,[{key:"_init",value:function(t,e){var r=this;switch(this.type){case 35676:this.draw=function(t,e){t.uniformMatrix4fv(e,!1,r.data)};break;case 35665:this.draw=function(t,e){t.uniform3f.apply(t,[e].concat(i(r.data)))};break;case 5124:this.draw=function(t,e){t.uniform1i(e,r.data)};break;case-1:this.draw=function(t,e){t.uniform1fv(e,r.data)};break;default:console.error("Uniform type unknow: {label:",this.label,", type:",t,"}")}}}]),t}();e.default=o},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),u=r(6),h=i(u),l=r(5),f=i(l),c=r(0),d=i(c),v=r(17),p=i(v),y=function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"aVertexPosition";arguments.length>2&&void 0!==arguments[2]&&arguments[2];n(this,e);var i=new f.default,o=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];return i.addVertices(r,o,2),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,t))}return o(e,t),s(e,[{key:"resize",value:function(t,e){this.uWidth&&(this.uWidth.data=t),this.uHeight&&(this.uHeight.data=e)}},{key:"useUWidth",value:function(t,e){var r=new d.default(t,5124,e);this.uWidth=r,this.addUniform(r)}},{key:"useUHeight",value:function(t,e){var r=new d.default(t,5124,e);this.uHeight=r,this.addUniform(r)}},{key:"useColorTexture",value:function(t){var e=new p.default(t);this.inColorTexture=e,this.addTexture(e)}},{key:"useDepthTexture",value:function(t,e){var r=new p.default(t);this.inDepthTexture=r,this.addTexture(r);var i=new d.default(e,5124,1);this._inDetpthEnableUniform=i,this.addUniform(i)}},{key:"setDepthTexture",value:function(t,e){this.rmTexture(this.inDepthTexture),t&&this.addTexture(this.inDepthTexture),this._inDetpthEnableUniform.data=t?1:0;var r=this.globalUniforms;this.dispose(),this.init(e,r)}}]),e}(h.default);e.default=y},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a="      \n    attribute vec3 aVertexPosition;\n    attribute vec4 aVertexColor;\n\n    uniform mat4 uMVMatrix;\n    uniform mat4 uPMatrix;\n\n    varying vec4 vColor;\n\n    void main(void) {\n        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n        vColor = aVertexColor;\n    }\n",o="\n    precision mediump float;\n\n    varying vec4 vColor;\n\n    void main(void) {\n        gl_FragColor = vColor;\n    }\n",s=0,u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;i(this,t),this.vertexShaderSrc=e,this.fragmentShaderSrc=r,this.attribLocation={},this.uniformLocation={},this.textureLocation={},this.textureIndex={},this.textureNum=0,this.id=++s}return n(t,[{key:"isInitialized",value:function(){return!!this.pointer}},{key:"init",value:function(t){this.vertexShader=this._createShader(t,35633,this.vertexShaderSrc),this.fragmentShader=this._createShader(t,35632,this.fragmentShaderSrc);var e=t.createProgram();return t.attachShader(e,this.vertexShader),t.attachShader(e,this.fragmentShader),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)?(t.useProgram(e),this.pointer=e,!0):(console.error("Shader initialization error"),!1)}},{key:"getAttribLocation",value:function(t,e){var r=e.label;if(!this.attribLocation.hasOwnProperty(r)){var i=t.getAttribLocation(this.pointer,r);return t.enableVertexAttribArray(i),this.attribLocation[r]=i,i}return this.attribLocation[r]}},{key:"getUniformLocation",value:function(t,e){var r=e.label;if(!this.uniformLocation.hasOwnProperty(r)){var i=t.getUniformLocation(this.pointer,r);return this.uniformLocation[r]=i,i}return this.uniformLocation[r]}},{key:"getTextureLocationIndex",value:function(t,e){var r=e.label;if(!this.textureLocation.hasOwnProperty(r)||!this.textureIndex.hasOwnProperty(r)){var i=t.getUniformLocation(this.pointer,r);return this.textureLocation[r]=i,this.textureIndex[r]=this.textureNum,[i,this.textureNum++]}return[this.textureLocation[r],this.textureIndex[r]]}},{key:"draw",value:function(t){t.useProgram(this.pointer)}},{key:"_createShader",value:function(t,e,r){var i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:console.error("Une erreur est survenue au cours de la compilation du shader: "+t.getShaderInfoLog(i))}}]),t}();e.default=u},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(){i(this,t),this.lastTexture=null,this.lastProgram=null}return n(t,[{key:"optimizeTexture",value:function(t){var e=this.lastTexture;return this.lastTexture=t,t===e}},{key:"optimizeProgram",value:function(t){var e=this.lastProgram;return this.lastProgram=t,t===e}}],[{key:"getInstance",value:function(e){var r=t.glList.indexOf(e);if(r<0){var i=new t;return t.glList.push(e),t.list.push(i),i}return t.list[r]}}]),t}();a.glList=[],a.list=[],e.default=a},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},u=r(7),h=function(t){return t&&t.__esModule?t:{default:t}}(u),l=function(t){function e(t){i(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.label=t,r}return a(e,t),o(e,[{key:"draw",value:function(t,r){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"draw",this).call(this,t),t.vertexAttribPointer(r,this.itemSize,this.itemType,!1,0,0)}}]),e}(h.default);e.default=l},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=r(7),s=i(o),u=r(4),h=i(u),l=function(){function t(){n(this,t),this.attributes=[],this.buffers=[],this.hasIndices=!1,this.numItems=0}return a(t,[{key:"addVertices",value:function(t,e,r){var i=new h.default(t);i.setArray(new Float32Array(e),34962),i.setItems(5126,r),this.attributes.push(i),this.numItems<1&&(this.numItems=e.length/r)}},{key:"addIndices",value:function(t){this.hasIndices=!0;var e=new s.default;e.setArray(new Uint16Array(t),34963),e.setItems(5125,1),this.buffers.push(e),this.numItems=t.length}},{key:"display",value:function(t){this.hasIndices?t.drawElements(t.TRIANGLES,this.numItems,t.UNSIGNED_SHORT,0):t.drawArrays(t.TRIANGLES,0,this.numItems)}}]),t}();e.default=l},function(t,e,r){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=r(3),u=function(t){return t&&t.__esModule?t:{default:t}}(s),h=function(){function t(e,r){n(this,t),this.geom=e,this.program=r,this.uniforms=[],this.globalUniforms=[],this.textures=[],this.localCalls=[],this.globalCalls=[],this.order=0,this._isInitialized=!1}return o(t,[{key:"addUniform",value:function(t){this.uniforms.push(t)}},{key:"rmUniform",value:function(t){var e=this.uniforms.indexOf(t);e>-1&&this.uniforms.splice(e,1)}},{key:"addTexture",value:function(t){this.textures.push(t)}},{key:"rmTexture",value:function(t){var e=this.textures.indexOf(t);e>-1&&this.textures.splice(e,1)}},{key:"isInitialized",value:function(){var t=this._isInitialized;if(t)return t;this.program.isInitialized()||(t=!1);var e=!0,r=!1,i=void 0;try{for(var n,a=this.geom.attributes[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){n.value.isInitialized()||(t=!1)}}catch(t){r=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw i}}var o=!0,s=!1,u=void 0;try{for(var h,l=this.geom.buffers[Symbol.iterator]();!(o=(h=l.next()).done);o=!0){h.value.isInitialized()||(t=!1)}}catch(t){s=!0,u=t}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}var f=!0,c=!1,d=void 0;try{for(var v,p=this.textures[Symbol.iterator]();!(f=(v=p.next()).done);f=!0){v.value.isInitialized()||(t=!1)}}catch(t){c=!0,d=t}finally{try{!f&&p.return&&p.return()}finally{if(c)throw d}}return t}},{key:"_setCalls",value:function(t,e){var r=this.program,i=!0,n=!1,o=void 0;try{for(var s,u=this.geom.attributes[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var h=s.value,l=r.getAttribLocation(t,h);this.localCalls.push(h.draw.bind(h,t,l))}}catch(t){n=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(n)throw o}}var f=!0,c=!1,d=void 0;try{for(var v,p=this.geom.buffers[Symbol.iterator]();!(f=(v=p.next()).done);f=!0){var y=v.value;this.localCalls.push(y.draw.bind(y,t))}}catch(t){c=!0,d=t}finally{try{!f&&p.return&&p.return()}finally{if(c)throw d}}var m=!0,b=!1,g=void 0;try{for(var x,w=this.uniforms[Symbol.iterator]();!(m=(x=w.next()).done);m=!0){var _=x.value,T=r.getUniformLocation(t,_);this.localCalls.push(_.draw.bind(_,t,T))}}catch(t){b=!0,g=t}finally{try{!m&&w.return&&w.return()}finally{if(b)throw g}}var M=!0,E=!1,P=void 0;try{for(var k,O=this.textures[Symbol.iterator]();!(M=(k=O.next()).done);M=!0){var C=k.value,D=r.getTextureLocationIndex(t,C),R=a(D,2),I=R[0],A=R[1];this.localCalls.push(C.draw.bind(C,t,I,A))}}catch(t){E=!0,P=t}finally{try{!M&&O.return&&O.return()}finally{if(E)throw P}}var S=!0,F=!1,j=void 0;try{for(var U,L=e[Symbol.iterator]();!(S=(U=L.next()).done);S=!0){var z=U.value,B=r.getUniformLocation(t,z);this.globalCalls.push(z.draw.bind(z,t,B))}}catch(t){F=!0,j=t}finally{try{!S&&L.return&&L.return()}finally{if(F)throw j}}}},{key:"_initData",value:function(t){var e=(this.program,!0),r=!0,i=!1,n=void 0;try{for(var a,o=this.geom.attributes[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;s.isInitialized()||s.init(t)||(e=!1)}}catch(t){i=!0,n=t}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}var u=!0,h=!1,l=void 0;try{for(var f,c=this.geom.buffers[Symbol.iterator]();!(u=(f=c.next()).done);u=!0){var d=f.value;d.isInitialized()||d.init(t)||(e=!1)}}catch(t){h=!0,l=t}finally{try{!u&&c.return&&c.return()}finally{if(h)throw l}}var v=!0,p=!1,y=void 0;try{for(var m,b=this.textures[Symbol.iterator]();!(v=(m=b.next()).done);v=!0){var g=m.value;g.isInitialized()||g.init(t)||(e=!1)}}catch(t){p=!0,y=t}finally{try{!v&&b.return&&b.return()}finally{if(p)throw y}}return e}},{key:"dispose",value:function(){this._isInitialized=!1,this.localCalls.length=0}},{key:"init",value:function(t,e){var r=(this.program,!0);return this.program.isInitialized()?this.program.draw(t):this.program.init(t)||(r=!1),this._initData(t)||(r=!1),r&&this.localCalls.length<1&&this._setCalls(t,e),this.globalUniforms=[].concat(i(e)),this._isInitialized=r,r}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=u.default.getInstance(t),i=this.program;if(!r.optimizeProgram(i)){this.program.draw(t);var n=!0,a=!1,o=void 0;try{for(var s,h=this.globalCalls[Symbol.iterator]();!(n=(s=h.next()).done);n=!0)(0,s.value)()}catch(t){a=!0,o=t}finally{try{!n&&h.return&&h.return()}finally{if(a)throw o}}}var l=!0,f=!1,c=void 0;try{for(var d,v=this.localCalls[Symbol.iterator]();!(l=(d=v.next()).done);l=!0){(0,d.value)()}}catch(t){f=!0,c=t}finally{try{!l&&v.return&&v.return()}finally{if(f)throw c}}var p=!0,y=!1,m=void 0;try{for(var b,g=e[Symbol.iterator]();!(p=(b=g.next()).done);p=!0){(0,b.value)()}}catch(t){y=!0,m=t}finally{try{!p&&g.return&&g.return()}finally{if(y)throw m}}this.geom.display(t)}}]),t}();e.default=h},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(){i(this,t),this.buffer=null}return n(t,[{key:"isInitialized",value:function(){return!!this.buffer}},{key:"setArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:34962,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:35044;this.arrayType=e,this.data=t,this.arrayUsage=r}},{key:"setItems",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5126,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.itemType=t,this.itemSize=e}},{key:"init",value:function(t){var e=t.createBuffer();return t.bindBuffer(this.arrayType,e),t.bufferData(this.arrayType,this.data,this.arrayUsage),this.buffer=e,!0}},{key:"draw",value:function(t){t.bindBuffer(this.arrayType,this.buffer)}}]),t}();e.default=a},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=r(3),s=function(t){return t&&t.__esModule?t:{default:t}}(o),u=function(){function t(e){i(this,t),this.label=e,this.mipmap=!0,this.img=null,this.width=null,this.height=null,this.pointer=null,this.parameters=[],this.setType(),this.setInternalFormat(),this.setFormat(),this.setTarget()}return a(t,[{key:"resize",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.width=t,this.height=e,r?(r.bindTexture(this.target,this.pointer),r.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img)):this.updated=!0}},{key:"setTempColor",value:function(t){this.setImg(new Uint8Array(t),1,1)}},{key:"setImg",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array([255,255,255,255]),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.img=t,this.width=e,this.height=r}},{key:"setType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5121;this.type=t}},{key:"setInternalFormat",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6408;this.internalFormat=t}},{key:"setFormat",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6408;this.format=t}},{key:"setTarget",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3553;this.target=t}},{key:"setParam",value:function(t,e){var r=this.parameters.find(function(e){return e[0]===t});r>-1?this.parameters[r][1]=e:this.parameters.push([t,e])}},{key:"isInitialized",value:function(){return!!this.pointer}},{key:"setDefaultParams",value:function(t){this.mipmap?this.setParam(t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR):(this.setParam(t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),this.setParam(t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.setParam(t.TEXTURE_MIN_FILTER,t.LINEAR))}},{key:"initParams",value:function(e){if(this.mipmap){var r=this.img;null===r?console.warn("You need an image to set the parameters of texture"):t.IS_POWER_OF_2(r.width)&&t.IS_POWER_OF_2(r.height)?e.generateMipmap(this.target):(this.mipmap=!1,console.warn("You need a power of 2 for the size of the mipmaped texture"))}this.parameters.length<1&&this.setDefaultParams(e);var i=!0,a=!1,o=void 0;try{for(var s,u=this.parameters[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var h=n(s.value,2),l=h[0],f=h[1];e.texParameteri(this.target,l,f)}}catch(t){a=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(a)throw o}}}},{key:"init",value:function(e){var r=e.createTexture();return t._DATA_INITIALIZED||t.SET_DATA(e),e.bindTexture(this.target,r),e.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.initParams(e),this.pointer=r,!0}},{key:"draw",value:function(t,e,r){s.default.getInstance(t).optimizeTexture(this)||(t.uniform1i(e,r),t.activeTexture(t.TEXTURE0+r),t.bindTexture(this.target,this.pointer),this.updated&&(t.texImage2D(this.target,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.img),this.updated=!1))}},{key:"free",value:function(t){t.bindTexture(t.TEXTURE_2D,null)}}],[{key:"IS_POWER_OF_2",value:function(t){return 0==(t&t-1)}},{key:"SET_DATA",value:function(e){t.MAX_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),t.FORMAT={};for(var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),i=0;i<r.length;i++)t.FORMAT[r[i]]=!0;t._DATA_INITIALIZED=!0}}]),t}();e.default=u},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e,r,i,n,a,o,s,u,h,l,f,c,d,v,p,y){t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=h,t[9]=l,t[10]=f,t[11]=c,t[12]=d,t[13]=v,t[14]=p,t[15]=y}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),l=function(t){function e(){i(this,e);var t=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,16));return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}return o(e,t),h(e,[{key:"clone",value:function(){var t=new e;return t.set(this),t}},{key:"copy",value:function(t){return t.set(this),this}},{key:"identity",value:function(){return s(this,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"add",value:function(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this[3]+=t[3],this[4]+=t[4],this[5]+=t[5],this[6]+=t[6],this[7]+=t[7],this[8]+=t[8],this[9]+=t[9],this[10]+=t[10],this[11]+=t[11],this[12]+=t[12],this[13]+=t[13],this[14]+=t[14],this[15]+=t[15],this}},{key:"subtract",value:function(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this[3]-=t[3],this[4]-=t[4],this[5]-=t[5],this[6]-=t[6],this[7]-=t[7],this[8]-=t[8],this[9]-=t[9],this[10]-=t[10],this[11]-=t[11],this[12]-=t[12],this[13]-=t[13],this[14]-=t[14],this[15]-=t[15],this}},{key:"multiplyScalar",value:function(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this[4]*=t,this[5]*=t,this[6]*=t,this[7]*=t,this[8]*=t,this[9]*=t,this[10]*=t,this[11]*=t,this[12]*=t,this[13]*=t,this[14]*=t,this[15]*=t,this}},{key:"multiplyScalarAndAdd",value:function(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this[2]+=t[2]*e,this[3]+=t[3]*e,this[4]+=t[4]*e,this[5]+=t[5]*e,this[6]+=t[6]*e,this[7]+=t[7]*e,this[8]+=t[8]*e,this[9]+=t[9]*e,this[10]+=t[10]*e,this[11]+=t[11]*e,this[12]+=t[12]*e,this[13]+=t[13]*e,this[14]+=t[14]*e,this[15]+=t[15]*e,this}},{key:"exactEquals",value:function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]&&this[3]===t[3]&&this[4]===t[4]&&this[5]===t[5]&&this[6]===t[6]&&this[7]===t[7]&&this[8]===t[8]&&this[9]===t[9]&&this[10]===t[10]&&this[11]===t[11]&&this[12]===t[12]&&this[13]===t[13]&&this[14]===t[14]&&this[15]===t[15]}},{key:"equals",value:function(t){var e=u(this,16),r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],h=e[6],l=e[7],f=e[8],c=e[9],d=e[10],v=e[11],p=e[12],y=e[13],m=e[14],b=e[15],g=u(t,16),x=g[0],w=g[1],_=g[2],T=g[3],M=g[4],E=g[5],P=g[6],k=g[7],O=g[8],C=g[9],D=g[10],R=g[11],I=g[12],A=g[13],S=g[14],F=g[15];return Math.abs(r-x)<=1e-6*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-w)<=1e-6*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(n-_)<=1e-6*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-T)<=1e-6*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(o-M)<=1e-6*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(s-E)<=1e-6*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(h-P)<=1e-6*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(l-k)<=1e-6*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(f-O)<=1e-6*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(c-C)<=1e-6*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(d-D)<=1e-6*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(v-R)<=1e-6*Math.max(1,Math.abs(v),Math.abs(R))&&Math.abs(p-I)<=1e-6*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(y-A)<=1e-6*Math.max(1,Math.abs(y),Math.abs(A))&&Math.abs(m-S)<=1e-6*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(b-F)<=1e-6*Math.max(1,Math.abs(b),Math.abs(F))}},{key:"transpose",value:function(t){if(t===this){var e=t[1],r=t[2],i=t[3],n=t[6],a=t[7],o=t[11];this[1]=t[4],this[2]=t[8],this[3]=t[12],this[4]=e,this[6]=t[9],this[7]=t[13],this[8]=r,this[9]=n,this[11]=t[14],this[12]=i,this[13]=a,this[14]=o}else s(this,t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]);return this}},{key:"invert",value:function(){var t=u(this,16),e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],f=t[8],c=t[9],d=t[10],v=t[11],p=t[12],y=t[13],m=t[14],b=t[15],g=e*o-r*a,x=e*h-i*a,w=e*l-n*a,_=r*h-i*o,T=r*l-n*o,M=i*l-n*h,E=f*y-c*p,P=f*m-d*p,k=f*b-v*p,O=c*m-d*y,C=c*b-v*y,D=d*b-v*m,R=g*D-x*C+w*O+_*k-T*P+M*E;return R?(R=1/R,s(this,(o*D-h*C+l*O)*R,(i*C-r*D-n*O)*R,(y*M-m*T+b*_)*R,(d*T-c*M-v*_)*R,(h*k-a*D-l*P)*R,(e*D-i*k+n*P)*R,(m*w-p*M-b*x)*R,(f*M-d*w+v*x)*R,(a*C-o*k+l*E)*R,(r*k-e*C-n*E)*R,(p*T-y*w+b*g)*R,(c*w-f*T-v*g)*R,(o*P-a*O-h*E)*R,(e*O-r*P+i*E)*R,(y*x-p*_-m*g)*R,(f*_-c*x+d*g)*R),this):this}},{key:"adjoint",value:function(){var t=u(this,16),e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],f=t[8],c=t[9],d=t[10],v=t[11],p=t[12],y=t[13],m=t[14],b=t[15];return s(this,o*(d*b-v*m)-c*(h*b-l*m)+y*(h*v-l*d),-(r*(d*b-v*m)-c*(i*b-n*m)+y*(i*v-n*d)),r*(h*b-l*m)-o*(i*b-n*m)+y*(i*l-n*h),-(r*(h*v-l*d)-o*(i*v-n*d)+c*(i*l-n*h)),-(a*(d*b-v*m)-f*(h*b-l*m)+p*(h*v-l*d)),e*(d*b-v*m)-f*(i*b-n*m)+p*(i*v-n*d),-(e*(h*b-l*m)-a*(i*b-n*m)+p*(i*l-n*h)),e*(h*v-l*d)-a*(i*v-n*d)+f*(i*l-n*h),a*(c*b-v*y)-f*(o*b-l*y)+p*(o*v-l*c),-(e*(c*b-v*y)-f*(r*b-n*y)+p*(r*v-n*c)),e*(o*b-l*y)-a*(r*b-n*y)+p*(r*l-n*o),-(e*(o*v-l*c)-a*(r*v-n*c)+f*(r*l-n*o)),-(a*(c*m-d*y)-f*(o*m-h*y)+p*(o*d-h*c)),e*(c*m-d*y)-f*(r*m-i*y)+p*(r*d-i*c),-(e*(o*m-h*y)-a*(r*m-i*y)+p*(r*h-i*o)),e*(o*d-h*c)-a*(r*d-i*c)+f*(r*h-i*o)),this}},{key:"determinant",value:function(){var t=u(this,16),e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],s=t[6],h=t[7],l=t[8],f=t[9],c=t[10],d=t[11],v=t[12],p=t[13],y=t[14],m=t[15];return(e*o-r*a)*(c*m-d*y)-(e*s-i*a)*(f*m-d*p)+(e*h-n*a)*(f*y-c*p)+(r*s-i*o)*(l*m-d*v)-(r*h-n*o)*(l*y-c*v)+(i*h-n*s)*(l*p-f*v)}},{key:"multiply",value:function(t){var e=u(this,16),r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],h=e[6],l=e[7],f=e[8],c=e[9],d=e[10],v=e[11],p=e[12],y=e[13],m=e[14],b=e[15],g=u(t,4),x=g[0],w=g[1],_=g[2],T=g[3];return this[0]=x*r+w*o+_*f+T*p,this[1]=x*i+w*s+_*c+T*y,this[2]=x*n+w*h+_*d+T*m,this[3]=x*a+w*l+_*v+T*b,x=t[4],w=t[5],_=t[6],T=t[7],this[4]=x*r+w*o+_*f+T*p,this[5]=x*i+w*s+_*c+T*y,this[6]=x*n+w*h+_*d+T*m,this[7]=x*a+w*l+_*v+T*b,x=t[8],w=t[9],_=t[10],T=t[11],this[8]=x*r+w*o+_*f+T*p,this[9]=x*i+w*s+_*c+T*y,this[10]=x*n+w*h+_*d+T*m,this[11]=x*a+w*l+_*v+T*b,x=t[12],w=t[13],_=t[14],T=t[15],this[12]=x*r+w*o+_*f+T*p,this[13]=x*i+w*s+_*c+T*y,this[14]=x*n+w*h+_*d+T*m,this[15]=x*a+w*l+_*v+T*b,this}},{key:"translate",value:function(t){var e=u(t,3),r=e[0],i=e[1],n=e[2];return this[12]=this[0]*r+this[4]*i+this[8]*n+this[12],this[13]=this[1]*r+this[5]*i+this[9]*n+this[13],this[14]=this[2]*r+this[6]*i+this[10]*n+this[14],this[15]=this[3]*r+this[7]*i+this[11]*n+this[15],this}},{key:"scale",value:function(t){var e=u(t,3),r=e[0],i=e[1],n=e[2];return this[0]*=r,this[1]*=r,this[2]*=r,this[3]*=r,this[4]*=i,this[5]*=i,this[6]*=i,this[7]*=i,this[8]*=n,this[9]*=n,this[10]*=n,this[11]*=n,this}},{key:"rotate",value:function(t,e){var r=u(e,3),i=r[0],n=r[1],a=r[2],o=Math.sqrt(i*i+n*n+a*a);if(Math.abs(o)>1e-6){o=1/o,i*=o,n*=o,a*=o;var s=Math.sin(t),h=Math.cos(t),l=1-h,f=u(this,12),c=f[0],d=f[1],v=f[2],p=f[3],y=f[4],m=f[5],b=f[6],g=f[7],x=f[8],w=f[9],_=f[10],T=f[11],M=i*i*l+h,E=n*i*l+a*s,P=a*i*l-n*s,k=i*n*l-a*s,O=n*n*l+h,C=a*n*l+i*s,D=i*a*l+n*s,R=n*a*l-i*s,I=a*a*l+h;this[0]=c*M+y*E+x*P,this[1]=d*M+m*E+w*P,this[2]=v*M+b*E+_*P,this[3]=p*M+g*E+T*P,this[4]=c*k+y*O+x*C,this[5]=d*k+m*O+w*C,this[6]=v*k+b*O+_*C,this[7]=p*k+g*O+T*C,this[8]=c*D+y*R+x*I,this[9]=d*D+m*R+w*I,this[10]=v*D+b*R+_*I,this[11]=p*D+g*R+T*I}return this}},{key:"rotateX",value:function(t){var e=Math.sin(t),r=Math.cos(t),i=this[4],n=this[5],a=this[6],o=this[7],s=this[8],u=this[9],h=this[10],l=this[11];return this[4]=i*r+s*e,this[5]=n*r+u*e,this[6]=a*r+h*e,this[7]=o*r+l*e,this[8]=s*r-i*e,this[9]=u*r-n*e,this[10]=h*r-a*e,this[11]=l*r-o*e,this}},{key:"rotateY",value:function(t){var e=Math.sin(t),r=Math.cos(t),i=a[0],n=a[1],o=a[2],s=a[3],u=a[8],h=a[9],l=a[10],f=a[11];return this[0]=i*r-u*e,this[1]=n*r-h*e,this[2]=o*r-l*e,this[3]=s*r-f*e,this[8]=i*e+u*r,this[9]=n*e+h*r,this[10]=o*e+l*r,this[11]=s*e+f*r,this}},{key:"rotateZ",value:function(t){var e=Math.sin(t),r=Math.cos(t),i=u(this,8),n=i[0],a=i[1],o=(i[2],i[3]),s=i[4],h=i[5],l=i[6],f=i[7];return this[0]=n*r+s*e,this[1]=a*r+h*e,this[2]=a02*r+l*e,this[3]=o*r+f*e,this[4]=s*r-n*e,this[5]=h*r-a*e,this[6]=l*r-a02*e,this[7]=f*r-o*e,this}},{key:"fromTranslation",value:function(t){return s(this,1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1),this}},{key:"fromScaling",value:function(t){return s(this,t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,1),this}},{key:"fromRotation",value:function(t,e){var r=u(e,3),i=r[0],n=r[1],a=r[2],o=Math.sqrt(i*i+n*n+a*a);if(Math.abs(o)>1e-6){o=1/o,i*=o,n*=o,a*=o;var h=Math.sin(t),l=Math.cos(t),f=1-l;s(this,i*i*f+l,n*i*f+a*h,a*i*f-n*h,0,i*n*f-a*h,n*n*f+l,a*n*f+i*h,0,i*a*f+n*h,n*a*f-i*h,a*a*f+l,0,0,0,0,1)}return this}},{key:"fromXRotation",value:function(t){var e=Math.sin(t),r=Math.cos(t);return s(this,1,0,0,0,0,r,e,0,0,-e,r,0,0,0,0,1),this}},{key:"fromYRotation",value:function(t){var e=Math.sin(t),r=Math.cos(t);return s(this,r,0,-e,0,0,1,0,0,e,0,r,0,0,0,0,1),this}},{key:"fromZRotation",value:function(t){var e=Math.sin(t),r=Math.cos(t);return s(this,r,e,0,0,-e,r,0,0,0,0,1,0,0,0,0,1),this}},{key:"fromQuat",value:function(t){var e=u(t,4),r=e[0],i=e[1],n=e[2],a=e[3],o=r+r,h=i+i,l=n+n,f=r*o,c=i*o,d=i*h,v=n*o,p=n*h,y=n*l,m=a*o,b=a*h,g=a*l;return s(this,1-d-y,c+g,v-b,0,c-g,1-f-y,p+m,0,v+b,p-m,1-f-d,0,0,0,0,1),this}},{key:"fromRotationTranslation",value:function(t,e){var r=u(t,4),i=r[0],n=r[1],a=r[2],o=r[3],h=i+i,l=n+n,f=a+a,c=i*h,d=i*l,v=i*f,p=n*l,y=n*f,m=a*f,b=o*h,g=o*l,x=o*f;return s(this,1-(p+m),d+x,v-g,0,d-x,1-(c+m),y+b,0,v+g,y-b,1-(c+p),0,e[0],e[1],e[2],1),this}},{key:"fromRotationTranslationScale",value:function(t,e,r){var i=u(r,3),n=i[0],a=i[1],o=i[2],h=u(t,4),l=h[0],f=h[1],c=h[2],d=h[3],v=l+l,p=f+f,y=c+c,m=l*v,b=l*p,g=l*y,x=f*p,w=f*y,_=c*y,T=d*v,M=d*p,E=d*y;return s(this,(1-(x+_))*n,(b+E)*n,(g-M)*n,0,(b-E)*a,(1-(m+_))*a,(w+T)*a,0,(g+M)*o,(w-T)*o,(1-(m+x))*o,0,e[0],e[1],e[2],1),this}},{key:"fromRotationTranslationScaleOrigin",value:function(t,e,r,i){var n=u(t,4),a=n[0],o=n[1],h=n[2],l=n[3],f=a+a,c=o+o,d=h+h,v=a*f,p=a*c,y=a*d,m=o*c,b=o*d,g=h*d,x=l*f,w=l*c,_=l*d,T=u(r,3),M=T[0],E=T[1],P=T[2],k=u(i,3),O=k[0],C=k[1],D=k[2];return s(this,(1-(m+g))*M,(p+_)*M,(y-w)*M,0,(p-_)*E,(1-(v+g))*E,(b+x)*E,0,(y+w)*P,(b-x)*P,(1-(v+m))*P,0,e[0]+O-(this[0]*O+this[4]*C+this[8]*D),e[1]+C-(this[1]*O+this[5]*C+this[9]*D),e[2]+D-(this[2]*O+this[6]*C+this[10]*D),1),this}},{key:"getTranslation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Float32Array(3);return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Float32Array(4),e=this[0]+this[5]+this[10];if(e>0){var r=2*Math.sqrt(e+1);t[0]=(this[6]-this[9])/r,t[1]=(this[8]-this[2])/r,t[2]=(this[1]-this[4])/r,t[3]=.25*r}else if(this[0]>this[5]&this[0]>this[10]){var i=2*Math.sqrt(1+this[0]-this[5]-this[10]);t[0]=.25*i,t[1]=(this[1]+this[4])/i,t[2]=(this[8]+this[2])/i,t[3]=(this[6]-this[9])/i}else if(this[5]>this[10]){var n=Math.sqrt(1+this[5]-this[0]-this[10]);t[0]=(this[1]+this[4])/n*2,t[1]=.25*n,t[2]=(this[6]+this[9])/n,t[3]=(this[8]-this[2])/n}else{var a=2*Math.sqrt(1+this[10]-this[0]-this[5]);t[0]=(this[8]+this[2])/a,t[1]=(this[6]+this[9])/a,t[2]=.25*a,t[3]=(this[1]-this[4])/a}return t}},{key:"frustrum",value:function(t,e,r,i,n,a){var o=1/(e-t),u=1/(i-r),h=1/(n-a);return s(this,2*n*o,0,0,0,0,2*n*u,0,0,(e+t)*o,(i+r)*u,(a+n)*h,-1,0,0,a*n*2*h,0),this}},{key:"perspective",value:function(t,e,r,i){var n=1/Math.tan(t/2),a=1/(r-i);return s(this,n/e,0,0,0,0,n,0,0,0,0,(i+r)*a,-1,0,0,2*i*r*a,0),this}},{key:"perspectiveFromFieldOfView",value:function(t,e,r){var i=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+o),h=2/(i+n);return s(this,u,0,0,0,0,h,0,0,-(a-o)*u*.5,(i-n)*h*.5,r/(e-r),-1,0,0,r*e/(e-r),0),this}},{key:"ortho",value:function(t,e,r,i,n,a){var o=1/(t-e),u=1/(r-i),h=1/(n-a);return s(this,-2*o,0,0,0,0,-2*u,0,0,0,0,2*h,0,(t+e)*o,(i+r)*u,(a+n)*h,1),this}},{key:"lookAt",value:function(t,e,r){var i=u(t,3),n=i[0],a=i[1],o=i[2],h=u(r,3),l=h[0],f=h[1],c=h[2],d=u(e,3),v=d[0],p=d[1],y=d[2];if(Math.abs(n-v)<1e-6&&Math.abs(a-p)<1e-6&&Math.abs(o-y)<1e-6)return this.identity();var m=n-v,b=a-p,g=o-y,x=1/Math.sqrt(m*m+b*b+g*g);m*=x,b*=x,g*=x;var w=f*g-c*b,_=c*m-l*g,T=l*b-f*m;x=Math.sqrt(w*w+_*_+T*T),x?(x=1/x,w*=x,_*=x,T*=x):(w=0,_=0,T=0);var M=b*T-g*_,E=g*w-m*T,P=m*_-b*w;return x=Math.sqrt(M*M+E*E+P*P),x?(x=1/x,M*=x,E*=x,P*=x):(M=0,E=0,P=0),s(this,w,M,m,0,_,E,b,0,T,P,g,0,-(w*n+_*a+T*o),-(M*n+E*a+P*o),-(m*n+b*a+g*o),1),this}},{key:"frob",value:function(){return Math.sqrt(Math.pow(this[0],2)+Math.pow(this[1],2)+Math.pow(this[2],2)+Math.pow(this[3],2)+Math.pow(this[4],2)+Math.pow(this[5],2)+Math.pow(this[6],2)+Math.pow(this[7],2)+Math.pow(this[8],2)+Math.pow(this[9],2)+Math.pow(this[10],2)+Math.pow(this[11],2)+Math.pow(this[12],2)+Math.pow(this[13],2)+Math.pow(this[14],2)+Math.pow(this[15],2))}}]),e}(Float32Array);e.default=l},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),u=r(9),h=i(u),l=r(0),f=i(l),c=function(t){function e(t){n(this,e);var r=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,35676,new h.default));return r.fovy=45,r.near=.1,r.far=1e3,r._matrix=new h.default,r.updated=!0,r}return o(e,t),s(e,[{key:"update",value:function(t,e){this.data.perspective(this.fovy*Math.PI/180,t/e,.1,100),this.data.multiply(this._matrix),this.updated=!1}},{key:"matrix",get:function(){return this.updated=!0,this._matrix}}]),e}(f.default);e.default=c},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=r(3),s=(function(t){t&&t.__esModule}(o),function(){function t(e,r){i(this,t),this.canvas=e,this.init(e),this.meshs=[],this.cam=r,this.uniforms=[r],this.depthTest=!0,this.sortCompare=function(t,e){return t.program.id-e.program.id},this.resize(e.width,e.height)}return a(t,[{key:"_addCamToMeshs",value:function(){var t=this.cam;this.uniforms.push(t)}},{key:"addMesh",value:function(t){this.meshs.push(t),t.isInitialized()||t.init(this.gl,this.uniforms)}},{key:"rmMesh",value:function(t){var e=this.meshs.indexOf(t);e>-1&&this.meshs.splice(e,1)}},{key:"sort",value:function(){this.meshs.sort(this.sortCompare)}},{key:"resize",value:function(t,e){this.width=t,this.height=e}},{key:"init",value:function(t){var e=void 0;try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(t){console.error("Could not initialise WebGL:",t.message)}e||console.error("Could not initialise WebGL"),this.gl=e}},{key:"draw",value:function(){var t=this.gl;t.viewport(0,0,this.width,this.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.cam.updated&&this.cam.update(this.width,this.height);var e=!0,r=!1,i=void 0;try{for(var n,a=this.meshs[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var o=n.value;o.isInitialized()?o.draw(t):o.init(t,this.uniforms)}}catch(t){r=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw i}}}},{key:"depthTest",set:function(t){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._depthTest=!!t},get:function(){return this._depthTest}},{key:"bgColor",set:function(t){var e=n(t,4),r=e[0],i=e[1],a=e[2],o=e[3],s=void 0===o?1:o;this.gl.clearColor(r,i,a,s),this._bgColor=[r,i,a,s]},get:function(){return this._bgColor}}]),t}());e.default=s},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),u=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(i)},h=r(8),l=i(h),f=r(22),c=i(f),d=function(t){function e(t){n(this,e);var r=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.srcs=[],r.setTempColor([255,255,255,255]),r}return o(e,t),s(e,[{key:"setTempColor",value:function(t){this.setImg(new Uint8Array(t),1,1)}},{key:"addDDSURL",value:function(t,e){var r=this,i={size:e,src:t,img:null,isImage:!1,priority:1,isValid:function(){return!0},init:null};i.init=function(t){var e=(0,c.default)(i.img),n=e.images[0],a=new Uint8Array(i.img,n.offset,n.length),o=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");t.bindTexture(t.TEXTURE_2D,r.pointer),t.compressedTexImage2D(t.TEXTURE_2D,0,o.COMPRESSED_RGBA_S3TC_DXT5_EXT,e.shape[0],e.shape[1],0,a),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),r.mipmap=!1,r.setParam(t.TEXTURE_MAG_FILTER,t.LINEAR),r.setParam(t.TEXTURE_MIN_FILTER,t.LINEAR),r.initParams(t)},this.srcs.push(i)}},{key:"addURL",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i={size:r,src:t,img:null,priority:0,isImage:!0,isValid:function(){return!0},init:null};i.init=function(t){t.bindTexture(t.TEXTURE_2D,e.pointer),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,6408,e.format,t.UNSIGNED_BYTE,i.img),e.img=i.img,e.initParams(t)},this.srcs.push(i)}},{key:"init",value:function(t,r){var i=u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this,t,r);this.pointer;return e.START_LOAD(t,this.srcs),i}}],[{key:"START_LOAD",value:function(t,r){if(r.length>0){r.sort(function(t,e){return t.size===e.size?t.size-e.size:t.priority-e.priority});r.filter(function(e){return e.size>=l.default.MAX_SIZE&&e.isValid(t)});if(r.length>1){var i=r[0],n=r[r.length-1];e.LOAD(i,function(){i.init(t),e.LOAD(n,function(){n.init(t)})})}else if(r.length>0){var a=r[0];e.LOAD(a,function(){a.init(t)})}else console.warn("The GPU can'nt load a texture with size > ",l.default.MAX_SIZE)}else console.warn("URL of your smart texture not found")}},{key:"LOAD",value:function(t,e){if(t.isImage){var r=new Image;r.onload=function(){e(t)},t.img=r,r.src=t.src}else{var i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",t.src,!0),i.onreadystatechange=function(r){i.readyState===XMLHttpRequest.DONE&&(200===i.status?(t.img=i.response,e(t)):console.error("fail to load image ",t.src,"status:",i.status,"statuc text:",i.statusText))},i.send()}}}]),e}(l.default);e.default=d},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=r(9),u=i(s),h=r(0),l=i(h),f=function(t){function e(t){return n(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,35676,(new u.default).identity()))}return o(e,t),e}(l.default);e.default=f},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=r(21),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=function(){function t(e){i(this,t),this.screenRecorder=new o.default(e.width,e.height,!0,!0),this.scene=e,this.passList=[],this.isEnable=!1,this.init(e.gl)}return n(t,[{key:"isInitialized",value:function(){return this.screenRecorder.isInitialized()}},{key:"resize",value:function(t,e){this.scene.resize(t,e),this.screenRecorder.resize(t,e);var r=!0,i=!1,n=void 0;try{for(var a,o=this.passList[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){a.value.resize(t,e)}}catch(t){i=!0,n=t}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}}},{key:"_disableDepthInTexture",value:function(t,e){t.inDepthTexture&&t.setDepthTexture(!1,e)}},{key:"init",value:function(t){if(this.screenRecorder.init(t),!this.screenRecorder.depthTexture){var e=!0,r=!1,i=void 0;try{for(var n,a=this.passList[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var o=n.value;this._disableDepthInTexture(o,t)}}catch(t){r=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw i}}}return!0}},{key:"addPass",value:function(t){t.init(this.scene.gl,[]),this.screenRecorder.isInitialized()&&!this.screenRecorder.depthTexture&&this._disableDepthInTexture(t,this.scene.gl),t.uWidth&&(t.uWidth.data=this.scene.width),t.uHeight&&(t.uHeight.data=this.scene.height),this.passList.push(t),this.isEnable=!0}},{key:"removePass",value:function(t){var e=this.passList.indexOf(t);e>-1&&this.passList.splice(e,1),this.isEnable=this.passList.length>0}},{key:"draw",value:function(){var t=this.scene.gl,e=this.passList.length;if(e>0){this.screenRecorder.start(t,!0),this.scene.draw(),this.screenRecorder.stop(t),this.screenRecorder.pingpong();for(var r=0;r<e;r++){var i=this.passList[r];r>e-2||this.screenRecorder.start(t,!1),this.screenRecorder.pingpong(),i.inColorTexture&&i.inColorTexture.setTexture(this.screenRecorder.colorTexture),i.inDepthTexture&&this.screenRecorder.depthTexture&&i.inDepthTexture.setTexture(this.screenRecorder.depthTexture),i.draw(t),this.screenRecorder.stop(t)}}else this.scene.draw()}}]),t}();e.default=s},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return Number.isInteger(t)?t.toFixed(1):t}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),h=r(1),l=i(h),f=r(2),c=i(f),d=r(0),v=i(d),p="\n    attribute vec3 aVertexPosition;\n    varying vec2 vTextureCoord;\n\n    void main(void)\n    {\n        vTextureCoord = vec2(aVertexPosition.x * 0.5 + 0.5, aVertexPosition.y * 0.5 + 0.5);\n        gl_Position = vec4(aVertexPosition, 1.0);\n    }",y="\n    precision mediump float;\n    varying vec2 vTextureCoord;\n    uniform sampler2D uColor;\n    uniform sampler2D uDepth;\n\n    uniform vec3 uColorFog;\n    \n    uniform int uDepthEnable;\n\n    void main(void)\n    {\n        $chunkcall\n        gl_FragColor = color;\n    }",m=function(t){function e(t){var r=t.minDepth,i=void 0===r?.1:r,o=t.maxDepth,s=void 0===o?.2:o,u=t.minPower,h=void 0===u?.2:u,l=t.maxPower,f=void 0===l?1:l,d=t.depthCurve,y=void 0===d?100:d,m=t.color,b=void 0===m?[1,1,1]:m;n(this,e);var g=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,null,"aVertexPosition","uColor"));g.useColorTexture("uColor"),g.useDepthTexture("uDepth","uDepthEnable");var x=new v.default("uColorFog",35665,b);g.addUniform(x);var w=g._initFragmentShader(i,s,h,f,y);return g.program=new c.default(p,w),g}return o(e,t),u(e,[{key:"_initFragmentShader",value:function(t,e,r,i,n){var a="\n            float depthValue = 0.0;\n            if (uDepthEnable >= 0) {\n                vec4 depth = texture2D(uDepth, vTextureCoord.xy);\n                depthValue = pow(depth.x, "+s(n)+");\n                depthValue = (depthValue - "+s(t)+") / "+s(e-t)+";\n                depthValue = clamp(depthValue, "+s(r)+", "+s(i)+");\n            }\n            vec4 originalColor = texture2D(uColor, vTextureCoord.xy); \n            vec4 color = vec4(mix(originalColor.xyz, uColorFog, depthValue), originalColor.w);\n        ";return y.replace("$chunkcall",a)}}]),e}(l.default);e.default=m},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return Number.isInteger(t)?t.toFixed(1):t}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),h=r(1),l=i(h),f=r(2),c=i(f),d=r(0),v=(i(d),"\n    attribute vec3 aVertexPosition;\n    varying vec2 vTextureCoord;\n\n    void main(void)\n    {\n        vTextureCoord = vec2(aVertexPosition.x * 0.5 + 0.5, aVertexPosition.y * 0.5 + 0.5);\n        gl_Position = vec4(aVertexPosition, 1.0);\n    }"),p="\n    precision mediump float;\n    varying vec2 vTextureCoord;\n    uniform sampler2D uColor;\n    uniform sampler2D uDepth;\n    uniform int uSize;\n    uniform int uDepthEnable;\n\n    $chunkfct\n\n    void main(void)\n    {\n        $chunkcall\n        gl_FragColor = color;\n    }",y=function(t){function e(t){var r=t.minDepth,i=void 0===r?.1:r,o=t.maxDepth,s=void 0===o?.2:o,u=t.samples,h=void 0===u?5:u,l=t.xBlur,f=void 0===l||l,d=t.power,p=void 0===d?1:d,y=t.depthCurve,m=void 0===y?100:y;n(this,e);var b=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,null,"aVertexPosition","uColor"));b.power=p,b.xBlur=f,b.depthCurve=m,b.useColorTexture("uColor"),b.useDepthTexture("uDepth","uDepthEnable");var g=b._initFragmentShader(i,s,h);return b.program=new c.default(v,g),f?b.useUWidth("uSize",1):b.useUHeight("uSize",1),b}return o(e,t),u(e,[{key:"_initFragmentShader",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,i=this.xBlur,n=s(this.power),a=[],o=0;o<r;o++){var u=this._getKernels(o+1);a.push(u)}for(var h="",l=0;l<a.length;l++){var f=a[l];h+="\n            vec4 blur"+(l+1)+"(sampler2D i, vec2 uv) {\n                vec2 m;\n                vec4 color = texture2D(i, uv) * "+s(f[0])+";";for(var c=1;c<f.length;c++)h+="\n                m = "+(i?"vec2("+c+".0 * "+n+" / float(uSize), 0.0)":"vec2(0.0, "+c+".0 * "+n+" / float(uSize))")+";\n                color += texture2D(i, uv + m) * "+s(f[c])+";\n                color += texture2D(i, uv - m) * "+s(f[c])+";";h+="return color; }"}for(var d="\n            float depthValue = 0.0;\n            vec4 color;\n            if (uDepthEnable >= 0) {\n                vec4 depth = texture2D(uDepth, vTextureCoord.xy);\n                depthValue = pow(depth.x, "+s(this.depthCurve)+");\n                \n                int blurPower = int(floor(0.5 + (depthValue - "+s(t)+") * "+s(r)+" / "+s(e-t)+"));   \n        ",v=0;v<r;v++){var y="blurPower"+(v>r-2?" >= "+v:v<1?" < 1":" == "+v);d+=(v>0?" else if":"if")+" ( "+y+") {\n                color = blur"+(v+1)+"(uColor, vTextureCoord.xy);\n            }"}return d+="\n        } else {\n            color = texture2D(uColor, vTextureCoord.xy);\n        }\n        ",p.replace("$chunkfct",h).replace("$chunkcall",d)}},{key:"_getKernels",value:function(t){for(var e=[],r=0,i=1;i<t+2;i++){var n=3*(i-1)/t,a=Math.exp(-n*n);r+=i<2?a:a+a,e.push(a)}for(var o=0;o<e.length;o++)e[o]/=r;return e}}]),e}(l.default);e.default=y},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(e){i(this,t),this.label=e}return n(t,[{key:"isInitialized",value:function(){return!0}},{key:"init",value:function(t){return!0}},{key:"setTexture",value:function(t){this.pointer=t.pointer,this.target=t.target}},{key:"draw",value:function(t,e,r){t.uniform1i(e,r),t.activeTexture(t.TEXTURE0+r),t.bindTexture(this.target,this.pointer)}}]),t}();e.default=a},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(){j.matrix.rotate(.005,[0,1,0]),q.matrix.rotate(-.005,[0,1,0]),H.matrix.rotate(.01,[0,1,0]),tt.matrix.rotate(-.01,[0,1,0]),rt.matrix.rotate(.025,[.72,-.33,.5]),nt?at.draw():D.draw(),requestAnimationFrame(n)}var a=r(0),o=(i(a),r(13)),s=i(o),u=r(4),h=(i(u),r(2)),l=i(h),f=r(5),c=i(f),d=r(12),v=i(d),p=r(6),y=i(p),m=r(10),b=i(m),g=r(11),x=i(g),w=r(1),_=(i(w),r(14)),T=i(_),M=r(16),E=i(M),P=r(15),k=i(P),O=document.body.querySelector("canvas"),C=new b.default("uPMatrix"),D=new x.default(O,C);D.bgColor=[0,0,.1,1],D.depthTest=!0;var R=new l.default,I=new l.default("\n    attribute vec3 aVertexPosition;\n    attribute vec4 aVertexColor;\n\n    uniform mat4 uMVMatrix;\n    uniform mat4 uPMatrix;\n\n    varying vec4 vColor;\n\n    void main(void) {\n        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n        float zDepth = 0.2 * (8.0 - gl_Position.z);\n        vec4 modifyColor = vec4(aVertexColor.rgb * zDepth, aVertexColor.a);\n        vColor = modifyColor;\n    }\n"),A=[0,1,0,-1,-1,1,1,-1,1,0,1,0,1,-1,1,1,-1,-1,0,1,0,1,-1,-1,-1,-1,-1,0,1,0,-1,-1,-1,-1,-1,1],S=[1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,0,1,0,1,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,1,0,1],F=new c.default;F.addVertices("aVertexPosition",A,3),F.addVertices("aVertexColor",S,4);var j=new y.default(F,R),U=new s.default("uMVMatrix");j.addUniform(U),j.matrix=U.data,j.matrix.translate([-1.5,-1.5,-8]),D.addMesh(j);var L=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],z=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],B=[[1,0,0,1],[1,1,0,1],[0,1,0,1],[1,.5,.5,1],[1,0,1,1],[0,0,1,1]],V=[];for(var N in B)for(var X=0;X<4;X++)V=V.concat(B[N]);var W=new c.default;W.addVertices("aVertexPosition",L,3),W.addVertices("aVertexColor",V,4),W.addIndices(z);var H=new y.default(W,I),G=new s.default("uMVMatrix");H.addUniform(G),H.matrix=G.data,H.matrix.translate([1.5,-1.5,-8]),D.addMesh(H);var q=new y.default(F,R),Z=new s.default("uMVMatrix");q.addUniform(Z),q.matrix=Z.data,q.matrix.translate([-1.5,1.5,-8]),q.matrix.scale([1,-1,1]),D.addMesh(q);var K=new l.default("   \n    attribute vec3 aVertexPosition;\n    attribute vec2 aTextureCoord;\n\n    uniform mat4 uMVMatrix;\n    uniform mat4 uPMatrix;\n\n    varying vec2 vTextureCoord;\n\n    void main(void) {\n        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n        vTextureCoord = aTextureCoord;\n    }","\n    precision mediump float;\n\n    varying vec2 vTextureCoord;\n\n    uniform sampler2D uDiffuse1;\n    uniform sampler2D uDiffuse2;\n\n    void main(void) {\n        vec4 color1 = texture2D(uDiffuse1, vec2(vTextureCoord.s, vTextureCoord.t));\n        vec4 color2 = texture2D(uDiffuse2, vec2(vTextureCoord.s, vTextureCoord.t));\n        float power = ((sin(vTextureCoord.s * 3.1415)) * (sin(vTextureCoord.t * 3.1415)));\n        gl_FragColor = mix(color1, color2, power);\n    }"),Y=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],$=new v.default("uDiffuse1");$.addURL("cube-diffuse.jpg");var Q=new v.default("uDiffuse2");Q.setParam(10240,9728),Q.setParam(10241,9728),Q.addURL("cube-diffuse-2.png");var J=new c.default;J.addVertices("aVertexPosition",L,3),J.addVertices("aTextureCoord",Y,2),J.addIndices(z);var tt=new y.default(J,K),et=new s.default("uMVMatrix");tt.addUniform(et),tt.matrix=et.data,tt.addTexture($),tt.addTexture(Q),tt.matrix.translate([1.5,1.5,-8]),D.addMesh(tt);var rt=new y.default(J,K),it=new s.default("uMVMatrix");rt.addUniform(it),rt.matrix=it.data,rt.addTexture($),rt.addTexture(Q),rt.matrix.translate([0,0,-15]),D.addMesh(rt),D.sort();var nt=!0,at=void 0;if(nt){at=new T.default(D);var ot=new k.default({minDepth:.5,maxDepth:.6,minPower:0,maxPower:1,depthCurve:100,color:[.9,.95,1]});at.addPass(ot);var st={minDepth:.52,maxDepth:.7,samples:20,xBlur:!0,power:1,depthCurve:50},ut=new E.default(st);at.addPass(ut),st.xBlur=!1;var ht=new E.default(st);at.addPass(ht)}var lt=function(){var t=[window.innerWidth,window.innerHeight];nt?at.resize(1*t[0],1*t[1]):D.resize(1*t[0],1*t[1]),O.width=1*t[0],O.height=1*t[1],O.style.width=t[0]+"px",O.style.height=t[1]+"px",C.update.apply(C,t)};window.onresize=lt,lt(),window.scene=D,window.passManager=at,n()},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(e,r){i(this,t),this.pointer=null}return n(t,[{key:"isInitialized",value:function(){return!!this.pointer}},{key:"init",value:function(t){var e=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,e),this.pointer=e,!0}},{key:"bind",value:function(t){t.bindFramebuffer(t.FRAMEBUFFER,this.pointer)}},{key:"free",value:function(t){t.bindFramebuffer(t.FRAMEBUFFER,null)}}]),t}();e.default=a},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(e,r){i(this,t),this.pointer=null,this.width=e,this.height=r}return n(t,[{key:"resize",value:function(t,e){this.width=t,this.height=e,this.updated=!0}},{key:"isInitialized",value:function(){return!!this.pointer}},{key:"init",value:function(t){var e=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),this.pointer=e}},{key:"bind",value:function(t){t.bindRenderbuffer(t.RENDERBUFFER,renderBuffer),this.updated&&(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),this.updated=!1)}}]),t}();e.default=a},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=r(8),s=i(o),u=r(20),h=i(u),l=r(19),f=i(l),c=function(){function t(e,r){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n(this,t),this.captureDepth=i,this.recordDepth=a,this.width=e,this.height=r,this.updated=!1,this._pingpong=!1,this._colorTextures=[this._genColorTexture("frameBufferColor0",e,r),this._genColorTexture("frameBufferColor1",e,r)],this.frameBuffer=new f.default}return a(t,[{key:"_genDepthTexture",value:function(t,e,r){var i=new s.default;return i.mipmap=!1,i.setInternalFormat(6402),i.setFormat(6402),i.setType(5123),i.setParam(10242,33071),i.setParam(10243,33071),i.setParam(10241,9728),i.setParam(10240,9728),i.setImg(null,e,r),i}},{key:"_genColorTexture",value:function(t,e,r){var i=new s.default(t);return i.mipmap=!1,i.setImg(null,e,r),i}},{key:"pingpong",value:function(){this._pingpong=!this._pingpong}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.updated=!0}},{key:"isInitialized",value:function(){return!!this.frameBuffer.pointer}},{key:"init",value:function(e){return t._DATA_INITIALIZED||t.SET_DATA(e),this.recordDepth&&(t.WEBGL_depth_texture?(this.depthTexture=this._genDepthTexture("frameBufferDepth",this.width,this.height),this.depthTexture.init(e)):(console.warn("WEBGL_depth_texture Extension not available!"),this.recordDepth=!1)),this.captureDepth&&(this.renderBuffer=new h.default(this.width,this.height),this.renderBuffer.init(e)),this.frameBuffer.init(e),this.pingpong(),this.colorTexture.init(e),this.pingpong(),this.colorTexture.init(e),this.depthTexture?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,this.depthTexture.pointer,0):this.renderBuffer&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer.pointer),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),!0}},{key:"_update",value:function(t){var e=this.width,r=this.height;this.pingpong(),this.colorTexture.resize(e,r,t),this.pingpong(),this.colorTexture.resize(e,r,t),this.depthTexture&&this.depthTexture.resize(e,r,t),this.renderBuffer&&this.renderBuffer.resize(e,r,t),this.updated=!1}},{key:"start",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updated&&this._update(t),this.frameBuffer.bind(t),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.colorTexture.pointer,0),this.depthTexture?t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,e?this.depthTexture.pointer:null,0):this.renderBuffer&&t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e?this.renderBuffer.pointer:null)}},{key:"stop",value:function(t){this.frameBuffer.free(t)}},{key:"colorTexture",get:function(){return this._colorTextures[this._pingpong?1:0]}}],[{key:"SET_DATA",value:function(e){t.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture"),t._DATA_INITIALIZED=!0}}]),t}();e.default=c},function(t,e){function r(t){var e=new Int32Array(t,0,y);if(e[m]!==a)throw new Error("Invalid magic number in DDS header");if(!e[T]&s)throw new Error("Unsupported format, must contain a FourCC code");var r,i,P=e[M];switch(P){case u:r=8,i="dxt1";break;case h:r=16,i="dxt3";break;case l:r=16,i="dxt5";break;case c:i="rgba32f";break;case f:var k=new Uint32Array(t.slice(128,148));i=k[0];var O=k[1];k[2],k[3],k[4];if(O!==v||i!==p)throw new Error("Unsupported DX10 texture format "+i);i="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+n(P))}var C=e[g],D=1;C&o&&(D=Math.max(1,e[_]));var R=!1;e[E]&d&&(R=!0);var I,A=e[w],S=e[x],F=e[b]+4,j=A,U=S,L=[];if(P===f&&(F+=20),R)for(var z=0;z<6;z++){if("rgba32f"!==i)throw new Error("Only RGBA32f cubemaps are supported");A=j,S=U;for(var B=Math.log(A)/Math.log(2)+1,V=0;V<B;V++)I=A*S*16,L.push({offset:F,length:I,shape:[A,S]}),V<D&&(F+=I),A=Math.floor(A/2),S=Math.floor(S/2)}else for(var V=0;V<D;V++)I=Math.max(4,A)/4*Math.max(4,S)/4*r,L.push({offset:F,length:I,shape:[A,S]}),F+=I,A=Math.floor(A/2),S=Math.floor(S/2);return{shape:[j,U],images:L,format:i,flags:C,cubemap:R}}function i(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function n(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}var a=542327876,o=131072,s=4,u=i("DXT1"),h=i("DXT3"),l=i("DXT5"),f=i("DX10"),c=116,d=512,v=3,p=2,y=31,m=0,b=1,g=2,x=3,w=4,_=7,T=20,M=21,E=28;t.exports=r}]);